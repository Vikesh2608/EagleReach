<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EagleReach</title>
  <link rel="icon" href="data:,">
  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card { @apply bg-white rounded-xl shadow-md p-4; }
    .btn  { @apply inline-flex items-center justify-center rounded-md px-3 py-2 text-sm font-medium transition; }
    .btn-primary { @apply bg-blue-600 text-white hover:bg-blue-700; }
    .btn-ghost   { @apply bg-gray-100 text-gray-700 hover:bg-gray-200; }
    .link { @apply text-blue-600 hover:underline; }
    .pill { @apply inline-block rounded-full px-2.5 py-0.5 text-xs font-medium bg-blue-100 text-blue-700; }
    .modal { @apply fixed inset-0 z-[60] hidden items-center justify-center; background: rgba(0,0,0,.35); }
    .modal-card { @apply w-[92vw] max-w-xl bg-white rounded-xl shadow-lg; }
    .kbd { @apply bg-gray-100 text-gray-800 rounded px-1.5 py-0.5 border border-gray-300 text-xs; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">

  <!-- Top bar -->
  <header class="w-full bg-slate-900 text-white">
    <div class="mx-auto max-w-6xl px-4">
      <div class="flex items-center justify-between py-3">
        <div class="flex items-center gap-3">
          <!-- small flag + eagle emoji -->
          <div class="text-2xl">ü¶Ö</div>
          <div class="text-lg font-semibold tracking-wide">EagleReach</div>
        </div>

        <!-- quote (hidden on xs) -->
        <div class="hidden md:block text-[12.5px] text-slate-300">
          ‚ÄúA nation, as a society, forms a moral person, and every member of it is personally responsible for his society.‚Äù
          ‚Äî <span class="italic">Thomas Jefferson</span>
        </div>

        <!-- tabs -->
        <nav class="flex items-center gap-6 text-sm">
          <button data-open="#aboutModal"   class="hover:underline">About</button>
          <button data-open="#founderModal" class="hover:underline">Founder</button>
          <button data-open="#contactModal" class="hover:underline">Contact</button>
          <button data-open="#feedbackModal" class="hover:underline">Feedback</button>
        </nav>
      </div>
    </div>
  </header>

  <!-- Search + actions -->
  <section class="mx-auto max-w-6xl px-4 mt-6">
    <p class="text-sm text-slate-600">
      Enter your ZIP code to see representatives, voter info, weather, city updates, traffic, and elections.
    </p>

    <div class="mt-3 flex flex-wrap gap-2 items-center">
      <input id="zipInput" type="text" inputmode="numeric" maxlength="10"
             class="w-64 rounded-md border border-slate-300 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-500"
             placeholder="ZIP (e.g., 62704)" />

      <button id="locBtn" class="btn btn-ghost">Locating‚Ä¶</button>
      <button id="searchBtn" class="btn btn-primary">Search</button>
      <button id="shareBtn" class="btn btn-ghost">Copy Share Link</button>
      <button id="clearBtn" class="btn btn-ghost">Clear history</button>

      <span id="placeLabel" class="text-sm text-slate-500 ml-2"></span>
    </div>
  </section>

  <!-- Content grid -->
  <main class="mx-auto max-w-6xl px-4 mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">

    <!-- Officials -->
    <section class="card md:col-span-1" id="officialsCard">
      <div class="flex items-center justify-between">
        <h2 class="font-semibold">Elected Representatives</h2>
        <div class="flex gap-2">
          <button id="copyEmailsBtn" class="btn btn-ghost">Copy Emails</button>
          <button id="genEmailBtn" class="btn btn-primary">Generate Email</button>
        </div>
      </div>
      <p class="mt-1 text-xs text-slate-500">
        Sources: GovTrack (Congress), Wikidata (Mayor), FCC, Zippopotam.
      </p>
      <div id="officialsList" class="mt-3 space-y-3 text-sm"></div>
      <p id="officialsHint" class="text-xs text-slate-500 mt-3">Enter a ZIP to load officials‚Ä¶</p>
    </section>

    <!-- Weather -->
    <section class="card" id="weatherCard">
      <h2 class="font-semibold">Weather (7‚Äëday)</h2>
      <div id="weatherDays" class="mt-2 divide-y divide-slate-100"></div>
      <p id="weatherHint" class="text-xs text-slate-500 mt-3">Enter a ZIP to load weather‚Ä¶</p>
    </section>

    <!-- Voter Info -->
    <section class="card" id="voterCard">
      <h2 class="font-semibold">Voter Info & Education</h2>
      <ul class="mt-2 list-disc pl-5 text-sm space-y-1">
        <li><a class="link" target="_blank" href="https://www.usa.gov/how-to-vote">How to vote (USA.gov)</a></li>
        <li><a class="link" target="_blank" href="https://www.vote.gov/">Register to vote</a></li>
        <li><a class="link" target="_blank" href="https://www.usa.gov/election-office">Find your Election Office</a></li>
      </ul>
    </section>

    <!-- City updates -->
    <section class="card" id="cityCard">
      <h2 class="font-semibold">City updates</h2>
      <div id="cityList" class="mt-2 space-y-2 text-sm"></div>
      <p id="cityHint" class="text-xs text-slate-500 mt-2">Enter a ZIP to load updates‚Ä¶</p>
    </section>

    <!-- News -->
    <section class="card" id="newsCard">
      <h2 class="font-semibold">News</h2>
      <div class="mt-3 flex gap-2">
        <a id="localNewsBtn" class="btn btn-primary" target="_blank" rel="noopener">Open Local News</a>
        <a id="worldNewsBtn" class="btn btn-ghost"   target="_blank" rel="noopener">World News</a>
      </div>
      <p class="text-xs text-slate-500 mt-2">Opens news in a new tab.</p>
    </section>

    <!-- Elections -->
    <section class="card" id="elexCard">
      <h2 class="font-semibold">Upcoming Elections</h2>
      <div id="elexBody" class="mt-2 text-sm"></div>
    </section>

    <!-- Traffic -->
    <section class="card" id="trafficCard">
      <h2 class="font-semibold">Traffic</h2>
      <p class="text-sm text-slate-600 mt-1">Open live traffic for your area in Google Maps.</p>
      <a id="trafficBtn" target="_blank" rel="noopener"
         class="mt-3 inline-flex btn btn-ghost">Open Traffic Map</a>
    </section>

    <!-- Emergency -->
    <section class="card lg:col-span-3" id="emergCard">
      <h2 class="font-semibold">Emergency</h2>
      <p class="text-xs text-slate-500">Tap a number to call.</p>
      <div class="mt-3 grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-2 text-sm">
        <a class="btn bg-red-600 text-white hover:bg-red-700"  href="tel:911">911 ‚Äî Emergency</a>
        <a class="btn bg-fuchsia-600 text-white hover:bg-fuchsia-700" href="tel:988">988 ‚Äî Suicide &amp; Crisis</a>
        <a class="btn bg-emerald-600 text-white hover:bg-emerald-700" href="tel:211">211 ‚Äî Community Services</a>
        <a class="btn bg-blue-700 text-white hover:bg-blue-800" href="tel:311">311 ‚Äî City Services</a>
        <a class="btn bg-orange-600 text-white hover:bg-orange-700" href="tel:811">811 ‚Äî Before You Dig</a>
        <a class="btn bg-orange-500 text-white hover:bg-orange-600" href="tel:18002221222">Poison Control</a>
      </div>
    </section>

    <!-- Raise a Concern -->
    <section class="card lg:col-span-3" id="concernCard">
      <h2 class="font-semibold">Raise a Concern</h2>
      <p class="text-sm text-slate-600 mt-1">
        Report city issues (311), contact your city hall, or write to your representatives.
      </p>
      <div class="mt-3 flex flex-wrap gap-2 text-sm">
        <button data-template="pothole" class="btn btn-ghost">Potholes</button>
        <button data-template="trash"   class="btn btn-ghost">Trash</button>
        <button data-template="lights"  class="btn btn-ghost">Street lights</button>
      </div>
    </section>

  </main>

  <!-- Modals: About / Founder / Contact / Feedback -->
  <div id="aboutModal" class="modal">
    <div class="modal-card p-5">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold">About EagleReach</h3>
        <button class="text-gray-500" data-close>&times;</button>
      </div>
      <div class="mt-3 text-sm leading-6">
        <p class="mb-2">
          EagleReach is a public, open‚Äësource civic assistant that connects U.S. residents with their elected officials,
          nearby services, and local context such as weather, traffic, and city updates‚Äîfast and free.
        </p>
        <ul class="list-disc pl-5 space-y-1">
          <li>No logins. No tracking. Open data only.</li>
          <li>Built to inform voters and reduce friction in civic participation.</li>
          <li>Mobile‚Äëfriendly and light‚Äëweight for wide accessibility.</li>
        </ul>
      </div>
    </div>
  </div>

  <div id="founderModal" class="modal">
    <div class="modal-card p-5">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold">Founder</h3>
        <button class="text-gray-500" data-close>&times;</button>
      </div>
      <div class="mt-3 text-sm leading-6">
        <p class="mb-3">
          <strong>Vikesh Sagar Bairam</strong> ‚Äî Founder of EagleReach ¬∑ Tech Evangelist & Business Solutions Architect ¬∑
          AI/ML & Data Engineer ¬∑ DevOps Specialist ¬∑ Research Professional.
        </p>
        <p>
          M.S. (Information Systems & Management), University of Illinois Springfield; dual Bachelors (Psychology, Computer Science).
          Currently at Jabil; previously with Surfaces by Pacific.
        </p>
      </div>
    </div>
  </div>

  <div id="contactModal" class="modal">
    <div class="modal-card p-5">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold">Contact</h3>
        <button class="text-gray-500" data-close>&times;</button>
      </div>
      <div class="mt-3 text-sm leading-6 space-y-2">
        <p>
          LinkedIn:
          <a id="liLink" class="link" target="_blank" rel="noopener noreferrer external">Vikesh Bairam</a>
          <button id="liCopy" class="btn-ghost kbd ml-2">Copy link</button>
        </p>
        <p>GitHub: <a class="link" target="_blank" rel="noopener" href="https://github.com/vikesh2608">vikesh2608</a></p>
        <p>Email: <a class="link" href="mailto:vikebairam@gmail.com">vikebairam@gmail.com</a></p>
        <p class="text-xs text-slate-500">If LinkedIn shows an error in an in‚Äëapp browser, open the copied link in the LinkedIn app or your device browser.</p>
      </div>
    </div>
  </div>

  <div id="feedbackModal" class="modal">
    <div class="modal-card p-5">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold">Feedback</h3>
        <button class="text-gray-500" data-close>&times;</button>
      </div>
      <form id="feedbackForm" class="mt-3 space-y-3 text-sm">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
          <input id="fbName"  class="rounded-md border border-slate-300 px-3 py-2" placeholder="Your name" />
          <input id="fbEmail" class="rounded-md border border-slate-300 px-3 py-2" placeholder="Email (optional)" />
        </div>
        <div>
          <label class="block mb-1">Rating</label>
          <div id="stars" class="flex gap-1 text-2xl cursor-pointer select-none">
            <span data-s="1">‚òÜ</span><span data-s="2">‚òÜ</span><span data-s="3">‚òÜ</span><span data-s="4">‚òÜ</span><span data-s="5">‚òÜ</span>
          </div>
        </div>
        <textarea id="fbText" rows="5"
                  class="w-full rounded-md border border-slate-300 px-3 py-2"
                  placeholder="Your comments‚Ä¶"></textarea>
        <div class="flex justify-end gap-2">
          <button type="button" data-close class="btn btn-ghost">Cancel</button>
          <button type="submit" class="btn btn-primary">Send</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 z-[70] hidden">
    <div class="bg-slate-900 text-white px-4 py-2 rounded shadow-lg text-sm" id="toastMsg"></div>
  </div>

  <script>
    const API = "https://eaglereach-1.onrender.com"; // backend base
    const LINKEDIN_URL = "https://www.linkedin.com/in/vikesh-bairam-219769258/";

    const $ = (sel, p=document) => p.querySelector(sel);
    const $$ = (sel, p=document) => Array.from(p.querySelectorAll(sel));

    const zipInput = $("#zipInput");
    const locBtn   = $("#locBtn");
    const searchBtn= $("#searchBtn");
    const shareBtn = $("#shareBtn");
    const clearBtn = $("#clearBtn");
    const placeLbl = $("#placeLabel");

    const officialsList = $("#officialsList");
    const officialsHint = $("#officialsHint");
    const copyEmailsBtn = $("#copyEmailsBtn");
    const genEmailBtn   = $("#genEmailBtn");

    const weatherDays = $("#weatherDays");
    const weatherHint = $("#weatherHint");

    const cityList = $("#cityList");
    const cityHint = $("#cityHint");

    const localNewsBtn = $("#localNewsBtn");
    const worldNewsBtn = $("#worldNewsBtn");
    const elexBody     = $("#elexBody");
    const trafficBtn   = $("#trafficBtn");

    // Modals
    $$("#aboutModal, #founderModal, #contactModal, #feedbackModal").forEach(m=>{
      m.addEventListener('click', e => { if (e.target === m || e.target.hasAttribute('data-close')) m.classList.add('hidden'); });
    });
    $$('[data-open]').forEach(btn=>{
      btn.addEventListener('click', ()=> $($(btn).dataset.open).classList.remove('hidden'));
    });

    // LinkedIn
    const liLink = $("#liLink"); const liCopy = $("#liCopy");
    liLink.href = LINKEDIN_URL;
    liCopy.addEventListener('click', async ()=>{
      try { await navigator.clipboard.writeText(LINKEDIN_URL);
            toast("LinkedIn link copied. Open it in the LinkedIn app or browser."); }
      catch { toast("Long‚Äëpress to copy:\n" + LINKEDIN_URL); }
    });

    // Feedback stars + mailto
    let rating = 0;
    $$("#stars span").forEach(s=>{
      s.addEventListener('click', ()=>{
        rating = Number(s.dataset.s);
        $$("#stars span").forEach(x=> x.textContent = (Number(x.dataset.s)<=rating) ? "‚òÖ" : "‚òÜ");
      });
    });
    $("#feedbackForm").addEventListener('submit', e=>{
      e.preventDefault();
      const name = $("#fbName").value.trim() || "Anonymous";
      const email= $("#fbEmail").value.trim();
      const text = $("#fbText").value.trim();
      const subj = encodeURIComponent("EagleReach feedback");
      const body = encodeURIComponent(
        `Name: ${name}\nEmail: ${email}\nRating: ${rating || "N/A"}/5\n\n${text}`
      );
      window.open(`mailto:vikebairam@gmail.com?subject=${subj}&body=${body}`,'_blank');
      $("#feedbackModal").classList.add('hidden');
      toast("Thanks for the feedback!");
    });

    // Toast helper
    function toast(msg){
      $("#toastMsg").textContent = msg;
      const t = $("#toast");
      t.classList.remove('hidden');
      setTimeout(()=> t.classList.add('hidden'), 2500);
    }

    // Weather summary from precip %
    function skyFromPrecip(p){ if (p>=60) return "Rain"; if (p>=30) return "Cloudy"; return "Clear"; }

    // Render helpers
    function renderOfficials(rows){
      officialsList.innerHTML = rows.map(r=>`
        <div class="rounded-lg border border-slate-200 p-3">
          <div class="font-medium">${r.name} ‚Äî <span class="text-slate-600">${r.office}</span></div>
          ${r.party? `<div class="text-xs text-slate-500">${r.party}</div>`:''}
          <div class="mt-1 flex flex-wrap gap-3 text-sm">
            ${ (r.urls||[]).map(u=>`<a class="link" target="_blank" rel="noopener" href="${u}">${new URL(u).hostname.replace('www.','')}</a>`).join('') }
            ${ (r.phones||[]).map(p=>`<a class="link" href="tel:${p.replace(/[^0-9]/g,'')}">${p}</a>`).join('') }
          </div>
        </div>
      `).join('');
    }

    function renderWeather(days){
      weatherDays.innerHTML = days.map(d=>{
        const sky = d.summary || skyFromPrecip(d.precip_pct ?? 0);
        const hi  = Math.round(d.tmax_c ?? d.tmax ?? 0);
        const lo  = Math.round(d.tmin_c ?? d.tmin ?? 0);
        return `
          <div class="py-2 flex items-center justify-between">
            <div class="text-sm text-slate-700">${d.date}</div>
            <div class="text-sm text-slate-600">${sky}</div>
            <div class="text-sm font-medium">${lo}¬∞ / ${hi}¬∞C</div>
          </div>`;
      }).join('');
    }

    function renderCity(updates){
      if (!updates || !updates.length){
        cityList.innerHTML = `<div class="text-sm text-slate-600">City updates unavailable.</div>`;
        return;
      }
      cityList.innerHTML = updates.slice(0,8).map(u=>`
        <div class="rounded border border-slate-200 p-2">
          <div class="text-sm font-medium">${u.type || u.title || "Update"}</div>
          ${u.detail ? `<div class="text-xs text-slate-600 mt-1">${u.detail}</div>`:''}
          ${u.address ? `<div class="text-xs text-slate-500 mt-1">${u.address}</div>`:''}
        </div>
      `).join('');
    }

    // Actions
    async function run(zip){
      if (!zip) return;
      localStorage.setItem("lastZip", zip);
      const qs = new URLSearchParams(location.search);
      qs.set("zip", zip);
      history.replaceState(null, "", `${location.pathname}?${qs.toString()}`);

      const loc = await fetch(`${API}/officials?zip=${encodeURIComponent(zip)}`).then(r=>r.json()).catch(()=>null);
      if (loc && loc.place && loc.state && loc.state.abbr){
        placeLbl.textContent = `${zip} ‚Äî ${loc.place}, ${loc.state.abbr}`;
      } else placeLbl.textContent = `${zip}`;

      // Officials
      if (loc && Array.isArray(loc.officials)){
        officialsHint.classList.add('hidden');
        renderOfficials(loc.officials);
        // copy / gen email
        copyEmailsBtn.onclick = ()=>{
          const emails = (loc.officials||[]).flatMap(o=> o.emails||[]);
          if (!emails.length) return toast("No emails available.");
          navigator.clipboard.writeText(emails.join(", ")).then(()=>toast("Emails copied."));
        };
        genEmailBtn.onclick = ()=>{
          const emails = (loc.officials||[]).flatMap(o=> o.emails||[]);
          if (!emails.length) return toast("No emails available.");
          const subj = encodeURIComponent("Constituent inquiry from " + zip);
          const body = encodeURIComponent("Dear Representative,\n\n[Write your message here]\n\nThank you.");
          location.href = `mailto:${emails.join(",")}?subject=${subj}&body=${body}`;
        };
      } else {
        officialsList.innerHTML = "";
        officialsHint.classList.remove('hidden');
      }

      // Weather
      const w = await fetch(`${API}/weather?zip=${encodeURIComponent(zip)}`).then(r=>r.json()).catch(()=>null);
      if (w && Array.isArray(w.days) && w.days.length){
        weatherHint.classList.add('hidden');
        renderWeather(w.days);
      } else {
        weatherDays.innerHTML = "";
        weatherHint.classList.remove('hidden');
      }

      // City updates (best‚Äëeffort)
      try{
        const cu = await fetch(`${API}/city/updates?zip=${encodeURIComponent(zip)}`).then(r=>r.json());
        renderCity(cu?.updates || cu?.items || []);
        cityHint.classList.add('hidden');
      }catch{
        renderCity([]);
        cityHint.classList.add('hidden');
      }

      // Elections (static next federal + note)
      elexBody.innerHTML = `
        <div class="text-sm">Next Federal: <span class="font-medium">November 3, 2025</span></div>
        <div class="text-xs text-slate-500 mt-1">State/Local specific dates coming from open data.</div>
      `;

      // News links
      localNewsBtn.href = `https://news.google.com/search?q=${encodeURIComponent(zip)}&hl=en-US&gl=US&ceid=US:en`;
      worldNewsBtn.href = `https://news.google.com/topstories?hl=en-US&gl=US&ceid=US:en`;

      // Traffic map
      trafficBtn.href = `https://www.google.com/maps/@?api=1&map_action=map&basemap=traffic`;
    }

    // Geolocation -> reverse to ZIP (BigDataCloud, CORS‚Äëfriendly)
    async function setZipFromGeo(){
      locBtn.disabled = true;
      locBtn.textContent = "Locating‚Ä¶";
      try{
        const pos = await new Promise((res, rej)=>{
          navigator.geolocation.getCurrentPosition(res, rej, {enableHighAccuracy:true, timeout:12000});
        });
        const {latitude, longitude} = pos.coords;
        const g = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=en`).then(r=>r.json());
        const zipcode = g.postcode || g.localityInfo?.informative?.find(x=>x.description==="postcode")?.name;
        if (!zipcode) throw new Error("No ZIP in reverse geocode.");
        zipInput.value = zipcode;
        placeLbl.textContent = `${zipcode} ‚Äî ${g.city || g.locality || ""}${g.principalSubdivision ? ", "+g.principalSubdivision : ""}`;
        await run(zipcode);
      }catch(e){
        alert("Could not resolve ZIP from your location.");
      }finally{
        locBtn.disabled = false;
        locBtn.textContent = "Use my location";
      }
    }

    // Wire UI
    locBtn.addEventListener('click', setZipFromGeo);
    searchBtn.addEventListener('click', ()=> run(zipInput.value.trim()));
    zipInput.addEventListener('keydown', e=>{ if(e.key==="Enter"){ e.preventDefault(); run(zipInput.value.trim()); }});
    shareBtn.addEventListener('click', async ()=>{
      const url = location.href.includes("?") ? location.href : `${location.origin}${location.pathname}?zip=${encodeURIComponent(zipInput.value.trim())}`;
      try{ await navigator.clipboard.writeText(url); toast("Share link copied."); } catch{ toast("Copy failed."); }
    });
    clearBtn.addEventListener('click', ()=>{
      localStorage.removeItem("lastZip");
      zipInput.value = "";
      placeLbl.textContent = "";
      officialsList.innerHTML = "";
      weatherDays.innerHTML  = "";
      cityList.innerHTML     = "";
      officialsHint.classList.remove('hidden');
      weatherHint.classList.remove('hidden');
      cityHint.classList.remove('hidden');
    });

    // init
    (function init(){
      // set btn text
      locBtn.textContent = "Use my location";
      // restore zip from query or localStorage
      const qp = new URLSearchParams(location.search);
      const zq = qp.get("zip") || localStorage.getItem("lastZip") || "";
      if (zq){ zipInput.value = zq; run(zq); }
    })();
  </script>
</body>
</html>
