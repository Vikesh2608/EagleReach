<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EagleReach ‚Äî Civic Assistant for U.S. Residents</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: { blue: '#0b3d91', red: '#b31942' }
          },
          boxShadow: {
            soft: '0 10px 20px rgba(0,0,0,.06), 0 6px 6px rgba(0,0,0,.08)'
          }
        }
      }
    }
  </script>

  <!-- Feather icons -->
  <script src="https://unpkg.com/feather-icons"></script>

  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,\
  <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>\
  <rect width='64' height='64' fill='%230b3d91'/>\
  <text x='32' y='40' font-size='28' text-anchor='middle' fill='white'>ü¶Ö</text>\
  </svg>">

  <style>
    .card { @apply bg-white rounded-2xl p-5 shadow-soft; }
    .kicker { @apply text-xs uppercase tracking-widest text-slate-500; }
    .pill { @apply inline-flex items-center gap-2 rounded-full px-3 py-1 text-sm bg-slate-100; }
    .btn { @apply inline-flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium shadow-soft; }
    .btn-primary { @apply bg-brand-blue text-white hover:opacity-90; }
    .btn-ghost   { @apply bg-white text-brand-blue border border-brand-blue hover:bg-slate-50; }
    .heading, .section-title, .card-title { @apply text-2xl md:text-[28px] font-extrabold text-slate-800; }
    dialog::backdrop { background: rgba(0,0,0,.5); }
    .flagbar {
      background: linear-gradient(90deg, #b31942 0 20%, #fff 20% 40%, #0b3d91 40% 60%, #fff 60% 80%, #b31942 80% 100%);
      height: 6px;
    }
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-800">

  <!-- Header -->
  <header class="bg-brand-blue text-white">
    <div class="flagbar"></div>
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <span class="text-2xl">üá∫üá∏</span>
        <div>
          <div class="text-xl font-semibold tracking-tight">EagleReach</div>
          <div class="text-xs opacity-80">‚ÄúA nation‚Ä¶ every member is responsible for his society.‚Äù ‚Äî Thomas Jefferson</div>
        </div>
        <span class="text-2xl ml-2">ü¶Ö</span>
      </div>
      <nav class="hidden md:flex items-center gap-2">
        <button class="btn btn-ghost" id="openAbout"  title="About"><i data-feather="info"></i> About</button>
        <button class="btn btn-ghost" id="openFounder" title="Founder"><i data-feather="user"></i> Founder</button>
        <button class="btn btn-ghost" id="openContact" title="Contact"><i data-feather="mail"></i> Contact</button>
        <button class="btn btn-ghost" id="openFeedback" title="Feedback"><i data-feather="message-square"></i> Feedback</button>
      </nav>
      <div class="md:hidden">
        <button class="btn btn-ghost" data-open="menuDlg"><i data-feather="menu"></i></button>
      </div>
    </div>
  </header>

  <!-- Controls -->
  <section class="max-w-6xl mx-auto px-4 py-6">
    <div class="card">
      <div class="flex flex-col md:flex-row md:items-end gap-3">
        <div class="flex-1">
          <div class="kicker mb-1">Enter ZIP</div>
          <input id="zipInput" type="text" inputmode="numeric" maxlength="10"
                 placeholder="ZIP (e.g., 45220)"
                 class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand-blue" />
          <p id="geoLabel" class="text-xs mt-1 text-slate-500"></p>
        </div>

        <div class="flex flex-wrap items-center gap-2">
          <button id="btnLocate" class="btn btn-primary" title="Use my location"><i data-feather="map-pin"></i> Use my location</button>
          <button id="btnSearch" class="btn btn-ghost" title="Search"><i data-feather="search"></i> Search</button>
          <button id="btnCopy" class="btn btn-ghost" title="Copy share link"><i data-feather="link"></i> Copy Link</button>
          <button id="btnClear" class="btn btn-ghost" title="Clear history"><i data-feather="trash-2"></i> Clear</button>
        </div>
      </div>
      <p id="placeTag" class="mt-3 text-sm text-slate-600"></p>
    </div>
  </section>

  <!-- Content -->
  <main class="max-w-6xl mx-auto px-4 pb-12 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">

    <!-- Elected Representatives -->
    <section class="card md:col-span-1">
      <div class="kicker mb-1">Civic</div>
      <h2 class="section-title mb-3">Elected Representatives</h2>
      <div id="repsList" class="space-y-3"></div>
      <div class="text-[11px] mt-3 text-slate-500">Sources: WhoIsMyRepresentative, GovTrack (fallback), Zippopotam, BigDataCloud.</div>
    </section>

    <!-- Voter Info & Education -->
    <section class="card">
      <div class="kicker mb-1">Democracy</div>
      <h2 class="section-title mb-3">Voter Info & Education</h2>
      <ul class="text-sm space-y-2">
        <li><a class="text-brand-blue underline" target="_blank" href="https://www.usa.gov/how-to-vote">How to vote (USA.gov)</a></li>
        <li><a class="text-brand-blue underline" target="_blank" href="https://vote.gov/">Register to vote</a></li>
        <li><a class="text-brand-blue underline" target="_blank" href="https://www.usa.gov/election-office" id="linkElectionOffice">Find your Election Office</a></li>
      </ul>
    </section>

    <!-- Weather -->
    <section class="card">
      <div class="kicker mb-1">Local</div>
      <h2 class="section-title mb-3">Weather (7-day)</h2>
      <div id="wxList" class="text-sm space-y-2"></div>
    </section>

    <!-- City updates -->
    <section class="card">
      <div class="kicker mb-1">City</div>
      <h2 class="section-title mb-3">City Updates</h2>
      <div id="cityList" class="text-sm text-slate-600">Enter a ZIP to load updates‚Ä¶</div>
    </section>

    <!-- News -->
    <section class="card">
      <div class="kicker mb-1">News</div>
      <h2 class="section-title mb-3">News</h2>
      <div class="flex items-center gap-2">
        <a id="openLocalNews" class="btn btn-primary" target="_blank" rel="noopener">Open Local News</a>
        <a id="openWorldNews" class="btn btn-ghost" target="_blank" rel="noopener">World News</a>
      </div>
      <p class="text-[11px] mt-3 text-slate-500">Opens news in a new tab.</p>
    </section>

    <!-- Elections -->
    <section class="card">
      <div class="kicker mb-1">Elections</div>
      <h2 class="section-title mb-3">Upcoming Elections</h2>
      <div id="electionsBox" class="text-sm text-slate-700"></div>
    </section>

    <!-- Traffic -->
    <section class="card">
      <div class="kicker mb-1">Traffic</div>
      <h2 class="section-title mb-3">Traffic</h2>
      <p class="text-sm mb-3">Open live traffic for your area in Google Maps.</p>
      <a id="openTraffic" class="btn btn-primary" target="_blank" rel="noopener"><i data-feather="navigation"></i> Open Traffic Map</a>
    </section>

    <!-- Raise a concern -->
    <section class="card md:col-span-2 lg:col-span-3">
      <div class="kicker mb-1">Civic Action</div>
      <h2 class="section-title mb-3">Raise a Concern</h2>
      <p class="text-sm mb-3">Report city issues (311), contact your city hall, or write to your representatives.</p>
      <div class="flex flex-wrap gap-2">
        <a id="lnkPotholes" class="pill" target="_blank" rel="noopener"><i data-feather="alert-triangle"></i> Potholes</a>
        <a id="lnkTrash"    class="pill" target="_blank" rel="noopener"><i data-feather="trash-2"></i> Trash</a>
        <a id="lnkLights"   class="pill" target="_blank" rel="noopener"><i data-feather="moon"></i> Street lights</a>
      </div>
    </section>

    <!-- Emergency -->
    <section class="card">
      <div class="kicker mb-1">Emergency</div>
      <h2 class="section-title mb-3">Emergency Contacts</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <a class="btn btn-primary justify-center" href="tel:911">911 ‚Äî Emergency</a>
        <a class="btn btn-primary justify-center" href="tel:988">988 ‚Äî Suicide &amp; Crisis</a>
        <a class="btn btn-primary justify-center" href="tel:311">311 ‚Äî City Services</a>
        <a class="btn btn-primary justify-center" href="tel:211">211 ‚Äî Community Services</a>
        <a class="btn btn-primary justify-center" href="tel:811">811 ‚Äî Before You Dig</a>
        <a class="btn btn-primary justify-center" href="tel:18002221222">Poison Control</a>
      </div>
      <p class="text-[11px] mt-3 text-slate-500">Tap a number to call.</p>
    </section>
  </main>

  <!-- Footer -->
  <footer class="border-t bg-white">
    <div class="max-w-6xl mx-auto px-4 py-6 flex flex-col md:flex-row md:items-center justify-between gap-3">
      <div class="text-sm text-slate-500">¬© <span id="yr"></span> EagleReach. Built open-source.</div>
      <div class="flex items-center gap-2">
        <button class="btn btn-ghost" id="openAbout"><i data-feather="info"></i> About</button>
        <button class="btn btn-ghost" id="openFounder"><i data-feather="user"></i> Founder</button>
        <button class="btn btn-ghost" id="openContact"><i data-feather="mail"></i> Contact</button>
        <button class="btn btn-ghost" id="openFeedback"><i data-feather="message-square"></i> Feedback</button>
      </div>
    </div>
  </footer>

  <!-- Mobile menu (opens same modals) -->
  <dialog id="menuDlg" class="rounded-xl p-0 w-[92%] max-w-sm">
    <div class="p-4 border-b flex items-center justify-between">
      <div class="font-semibold">Menu</div>
      <button data-close="menuDlg"><i data-feather="x"></i></button>
    </div>
    <div class="p-4 space-y-2">
      <button class="btn w-full" id="openAbout_m"><i data-feather="info"></i> About</button>
      <button class="btn w-full" id="openFounder_m"><i data-feather="user"></i> Founder</button>
      <button class="btn w-full" id="openContact_m"><i data-feather="mail"></i> Contact</button>
      <button class="btn w-full" id="openFeedback_m"><i data-feather="message-square"></i> Feedback</button>
    </div>
  </dialog>

  <!-- Shared modal (desktop & mobile) -->
  <dialog id="infoDlg" class="rounded-xl p-0 w-[92%] max-w-2xl">
    <div class="p-4 border-b flex items-center justify-between">
      <div id="dlgTitle" class="font-semibold">Title</div>
      <button data-close="infoDlg" aria-label="Close"><i data-feather="x"></i></button>
    </div>
    <div id="dlgBody" class="p-6 space-y-4 text-slate-700 leading-relaxed"></div>
  </dialog>

  <!-- Scripts -->
  <script>
    feather.replace();
    document.getElementById('yr').textContent = new Date().getFullYear();

    // === CONFIG ===
    const API_BASE = 'https://eaglereach-1.onrender.com'; // <-- change if your backend URL is different

    // DOM
    const zipInput       = document.getElementById('zipInput');
    const geoLabel       = document.getElementById('geoLabel');
    const placeTag       = document.getElementById('placeTag');
    const repsList       = document.getElementById('repsList');
    const wxList         = document.getElementById('wxList');
    const cityList       = document.getElementById('cityList');
    const electionsBox   = document.getElementById('electionsBox');
    const openLocalNews  = document.getElementById('openLocalNews');
    const openWorldNews  = document.getElementById('openWorldNews');
    const openTraffic    = document.getElementById('openTraffic');

    openWorldNews.href = 'https://news.google.com/topstories?hl=en-US&gl=US&ceid=US:en';

    // helpers
    async function getJSON(url) {
      const r = await fetch(url);
      if (!r.ok) throw new Error('HTTP ' + r.status);
      return r.json();
    }
    function fmtDateISO(d) {
      const dt = new Date(d);
      if (isNaN(dt)) return d || '';
      return dt.toLocaleDateString(undefined, { weekday: 'short', month: '2-digit', day: '2-digit' });
    }

    // open/close dialog API
    const infoDlg  = document.getElementById('infoDlg');
    const dlgTitle = document.getElementById('dlgTitle');
    const dlgBody  = document.getElementById('dlgBody');
    function showDlg(title, html) {
      dlgTitle.textContent = title;
      dlgBody.innerHTML = html;
      infoDlg.showModal();
    }
    document.querySelectorAll('[data-close]').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.getAttribute('data-close');
        document.getElementById(id).close();
      });
    });

    // Modals (desktop)
    document.getElementById('openAbout').onclick = () => showDlg('About EagleReach', `
      <p><strong>Mission.</strong> A fast, trustworthy civic assistant that makes local government information‚Äîrepresentatives, elections, weather, traffic, and city updates‚Äîclear and accessible for every U.S. resident.</p>
      <ul class="list-disc pl-5 space-y-1">
        <li><strong>No logins.</strong> No tracking. Open data only.</li>
        <li><strong>Designed</strong> for clarity, accuracy, and speed.</li>
        <li><strong>Built</strong> to serve people across every community‚Äîequally.</li>
      </ul>
      <p class="italic">‚ÄúA nation, as a society, forms a moral person, and every member of it is personally responsible for his society.‚Äù ‚Äî Thomas Jefferson</p>
    `);
    document.getElementById('openFounder').onclick = () => showDlg('Founder', `
      <p><strong>Vikesh Sagar Bairam</strong> ‚Äî Founder of EagleReach. Tech Evangelist & Business Solutions Architect. Master‚Äôs in Information Systems & Management (University of Illinois, Springfield); Bachelors in Psychology; Bachelors in Computer Science. Currently at Jabil; previously with Surfaces by Pacific.</p>
      <p>Passionate about AI/ML, generative AI, DevOps, and data engineering‚Äîbuilding tools that bring government closer to people.</p>
      <div class="flex flex-wrap gap-2">
        <a class="btn btn-primary" target="_blank" rel="noopener" href="https://www.linkedin.com/in/vikesh-bairam-219769258/"><i data-feather="linkedin"></i> LinkedIn</a>
        <a class="btn btn-ghost" target="_blank" rel="noopener" href="https://github.com/vikesh2608"><i data-feather="github"></i> GitHub</a>
        <a class="btn btn-ghost" href="mailto:vikebairam@gmail.com"><i data-feather="mail"></i> Email</a>
      </div>
    `);
    document.getElementById('openContact').onclick = () => showDlg('Contact', `
      <p><strong>Email</strong>: <a class="text-brand-blue underline" href="mailto:vikebairam@gmail.com">vikebairam@gmail.com</a></p>
      <p><strong>LinkedIn</strong>: <a class="text-brand-blue underline" target="_blank" rel="noopener" href="https://www.linkedin.com/in/vikesh-bairam-219769258/">@vikesh-bairam</a></p>
      <p><strong>GitHub</strong>: <a class="text-brand-blue underline" target="_blank" rel="noopener" href="https://github.com/vikesh2608">github.com/vikesh2608</a></p>
    `);
    document.getElementById('openFeedback').onclick = () => showDlg('Feedback', `
      <form class="space-y-4" action="https://formspree.io/f/xayzdddd" method="POST">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div>
            <label class="kicker">Your name</label>
            <input name="name" class="w-full rounded-lg border border-slate-300 px-3 py-2" required />
          </div>
          <div>
            <label class="kicker">Email</label>
            <input name="email" type="email" class="w-full rounded-lg border border-slate-300 px-3 py-2" required />
          </div>
        </div>
        <div>
          <label class="kicker">Comments</label>
          <textarea name="comments" rows="4" class="w-full rounded-lg border border-slate-300 px-3 py-2" required></textarea>
        </div>
        <div class="flex items-center gap-2">
          <span class="kicker">Rating</span>
          <div class="flex gap-1 text-2xl">
            <label><input type="radio" name="stars" value="‚≠ê" class="hidden" /><span>‚≠ê</span></label>
            <label><input type="radio" name="stars" value="‚≠ê‚≠ê" class="hidden" /><span>‚≠ê</span></label>
            <label><input type="radio" name="stars" value="‚≠ê‚≠ê‚≠ê" class="hidden" /><span>‚≠ê</span></label>
            <label><input type="radio" name="stars" value="‚≠ê‚≠ê‚≠ê‚≠ê" class="hidden" /><span>‚≠ê</span></label>
            <label><input type="radio" name="stars" value="‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê" class="hidden" checked /><span>‚≠ê</span></label>
          </div>
        </div>
        <div class="flex items-center justify-end gap-2">
          <button type="button" class="btn" data-close="infoDlg">Cancel</button>
          <button type="submit" class="btn btn-primary">Send</button>
        </div>
      </form>
    `);

    // Modals (mobile menu opens same modals)
    document.getElementById('openAbout_m').onclick   = () => { document.getElementById('menuDlg').close(); document.getElementById('openAbout').click(); };
    document.getElementById('openFounder_m').onclick = () => { document.getElementById('menuDlg').close(); document.getElementById('openFounder').click(); };
    document.getElementById('openContact_m').onclick = () => { document.getElementById('menuDlg').close(); document.getElementById('openContact').click(); };
    document.getElementById('openFeedback_m').onclick= () => { document.getElementById('menuDlg').close(); document.getElementById('openFeedback').click(); };

    // Mobile menu open/close
    document.querySelectorAll('[data-open="menuDlg"]').forEach(btn => {
      btn.addEventListener('click', () => document.getElementById('menuDlg').showModal());
    });
    document.querySelectorAll('[data-close="menuDlg"]').forEach(btn => {
      btn.addEventListener('click', () => document.getElementById('menuDlg').close());
    });

    // Share/copy link
    document.getElementById('btnCopy').addEventListener('click', async () => {
      const u = new URL(location.href);
      const z = zipInput.value.trim();
      if (z) u.searchParams.set('zip', z); else u.searchParams.delete('zip');
      await navigator.clipboard.writeText(u.href);
      alert('Link copied!');
    });

    // Clear
    document.getElementById('btnClear').addEventListener('click', () => {
      zipInput.value = '';
      placeTag.textContent = '';
      geoLabel.textContent = '';
      history.replaceState({}, '', location.pathname);
      repsList.innerHTML = '';
      wxList.innerHTML = '';
      cityList.textContent = 'Enter a ZIP to load updates‚Ä¶';
      electionsBox.innerHTML = '';
    });

    // Buttons
    document.getElementById('btnSearch').addEventListener('click', runSearch);
    document.getElementById('btnLocate').addEventListener('click', locateMe);

    // Geolocate ‚Üí reverse ZIP
    async function locateMe() {
      geoLabel.textContent = 'Locating‚Ä¶';
      try {
        const pos = await new Promise((res, rej) =>
          navigator.geolocation.getCurrentPosition(res, rej, { enableHighAccuracy: true, timeout: 10000 })
        );
        const { latitude, longitude } = pos.coords;
        const data = await getJSON(`${API_BASE}/reverse-zip?lat=${latitude}&lon=${longitude}`);
        if (data && data.zip) {
          zipInput.value = data.zip;
          geoLabel.textContent = `${data.place || ''}${data.state ? ', ' + data.state : ''}`;
          runSearch();
        } else {
          geoLabel.textContent = 'Could not resolve ZIP from your location.';
        }
      } catch {
        geoLabel.textContent = 'Location permission denied or unavailable.';
      }
    }

    // Run full search flow
    async function runSearch() {
      const zip = zipInput.value.trim();
      if (!zip) return alert('Please enter a ZIP code');
      const u = new URL(location.href);
      u.searchParams.set('zip', zip);
      history.replaceState({}, '', u.href);

      // Basic place info
      try {
        const z = await getJSON(`${API_BASE}/zipinfo?zip=${zip}`);
        placeTag.textContent = `${zip} ‚Äî ${z.place || ''}${z.state ? ', ' + z.state : ''}`;
        openLocalNews.href = `https://news.google.com/search?q=${encodeURIComponent((z.place || zip) + ' ' + (z.state_abbr || ''))}&hl=en-US&gl=US&ceid=US:en`;
        openTraffic.href   = `https://www.google.com/maps/search/traffic/@${z.lat||0},${z.lon||0},12z`;
        document.getElementById('linkElectionOffice').href = `https://www.usa.gov/election-office`;
        // concerns
        document.getElementById('lnkPotholes').href = `https://www.google.com/search?q=${encodeURIComponent('report pothole ' + (z.place || zip))}`;
        document.getElementById('lnkTrash').href    = `https://www.google.com/search?q=${encodeURIComponent('trash complaint ' + (z.place || zip))}`;
        document.getElementById('lnkLights').href   = `https://www.google.com/search?q=${encodeURIComponent('street light out report ' + (z.place || zip))}`;
      } catch { placeTag.textContent = zip; }

      // Officials
      repsList.innerHTML = '<div class="text-sm text-slate-500">Loading‚Ä¶</div>';
      try {
        const data = await getJSON(`${API_BASE}/officials?zip=${zip}`);
        repsList.innerHTML = (data.officials || []).map(o => `
          <div class="rounded-xl border border-slate-200 p-3">
            <div class="font-semibold">${o.name} ‚Äî ${o.office || ''}${o.party ? ' ‚Äî ' + o.party : ''}</div>
            ${o.urls?.[0] ? `<div class="truncate"><a class="text-brand-blue underline text-sm break-all" target="_blank" href="${o.urls[0]}">${o.urls[0]}</a></div>` : ''}
            ${o.phones?.[0] ? `<div class="text-sm mt-1">üìû <a class="underline" href="tel:${o.phones[0]}">${o.phones[0]}</a></div>` : ''}
          </div>`).join('') || '<div class="text-sm text-slate-500">No officials found.</div>';
      } catch { repsList.innerHTML = '<div class="text-sm text-red-600">Failed to load officials.</div>'; }

      // Weather
      wxList.innerHTML = '<div class="text-sm text-slate-500">Loading‚Ä¶</div>';
      try {
        const data = await getJSON(`${API_BASE}/weather?zip=${zip}`);
        wxList.innerHTML = (data.days || []).map(d => `
          <div class="flex items-center justify-between">
            <div class="text-slate-600">${fmtDateISO(d.date)}</div>
            <div class="font-medium">${d.summary || ''}</div>
            <div class="text-slate-600">${Math.round(d.min)}¬∞ / ${Math.round(d.max)}¬∞</div>
          </div>`).join('') || '<div class="text-sm text-slate-500">No forecast available.</div>';
      } catch { wxList.innerHTML = '<div class="text-sm text-red-600">Failed to load weather.</div>'; }

      // Elections
      electionsBox.innerHTML = '<div class="text-sm text-slate-500">Loading‚Ä¶</div>';
      try {
        const data = await getJSON(`${API_BASE}/elections?zip=${zip}`);
        const next = data.next || {};
        electionsBox.innerHTML = `
          <div><strong>Next Federal:</strong> ${next.federal || '‚Äî'}</div>
          <div class="text-[11px] text-slate-500 mt-2">State/Local dates to follow via open data.</div>`;
      } catch { electionsBox.innerHTML = '<div class="text-sm text-red-600">Failed to load elections.</div>'; }

      // City updates
      try {
        const data = await getJSON(`${API_BASE}/city/updates?zip=${zip}`);
        if (!data || !data.items || !data.items.length) throw 0;
        cityList.innerHTML = data.items.map(i =>
          `<div class="mb-2"><span class="font-semibold">${i.type}:</span> ${i.detail} <span class="text-[11px] text-slate-500">${i.status||''}</span></div>`
        ).join('');
      } catch {
        cityList.textContent = 'No city updates available.';
      }
    }

    // Autoload if ?zip= present
    const qs = new URLSearchParams(location.search);
    if (qs.get('zip')) zipInput.value = qs.get('zip');
    if (zipInput.value) runSearch();
  </script>
</body>
</html>
