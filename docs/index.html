<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EagleReach</title>
  <link rel="icon" href="data:," />
  <!-- Tailwind CDN (for the card grid UI) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Soft card shadow + subtle transitions */
    .shadow-soft{ box-shadow: 0 8px 20px rgba(0,0,0,.06), 0 2px 8px rgba(0,0,0,.04); }
    .hover-raise{ transition: transform .15s ease, box-shadow .15s ease; }
    .hover-raise:hover{ transform: translateY(-1px); box-shadow: 0 10px 24px rgba(0,0,0,.08), 0 3px 10px rgba(0,0,0,.05); }
    /* Modal backdrop */
    .modal{ display:none; }
    .modal.open{ display:flex; }
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-800">

  <!-- Top bar -->
  <header class="bg-slate-800 text-white">
    <div class="max-w-6xl mx-auto px-4 sm:px-6">
      <div class="flex items-center justify-between py-3">
        <div class="flex items-center gap-2">
          <!-- Flag emoji and eagle mark -->
          <span class="text-xl">ü¶Ö</span>
          <h1 class="text-xl font-semibold tracking-tight">EagleReach <span class="text-slate-300 text-base align-top">us</span></h1>
        </div>

        <!-- Desktop nav -->
        <nav class="hidden sm:flex items-center gap-6 text-sm">
          <a href="#" data-open="about" class="hover:text-indigo-200">About</a>
          <a href="#" data-open="founder" class="hover:text-indigo-200">Founder</a>
          <a href="#" data-open="contact" class="hover:text-indigo-200">Contact</a>
          <a href="#" data-open="feedback" class="hover:text-indigo-200">Feedback</a>
        </nav>
      </div>

      <!-- Quote -->
      <p class="pb-4 text-xs sm:text-[13px] text-slate-200">
        ‚ÄúA nation, as a society, forms a moral person, and every member of it is personally responsible for his society.‚Äù ‚Äî Thomas Jefferson
      </p>
    </div>
  </header>

  <!-- Search row -->
  <section class="max-w-6xl mx-auto px-4 sm:px-6 mt-6">
    <p class="text-sm text-slate-600 mb-2">Enter your ZIP code to see representatives, voter info, weather, city updates, traffic, and elections.</p>
    <div class="flex flex-col sm:flex-row gap-3">
      <input id="zipInput" type="text" inputmode="numeric" maxlength="10" placeholder="ZIP (e.g., 62704)"
             class="w-full sm:w-64 rounded-md border border-slate-300 px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" />

      <div class="flex items-center gap-3">
        <button id="useLocationBtn" type="button"
          class="rounded-md bg-slate-100 hover:bg-slate-200 text-slate-800 px-3 py-2 shadow-sm">
          Use my location
        </button>

        <!-- tiny dot separator -->
        <span class="select-none text-slate-400">‚Ä¢</span>

        <button id="searchBtn" type="button"
          class="rounded-md bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 shadow-sm">
          Search
        </button>

        <button id="copyLinkBtn" type="button"
          class="rounded-md bg-slate-100 hover:bg-slate-200 text-slate-800 px-3 py-2 shadow-sm">
          Copy Share Link
        </button>

        <button id="clearBtn" type="button"
          class="rounded-md bg-slate-100 hover:bg-slate-200 text-slate-800 px-3 py-2 shadow-sm">
          Clear history
        </button>
      </div>
    </div>
    <div id="whoLine" class="mt-2 text-sm text-slate-500"></div>
  </section>

  <!-- Cards grid -->
  <main class="max-w-6xl mx-auto px-4 sm:px-6 mt-6 grid gap-5
               md:grid-cols-2 lg:grid-cols-3 auto-rows-min">

    <!-- Officials -->
    <section class="bg-white rounded-xl p-4 shadow-soft hover-raise">
      <div class="flex items-center justify-between">
        <h2 class="font-semibold">Elected Representatives</h2>
        <div class="flex gap-2">
          <button id="copyEmailsBtn" type="button" class="text-xs rounded-md bg-slate-100 px-2 py-1">Copy Emails</button>
          <button id="genEmailBtn" type="button" class="text-xs rounded-md bg-fuchsia-600 text-white px-2 py-1">Generate Email</button>
        </div>
      </div>
      <p class="mt-1 text-xs text-slate-400">Sources: GovTrack (Congress), Wikidata (Mayor), FCC, Zippopotam.</p>
      <div id="officialsList" class="mt-3 space-y-3 text-sm">
        <div class="text-slate-500">Enter a ZIP to load officials‚Ä¶</div>
      </div>
    </section>

    <!-- Weather -->
    <section class="bg-white rounded-xl p-4 shadow-soft hover-raise">
      <h2 class="font-semibold">Weather (7‚Äëday)</h2>
      <div id="weatherBox" class="mt-2 text-sm text-slate-500">Enter a ZIP to load weather‚Ä¶</div>
    </section>

    <!-- Voter info -->
    <section class="bg-white rounded-xl p-4 shadow-soft hover-raise">
      <h2 class="font-semibold">Voter Info & Education</h2>
      <ul class="mt-2 text-sm list-disc pl-5 space-y-1">
        <li><a class="text-indigo-600 hover:underline" target="_blank" href="https://www.usa.gov/how-to-vote">How to vote (USA.gov)</a></li>
        <li><a class="text-indigo-600 hover:underline" target="_blank" href="https://www.vote.org/register-to-vote/">Register to vote</a></li>
        <li><a class="text-indigo-600 hover:underline" target="_blank" href="https://www.vote.org/polling-place-locator/">Find your Election Office</a></li>
      </ul>
    </section>

    <!-- City updates -->
    <section class="bg-white rounded-xl p-4 shadow-soft hover-raise">
      <h2 class="font-semibold">City updates</h2>
      <div id="cityBox" class="mt-2 text-sm text-slate-500">Enter a ZIP to load updates‚Ä¶</div>
    </section>

    <!-- News -->
    <section class="bg-white rounded-xl p-4 shadow-soft hover-raise">
      <h2 class="font-semibold">News</h2>
      <div class="mt-3 flex gap-2">
        <a id="localNewsBtn" target="_blank" class="inline-block rounded-md bg-indigo-600 hover:bg-indigo-700 text-white text-sm px-3 py-2 shadow-sm">Open Local News</a>
        <a id="worldNewsBtn" target="_blank" class="inline-block rounded-md bg-slate-100 hover:bg-slate-200 text-sm px-3 py-2 shadow-sm">World News</a>
      </div>
      <p class="mt-2 text-xs text-slate-400">Opens news in a new tab.</p>
    </section>

    <!-- Elections -->
    <section class="bg-white rounded-xl p-4 shadow-soft hover-raise">
      <h2 class="font-semibold">Upcoming Elections</h2>
      <div id="elexBox" class="mt-2 text-sm text-slate-700">
        <div class="text-slate-500">Next Federal: November 3, 2025</div>
        <div class="text-xs text-slate-400">State/Local specific dates coming from open data.</div>
      </div>
    </section>

    <!-- Traffic -->
    <section class="bg-white rounded-xl p-4 shadow-soft hover-raise">
      <h2 class="font-semibold">Traffic</h2>
      <p class="mt-2 text-sm text-slate-500">Open live traffic for your area in Google Maps.</p>
      <button id="trafficBtn" type="button" class="mt-3 rounded-md bg-slate-100 hover:bg-slate-200 text-sm px-3 py-2 shadow-sm">Open Traffic Map</button>
    </section>

    <!-- Emergency -->
    <section class="bg-white rounded-xl p-4 shadow-soft hover-raise md:col-span-2">
      <h2 class="font-semibold">Emergency</h2>
      <div class="grid sm:grid-cols-3 lg:grid-cols-6 gap-3 mt-3 text-sm">
        <a href="tel:911" class="block text-center rounded-md py-2 font-medium text-white bg-rose-600 hover:bg-rose-700">911 ‚Äî Emergency</a>
        <a href="tel:988" class="block text-center rounded-md py-2 font-medium text-white bg-fuchsia-600 hover:bg-fuchsia-700">988 ‚Äî Suicide &amp; Crisis</a>
        <a href="tel:211" class="block text-center rounded-md py-2 font-medium text-white bg-emerald-600 hover:bg-emerald-700">211 ‚Äî Community Services</a>
        <a href="tel:311" class="block text-center rounded-md py-2 font-medium text-white bg-sky-600 hover:bg-sky-700">311 ‚Äî City Services</a>
        <a href="tel:811" class="block text-center rounded-md py-2 font-medium text-white bg-amber-600 hover:bg-amber-700">811 ‚Äî Before You Dig</a>
        <a href="tel:18002221222" class="block text-center rounded-md py-2 font-medium text-white bg-orange-600 hover:bg-orange-700">Poison Control</a>
      </div>
      <p class="text-xs text-slate-400 mt-2">Tap a number to call.</p>
    </section>

    <!-- Raise a concern -->
    <section class="bg-white rounded-xl p-4 shadow-soft hover-raise md:col-span-3">
      <h2 class="font-semibold">Raise a Concern</h2>
      <p class="mt-2 text-sm text-slate-500">Report city issues (311), contact your city hall, or write to your representatives.</p>
      <div class="mt-3 flex gap-2">
        <a id="concernPothole" class="text-indigo-600 hover:underline text-sm" href="#">Potholes</a>
        <a id="concernTrash" class="text-indigo-600 hover:underline text-sm" href="#">Trash</a>
        <a id="concernLights" class="text-indigo-600 hover:underline text-sm" href="#">Street lights</a>
      </div>
    </section>
  </main>

  <!-- Footer spacer -->
  <div class="h-10"></div>

  <!-- Modals (About, Founder, Contact, Feedback) -->
  <div id="modalBackdrop" class="modal fixed inset-0 z-40 items-center justify-center bg-black/50 p-4">
    <div class="w-full max-w-2xl rounded-xl bg-white shadow-soft relative">
      <button type="button" id="modalClose" class="absolute right-3 top-3 text-slate-400 hover:text-slate-700" aria-label="Close">‚úï</button>
      <div class="p-5">
        <h3 id="modalTitle" class="text-lg font-semibold"></h3>
        <div id="modalBody" class="mt-3 text-sm text-slate-700"></div>
      </div>
    </div>
  </div>

  <script>
    /* ------------------- Config ------------------- */
    const BACKEND = "https://eaglereach-1.onrender.com"; // your Render backend
    const qs = s => document.querySelector(s);

    /* ------------------- Elements ------------------- */
    const zipInput       = qs("#zipInput");
    const whoLine        = qs("#whoLine");
    const useLocationBtn = qs("#useLocationBtn");
    const searchBtn      = qs("#searchBtn");
    const copyLinkBtn    = qs("#copyLinkBtn");
    const clearBtn       = qs("#clearBtn");
    const officialsList  = qs("#officialsList");
    const weatherBox     = qs("#weatherBox");
    const cityBox        = qs("#cityBox");
    const elexBox        = qs("#elexBox");
    const trafficBtn     = qs("#trafficBtn");
    const localNewsBtn   = qs("#localNewsBtn");
    const worldNewsBtn   = qs("#worldNewsBtn");
    const copyEmailsBtn  = qs("#copyEmailsBtn");
    const genEmailBtn    = qs("#genEmailBtn");

    /* ------------------- Modals ------------------- */
    const modalBackdrop = qs("#modalBackdrop");
    const modalClose    = qs("#modalClose");
    const modalTitle    = qs("#modalTitle");
    const modalBody     = qs("#modalBody");

    const openModal = (title, html) => {
      modalTitle.textContent = title;
      modalBody.innerHTML = html;
      modalBackdrop.classList.add("open");
      document.body.style.overflow = "hidden";
    };
    const closeModal = () => {
      modalBackdrop.classList.remove("open");
      document.body.style.overflow = "";
    };
    modalBackdrop.addEventListener("click", (e)=> { if (e.target === modalBackdrop) closeModal(); });
    modalClose.addEventListener("click", closeModal);
    document.addEventListener("keydown", (e)=>{ if(e.key==="Escape") closeModal(); });

    // Desktop nav openers
    document.querySelectorAll('[data-open="about"]').forEach(a=>a.addEventListener("click",(e)=>{e.preventDefault();openAbout();}));
    document.querySelectorAll('[data-open="founder"]').forEach(a=>a.addEventListener("click",(e)=>{e.preventDefault();openFounder();}));
    document.querySelectorAll('[data-open="contact"]').forEach(a=>a.addEventListener("click",(e)=>{e.preventDefault();openContact();}));
    document.querySelectorAll('[data-open="feedback"]').forEach(a=>a.addEventListener("click",(e)=>{e.preventDefault();openFeedback();}));

    function openAbout(){
      openModal("About EagleReach", `
        <p>EagleReach is a public, open‚Äësource civic assistant that connects U.S. residents with elected officials, voting resources, weather, city context, traffic and emergency access ‚Äî fast and ad‚Äëfree.</p>
        <ul class="list-disc pl-5 mt-2 space-y-1">
          <li>Built with open data (GovTrack, FCC, Wikidata, Open‚ÄëMeteo, USGS, etc.).</li>
          <li>Designed for clarity and speed on mobile and desktop.</li>
          <li>Privacy‚Äërespecting and free to use.</li>
        </ul>
      `);
    }
    function openFounder(){
      openModal("Founder", `
        <p><strong>Vikesh Sagar Bairam</strong> ‚Äî Founder of EagleReach. Masters in Information Systems & Management (University of Illinois Springfield); Bachelors in Psychology and Computer Science. Tech evangelist & Solutions Architect, AI/ML & Data Engineer, DevOps Specialist, Research Professional. Previously at Surfaces by Pacific; currently at Jabil.</p>
      `);
    }
    function openContact(){
      openModal("Contact", `
        <ul class="space-y-2">
          <li>LinkedIn: <a class="text-indigo-600 hover:underline" target="_blank" href="https://www.linkedin.com/in/vikeshbairam/">Vikesh Bairam</a></li>
          <li>GitHub: <a class="text-indigo-600 hover:underline" target="_blank" href="https://github.com/vikesh2608">vikesh2608</a></li>
          <li>Email: <a class="text-indigo-600 hover:underline" href="mailto:vikebairam@gmail.com">vikebairam@gmail.com</a></li>
        </ul>
      `);
    }
    function openFeedback(){
      openModal("Feedback", `
        <form class="space-y-3" onsubmit="event.preventDefault(); alert('Thanks for your feedback!'); closeModal();">
          <div class="flex items-center gap-1 text-xl">Rate: 
            <span>‚≠ê</span><span>‚≠ê</span><span>‚≠ê</span><span>‚≠ê</span><span>‚≠ê</span>
          </div>
          <input class="w-full border border-slate-300 rounded-md px-3 py-2" placeholder="Your name" />
          <input class="w-full border border-slate-300 rounded-md px-3 py-2" placeholder="Email (optional)" />
          <textarea class="w-full border border-slate-300 rounded-md px-3 py-2" rows="4" placeholder="Comments"></textarea>
          <button class="rounded-md bg-indigo-600 text-white px-4 py-2">Send</button>
        </form>
      `);
    }

    /* ------------------- Helpers ------------------- */
    const setShareLinks = (zip) => {
      const u = new URL(location.href);
      u.searchParams.set("zip", zip);
      localNewsBtn.href = `https://news.google.com/search?q=${encodeURIComponent(zip)}&hl=en-US&gl=US&ceid=US:en`;
      worldNewsBtn.href = `https://news.google.com/topstories?hl=en-US&gl=US&ceid=US:en`;
      history.replaceState({}, "", u); // persist zip in URL
    };

    const clearUI = () => {
      officialsList.innerHTML = `<div class="text-slate-500">Enter a ZIP to load officials‚Ä¶</div>`;
      weatherBox.textContent  = "Enter a ZIP to load weather‚Ä¶";
      cityBox.textContent     = "Enter a ZIP to load updates‚Ä¶";
      whoLine.textContent     = "";
    };

    const prettyPlace = (z) => {
      // Use backend /officials result (which already resolves ZIP -> city/state) if available later
    };

    /* ------------------- Backend fetchers ------------------- */
    async function fetchJSON(url){
      const r = await fetch(url);
      if(!r.ok) throw new Error(`${r.status} ${r.statusText}`);
      return r.json();
    }

    async function loadOfficials(zip){
      try{
        const j = await fetchJSON(`${BACKEND}/officials?zip=${encodeURIComponent(zip)}`);
        const rows = j.officials || [];
        whoLine.textContent = `${j.zip} ‚Äî ${j.place}, ${j.state.abbr}`;
        setShareLinks(j.zip);
        officialsList.innerHTML = rows.map(o=>`
          <div class="rounded-lg border border-slate-200 p-3">
            <div><strong>${o.name}</strong> ‚Äî ${o.office}${o.party ? ` ‚Äî <span class="text-slate-500">${o.party}</span>`:``}</div>
            <div class="mt-1 flex items-center gap-3 text-sm">
              ${ (o.urls?.[0]) ? `<a class="text-indigo-600 hover:underline break-all" target="_blank" href="${o.urls[0]}">${new URL(o.urls[0]).hostname}</a>`:``}
              ${ (o.phones?.[0]) ? `<a class="text-slate-600 hover:underline" href="tel:${o.phones[0]}">${o.phones[0]}</a>`:``}
              ${ (o.emails?.[0]) ? `<a class="text-slate-600 hover:underline" href="mailto:${o.emails[0]}">${o.emails[0]}</a>`:``}
            </div>
          </div>
        `).join("") || `<div class="text-slate-500">No officials found.</div>`;
      }catch(e){
        officialsList.innerHTML = `<div class="text-rose-700">Could not load officials.</div>`;
      }
    }

    async function loadWeather(zip){
      try{
        const j = await fetchJSON(`${BACKEND}/weather?zip=${encodeURIComponent(zip)}`);
        const d = j.days || [];
        weatherBox.innerHTML = d.map(day => `
          <div class="flex items-center justify-between py-1 border-b border-slate-100">
            <div>${day.date}</div>
            <div class="text-slate-600">${day.summary || ""}</div>
            <div class="tabular-nums">${Math.round(day.tmin_c)}¬∞ / ${Math.round(day.tmax_c)}¬∞C</div>
          </div>
        `).join("") || `<div class="text-slate-500">No forecast.</div>`;
      }catch(e){
        weatherBox.textContent = "Weather temporarily unavailable.";
      }
    }

    async function loadCity(zip){
      try{
        const j = await fetchJSON(`${BACKEND}/city/updates?zip=${encodeURIComponent(zip)}`);
        const list = j.items || [];
        cityBox.innerHTML = list.slice(0,6).map(it => `
          <div class="py-1 border-b border-slate-100">
            <div class="font-medium">${it.type || it.title || "Update"}</div>
            <div class="text-xs text-slate-500">${it.detail || it.status || ""}</div>
            ${ it.address ? `<div class="text-xs text-slate-500">${it.address}</div>`:``}
          </div>
        `).join("") || `<div class="text-slate-500">No recent updates for this ZIP.</div>`;
      }catch(e){
        cityBox.textContent = "City updates unavailable.";
      }
    }

    /* ------------------- Actions ------------------- */
    async function doSearch(){
      const zip = zipInput.value.trim();
      if(!zip) return;
      localStorage.setItem("eagle_last_zip", zip);
      await Promise.allSettled([
        loadOfficials(zip),
        loadWeather(zip),
        loadCity(zip)
      ]);
    }

    searchBtn.addEventListener("click", doSearch);

    copyLinkBtn.addEventListener("click", ()=>{
      const url = new URL(location.href);
      const z = zipInput.value.trim();
      if(z) url.searchParams.set("zip", z);
      navigator.clipboard.writeText(url.toString()).then(()=> {
        copyLinkBtn.textContent = "Copied!";
        setTimeout(()=> copyLinkBtn.textContent="Copy Share Link", 1000);
      });
    });

    clearBtn.addEventListener("click", ()=>{
      localStorage.removeItem("eagle_last_zip");
      const u = new URL(location.href);
      u.searchParams.delete("zip");
      history.replaceState({}, "", u);
      zipInput.value = "";
      clearUI();
    });

    // Traffic map (uses current zip if available)
    trafficBtn.addEventListener("click", ()=>{
      const z = zipInput.value.trim();
      if (!z) return window.open("https://www.google.com/maps/@?api=1&map_action=map","_blank");
      window.open(`https://www.google.com/maps/search/?api=1&query=traffic+${encodeURIComponent(z)}`,"_blank");
    });

    // Email templates
    const concernOpen = (topic) => {
      const z = zipInput.value.trim();
      const subject = encodeURIComponent(`[${z||"ZIP"}] ${topic}`);
      const body = encodeURIComponent(`Hello,\n\nI‚Äôd like to report a ${topic.toLowerCase()} issue in my area (${z||"ZIP/City"}).\n\nDetails:\n‚Ä¢ Location:\n‚Ä¢ Description:\n\nThank you,\n`);
      location.href = `mailto:?subject=${subject}&body=${body}`;
    };
    qs("#concernPothole").addEventListener("click", e=>{e.preventDefault();concernOpen("Pothole");});
    qs("#concernTrash").addEventListener("click",   e=>{e.preventDefault();concernOpen("Trash");});
    qs("#concernLights").addEventListener("click",  e=>{e.preventDefault();concernOpen("Street Lights");});

    copyEmailsBtn.addEventListener("click", ()=>{
      const emails = [...officialsList.querySelectorAll('a[href^="mailto:"]')].map(a=>a.href.replace(/^mailto:/,''));
      navigator.clipboard.writeText(emails.join(", ")).then(()=>{
        copyEmailsBtn.textContent="Copied";
        setTimeout(()=>copyEmailsBtn.textContent="Copy Emails",1000);
      });
    });

    genEmailBtn.addEventListener("click", ()=>{
      const to = [...officialsList.querySelectorAll('a[href^="mailto:"]')].map(a=>a.href.replace(/^mailto:/,''));
      const subject = encodeURIComponent("Constituent message regarding local issue");
      const body = encodeURIComponent(`Dear Representative,\n\nI am writing regarding ‚Ä¶\n\nSincerely,\n`);
      if(to.length) location.href=`mailto:${encodeURIComponent(to.join(","))}?subject=${subject}&body=${body}`;
      else alert("No email addresses found yet.");
    });

    // Use my location -> zip + auto search
    useLocationBtn.addEventListener("click", ()=>{
      if(!navigator.geolocation){
        alert("Geolocation not supported in this browser.");
        return;
      }
      useLocationBtn.disabled = true;
      useLocationBtn.textContent = "Locating‚Ä¶";
      navigator.geolocation.getCurrentPosition(async (pos)=>{
        try{
          const {latitude, longitude} = pos.coords;
          // reverse ZIP from backend officials (fast)
          const r = await fetchJSON(`${BACKEND}/officials?zip=${encodeURIComponent(`${latitude},${longitude}`)}`);
          zipInput.value = r.zip || "";
          whoLine.textContent = `${r.zip} ‚Äî ${r.place}, ${r.state.abbr}`;
          await doSearch();
        }catch(e){
          alert("Could not resolve ZIP from your location.");
        }finally{
          useLocationBtn.disabled=false;
          useLocationBtn.textContent="Use my location";
        }
      }, ()=>{
        alert("Location permission denied.");
        useLocationBtn.disabled=false;
        useLocationBtn.textContent="Use my location";
      }, {enableHighAccuracy:true, timeout:10000});
    });

    /* ------------------- On load: restore zip ------------------- */
    (function init(){
      const urlZip = new URL(location.href).searchParams.get("zip");
      const last   = localStorage.getItem("eagle_last_zip");
      const seed   = urlZip || last || "";
      if(seed){
        zipInput.value = seed;
        doSearch();
      } else {
        clearUI();
      }
    })();
  </script>
</body>
</html>
