<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>EagleReach</title>
  <link rel="icon" href="data:,"/>
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .soft{box-shadow:0 10px 30px rgba(0,0,0,.08),0 2px 8px rgba(0,0,0,.05)}
    .btn{ @apply inline-flex items-center gap-2 rounded-md px-3.5 py-2.5 text-sm font-semibold transition; }
    .btn-surface{ @apply bg-white text-slate-700 border border-slate-200 hover:bg-slate-50; }
    .btn-primary{ @apply bg-blue-600 text-white hover:bg-blue-700; }
    .btn-ghost{ @apply text-slate-50/90 hover:text-white hover:bg-white/10 rounded-md px-3 py-2; }
    .pill{ @apply text-[11px] font-medium bg-slate-100 text-slate-600 rounded-full px-2 py-0.5; }
    /* Modal */
    .modal-backdrop{ @apply fixed inset-0 bg-slate-900/60 backdrop-blur-[2px] flex items-center justify-center z-[100]; }
    .modal-card{ @apply bg-white rounded-2xl p-6 w-full max-w-2xl soft relative; }
    /* Flag SVG in header scales nicely */
    .flag svg{height:22px;width:auto}
  </style>
</head>
<body class="bg-slate-50 text-slate-800">

  <!-- HEADER -->
  <header class="bg-slate-900 text-white sticky top-0 z-40 soft">
    <div class="max-w-7xl mx-auto px-4">
      <div class="flex items-center justify-between py-4 md:py-5">
        <div class="flex items-center gap-4">
          <span class="text-3xl md:text-4xl">ü¶Ö</span>
          <div>
            <div class="flex items-center gap-3">
              <h1 class="text-2xl md:text-3xl font-extrabold tracking-wide">EagleReach</h1>
              <div class="flag hidden sm:block">
                <!-- Minimal US flag (inline SVG) -->
                <svg viewBox="0 0 7410 3900" aria-hidden="true">
                  <rect width="7410" height="3900" fill="#b31942"/>
                  <g fill="#fff">
                    <rect y="300" width="7410" height="300"/>
                    <rect y="900" width="7410" height="300"/>
                    <rect y="1500" width="7410" height="300"/>
                    <rect y="2100" width="7410" height="300"/>
                    <rect y="2700" width="7410" height="300"/>
                    <rect y="3300" width="7410" height="300"/>
                  </g>
                  <rect width="2964" height="2100" fill="#0b3d91"/>
                </svg>
              </div>
            </div>
            <p class="mt-1 text-xs md:text-sm text-slate-200/90">
              ‚ÄúA nation, as a society, forms a moral person, and every member of it is personally responsible for his society.‚Äù
              ‚Äî Thomas Jefferson
            </p>
          </div>
        </div>

        <!-- Desktop nav -->
        <nav class="hidden md:flex items-center gap-1">
          <button data-open="about"    class="btn-ghost">About</button>
          <button data-open="founder"  class="btn-ghost">Founder</button>
          <button data-open="contact"  class="btn-ghost">Contact</button>
          <button data-open="feedback" class="btn-ghost">Feedback</button>
        </nav>

        <!-- Mobile menu -->
        <div class="md:hidden">
          <button id="menuBtn" class="btn-surface btn">‚ò∞ Menu</button>
        </div>
      </div>

      <!-- Mobile dropdown -->
      <div id="mobileMenu" class="hidden md:hidden pb-4">
        <div class="flex flex-col gap-1">
          <button data-open="about"    class="btn-ghost text-left">About</button>
          <button data-open="founder"  class="btn-ghost text-left">Founder</button>
          <button data-open="contact"  class="btn-ghost text-left">Contact</button>
          <button data-open="feedback" class="btn-ghost text-left">Feedback</button>
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="max-w-7xl mx-auto px-4 py-8">

    <!-- Search row -->
    <section class="soft bg-white rounded-2xl p-5 mb-6">
      <p class="text-sm text-slate-600">
        Enter your ZIP to see representatives, voter info, weather, city updates, traffic, and elections.
      </p>

      <div class="mt-3 grid grid-cols-1 md:grid-cols-12 gap-3">
        <div class="md:col-span-5">
          <input id="zipInput" class="w-full rounded-md border border-slate-300 px-3.5 py-2.5"
                 type="text" inputmode="numeric" maxlength="10" placeholder="ZIP (e.g., 62704)"/>
        </div>

        <div class="md:col-span-4 flex items-center gap-2">
          <button id="locBtn" class="btn btn-surface">üìç Use my location</button>
          <button id="searchBtn" class="btn btn-primary">üîé Search</button>
        </div>

        <div class="md:col-span-3 flex items-center gap-2">
          <button id="shareBtn" class="btn btn-surface">üîó Copy link</button>
          <button id="clearBtn" class="btn btn-surface">üßπ Clear history</button>
        </div>
      </div>

      <div id="where" class="mt-2 text-sm text-slate-500 hidden"></div>
    </section>

    <!-- Cards grid -->
    <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">

      <!-- Officials -->
      <div class="lg:col-span-1 soft bg-white rounded-2xl p-5">
        <div class="flex items-center justify-between">
          <h2 class="font-semibold text-lg">Elected Representatives</h2>
          <div class="flex items-center gap-2">
            <button id="copyEmailsBtn" class="btn btn-surface">üìã Copy Emails</button>
            <button id="genEmailBtn" class="btn btn-primary">‚úâÔ∏è Generate Email</button>
          </div>
        </div>
        <p class="text-xs mt-1 text-slate-500">
          Sources: GovTrack (Congress), Wikidata (Mayor), FCC, Zippopotam.
        </p>
        <div id="officials" class="mt-3 space-y-3"></div>
      </div>

      <!-- Weather + Voter -->
      <div class="lg:col-span-1 space-y-6">
        <div class="soft bg-white rounded-2xl p-5">
          <h2 class="font-semibold text-lg">Weather (7‚Äëday)</h2>
          <div id="weather" class="mt-3 text-sm text-slate-700">Enter a ZIP to load weather‚Ä¶</div>
        </div>

        <div class="soft bg-white rounded-2xl p-5">
          <h2 class="font-semibold text-lg">Voter Info & Education</h2>
          <ul class="mt-2 text-sm list-disc ml-5 space-y-1">
            <li><a class="text-blue-700 hover:underline" href="https://www.usa.gov/how-to-vote" target="_blank" rel="noopener">How to vote (USA.gov)</a></li>
            <li><a class="text-blue-700 hover:underline" href="https://vote.gov/" target="_blank" rel="noopener">Register to vote</a></li>
            <li><a class="text-blue-700 hover:underline" href="https://www.eac.gov/voters/election-day-contact-information" target="_blank" rel="noopener">Find your Election Office</a></li>
          </ul>
        </div>
      </div>

      <!-- City / Elections / Traffic / News -->
      <div class="lg:col-span-1 space-y-6">
        <div class="soft bg-white rounded-2xl p-5">
          <h2 class="font-semibold text-lg">City updates</h2>
          <div id="city" class="mt-2 text-sm text-slate-700">Enter a ZIP to load updates‚Ä¶</div>
        </div>

        <div class="soft bg-white rounded-2xl p-5">
          <h2 class="font-semibold text-lg">Upcoming Elections</h2>
          <div id="elections" class="mt-2 text-sm text-slate-700">
            Next Federal: November 3, 2025<br/>
            <span class="text-slate-500 text-xs">State/Local specific dates coming from open data.</span>
          </div>
        </div>

        <div class="soft bg-white rounded-2xl p-5">
          <h2 class="font-semibold text-lg">Traffic</h2>
          <p class="text-sm text-slate-600 mt-1">Open live traffic for your area in Google Maps.</p>
          <button id="trafficBtn" class="btn btn-surface mt-3">üó∫Ô∏è Open Traffic Map</button>
        </div>

        <div class="soft bg-white rounded-2xl p-5">
          <h2 class="font-semibold text-lg">News</h2>
          <div class="flex gap-2 mt-3">
            <a class="btn btn-primary" href="https://news.google.com/search?q=local%20news" target="_blank" rel="noopener">Open Local News</a>
            <a class="btn btn-surface" href="https://news.google.com/topstories?hl=en-US&gl=US&ceid=US:en" target="_blank" rel="noopener">World News</a>
          </div>
        </div>
      </div>
    </section>

    <!-- Concern + Emergency -->
    <section class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6">
      <div class="lg:col-span-2 soft bg-white rounded-2xl p-5">
        <h2 class="font-semibold text-lg">Raise a Concern</h2>
        <p class="text-sm text-slate-600 mt-1">Report city issues (311), contact your city hall, or write to your representatives.</p>
        <div class="flex flex-wrap gap-2 mt-3">
          <a class="btn btn-surface" id="concernPothole" href="#">Potholes</a>
          <a class="btn btn-surface" id="concernTrash" href="#">Trash</a>
          <a class="btn btn-surface" id="concernLights" href="#">Street lights</a>
        </div>
      </div>

      <div class="soft bg-white rounded-2xl p-5">
        <h2 class="font-semibold text-lg">Emergency</h2>
        <!-- Toned palette -->
        <div class="grid grid-cols-2 gap-2 mt-3">
          <a class="btn !justify-center text-white" style="background:#1f2937" href="tel:911">911 ‚Äî Emergency</a>
          <a class="btn !justify-center text-white" style="background:#374151" href="tel:988">988 ‚Äî Suicide &amp; Crisis</a>
          <a class="btn !justify-center text-white" style="background:#2563eb" href="tel:211">211 ‚Äî Community Services</a>
          <a class="btn !justify-center text-white" style="background:#3b82f6" href="tel:311">311 ‚Äî City Services</a>
          <a class="btn !justify-center text-white" style="background:#0ea5e9" href="tel:811">811 ‚Äî Before You Dig</a>
          <a class="btn !justify-center text-white" style="background:#0891b2" href="tel:18002221222">Poison Control</a>
        </div>
        <p class="text-xs text-slate-500 mt-2">Tap a number to call.</p>
      </div>
    </section>
  </main>

  <footer class="py-10 text-center text-xs text-slate-500">¬© 2025 EagleReach. Built open‚Äësource.</footer>

  <!-- MODAL HOST (nothing else on page) -->
  <div id="modalHost" class="hidden"></div>

  <script>
    // ------- CONFIG -------
    const API = "https://eaglereach-1.onrender.com";

    const zipInput  = document.getElementById('zipInput');
    const searchBtn = document.getElementById('searchBtn');
    const locBtn    = document.getElementById('locBtn');
    const shareBtn  = document.getElementById('shareBtn');
    const clearBtn  = document.getElementById('clearBtn');
    const trafficBtn= document.getElementById('trafficBtn');
    const whereEl   = document.getElementById('where');

    const officialsEl = document.getElementById('officials');
    const weatherEl   = document.getElementById('weather');
    const cityEl      = document.getElementById('city');

    const copyEmailsBtn = document.getElementById('copyEmailsBtn');
    const genEmailBtn   = document.getElementById('genEmailBtn');

    // Mobile menu
    document.getElementById('menuBtn')?.addEventListener('click', () => {
      document.getElementById('mobileMenu').classList.toggle('hidden');
    });

    // Modal openers (desktop & mobile)
    document.querySelectorAll('[data-open]').forEach(b=>{
      b.addEventListener('click', ()=>openModal(b.getAttribute('data-open')));
    });

    // URL restore
    const urlZip = new URLSearchParams(location.search).get('zip');
    if (urlZip) { zipInput.value = urlZip; run(); }
    // LocalStorage restore
    if (!zipInput.value) {
      const last = localStorage.getItem('er:lastZip');
      if (last) { zipInput.value = last; run(false); }
    }

    // Actions
    searchBtn.addEventListener('click', run);
    zipInput.addEventListener('keydown', e=>{ if(e.key==='Enter') run(); });

    shareBtn.addEventListener('click', () => {
      const z = zipInput.value.trim();
      const link = z ? `${location.origin}${location.pathname}?zip=${encodeURIComponent(z)}` : location.href;
      navigator.clipboard.writeText(link).then(()=>toast('Link copied.'));
    });

    clearBtn.addEventListener('click', () => {
      localStorage.removeItem('er:lastZip');
      zipInput.value = '';
      whereEl.classList.add('hidden');
      officialsEl.innerHTML = '';
      weatherEl.textContent = 'Enter a ZIP to load weather‚Ä¶';
      cityEl.textContent = 'Enter a ZIP to load updates‚Ä¶';
      toast('History cleared.');
    });

    // Use my location (with fallbacks)
    locBtn.addEventListener('click', async () => {
      try {
        const pos = await new Promise((res, rej)=>
          navigator.geolocation.getCurrentPosition(res, rej, {enableHighAccuracy:true, timeout:12000})
        );
        const {latitude:lat, longitude:lon} = pos.coords;
        whereEl.classList.remove('hidden');
        whereEl.textContent = 'Locating‚Ä¶';

        // Reverse geocode #1
        let postal = '';
        try {
          const r = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`);
          const j = await r.json();
          postal = j.postcode || j.postalCode || '';
        } catch {}
        // Fallback #2
        if (!postal) {
          try {
            const r2 = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`);
            const j2 = await r2.json();
            postal = j2?.address?.postcode || '';
          } catch {}
        }

        if (!postal) { alert('Could not resolve ZIP from your location.'); whereEl.classList.add('hidden'); return; }
        zipInput.value = postal.replace(/\s+/g,'').slice(0,10);
        run();
      } catch {
        alert('Could not resolve ZIP from your location.');
      }
    });

    trafficBtn.addEventListener('click', ()=>{
      const z=zipInput.value.trim();
      if(!z){ toast('Enter a ZIP first.'); return; }
      window.open(`https://www.google.com/maps/search/${encodeURIComponent(z)}+traffic`, '_blank');
    });

    copyEmailsBtn.addEventListener('click', ()=>{
      const emails = Array.from(officialsEl.querySelectorAll('[data-email]'))
        .map(el=>el.getAttribute('data-email')).filter(Boolean);
      if(emails.length===0){ toast('No emails available.'); return; }
      navigator.clipboard.writeText(emails.join(', ')).then(()=>toast('Emails copied.'));
    });

    genEmailBtn.addEventListener('click', ()=>{
      const names = Array.from(officialsEl.querySelectorAll('[data-name]')).map(el=>el.getAttribute('data-name'));
      const z = zipInput.value.trim();
      const subject = encodeURIComponent(`Constituent from ${z} ‚Äî Community concerns`);
      const body = encodeURIComponent(
`Dear Representative,

I‚Äôm a resident of ZIP ${z}. I‚Äôd like to raise a few local concerns and would appreciate your guidance on next steps.

‚Ä¢ Topic 1
‚Ä¢ Topic 2
‚Ä¢ Topic 3

Thank you for your service.

Sincerely,
[Your Name]`);
      location.href = `mailto:?subject=${subject}&body=${body}`;
    });

    // Main fetches
    async function run(save=true){
      const zip = zipInput.value.trim();
      if(!zip){ toast('Enter a ZIP.'); return; }
      if(save) localStorage.setItem('er:lastZip', zip);
      history.replaceState(null,'',`?zip=${encodeURIComponent(zip)}`);

      // Officials
      try{
        officialsEl.innerHTML='<div class="text-sm text-slate-500">Loading officials‚Ä¶</div>';
        const r = await fetch(`${API}/officials?zip=${encodeURIComponent(zip)}`);
        if(!r.ok) throw 0;
        const j = await r.json();
        renderOfficials(j);
        if (j.place && j.state && j.state.abbr) {
          whereEl.textContent = `${zip} ‚Äî ${j.place}, ${j.state.abbr}`;
          whereEl.classList.remove('hidden');
        }
      }catch{ officialsEl.innerHTML='<div class="text-sm text-rose-600">Could not load officials.</div>'; }

      // Weather
      try{
        const r = await fetch(`${API}/weather?zip=${encodeURIComponent(zip)}`);
        if(!r.ok) throw 0;
        const j = await r.json();
        renderWeather(j);
      }catch{ weatherEl.textContent='Weather temporarily unavailable.'; }

      // City updates placeholder (activate when endpoint ready)
      cityEl.textContent='City updates will appear here as they become available.';
    }

    function renderOfficials(j){
      const rows=j.officials||[];
      if(rows.length===0){ officialsEl.innerHTML='<div class="text-sm text-slate-600">Enter a ZIP to load officials‚Ä¶</div>'; return; }
      officialsEl.innerHTML = rows.map(o=>{
        const phone=(o.phones&&o.phones[0])||'';
        const site =(o.urls&&o.urls[0])||'';
        const email=''; // GovTrack rarely exposes direct emails
        const party=o.party?` ‚Äî <span class="text-slate-500">${escapeHtml(o.party)}</span>`:'';
        const tel = phone?`<div class="mt-1 text-sm"><a class="text-blue-700 hover:underline" href="tel:${phone.replace(/[^0-9+]/g,'')}">${phone}</a></div>`:'';
        const url = site ?`<div class="mt-1 text-sm"><a class="text-blue-700 hover:underline" href="${site}" target="_blank" rel="noopener">${site.replace(/^https?:\/\//,'')}</a></div>`:'';
        return `
          <div class="rounded-xl border border-slate-200 p-3">
            <div class="font-medium" data-name="${escapeHtml(o.name||'')}">${escapeHtml(o.name||'')}</div>
            <div class="text-sm text-slate-600">${escapeHtml(o.office||'')}${party}</div>
            ${url}${tel}
            <span class="hidden" data-email="${escapeHtml(email)}"></span>
          </div>`;
      }).join('');
    }

    function renderWeather(j){
      const days=j.days||[];
      if(days.length===0){ weatherEl.textContent='No forecast available.'; return; }
      weatherEl.innerHTML = days.map(d=>`
        <div class="flex items-center justify-between border-b last:border-none py-2">
          <div class="text-sm">${d.date}</div>
          <div class="flex items-center gap-3">
            <span class="pill">${iconFor(d)}</span>
            <div class="text-sm">${Math.round(d.tmin_c)}¬∞ / ${Math.round(d.tmax_c)}¬∞C</div>
            <div class="text-xs text-slate-500">${d.precip_pct ?? 0}%</div>
          </div>
        </div>`).join('');
    }
    function iconFor(d){ const p=d.precip_pct??0; if(p>=60) return 'üåßÔ∏è Rain'; if(p>=20) return '‚òÅÔ∏è Cloudy'; return '‚òÄÔ∏è Clear'; }
    const escapeHtml = s=>(s||'').replace(/[&<>"']/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c]));
    function toast(msg){ const el=document.createElement('div'); el.className='fixed bottom-5 left-1/2 -translate-x-1/2 bg-slate-900 text-white text-sm px-3 py-2 rounded-md soft z-[200]'; el.textContent=msg; document.body.appendChild(el); setTimeout(()=>el.remove(),1800); }

    // ------- MODALS -------
    const modalHost=document.getElementById('modalHost');
    function closeModal(){ modalHost.className='hidden'; modalHost.innerHTML=''; }
    function openModal(kind){
      let title='',html='';
      if(kind==='about'){
        title='About EagleReach';
        html=`<p class="text-slate-700 leading-relaxed">
          EagleReach is a public, open-source civic assistant that connects residents with their elected officials, nearby services,
          and local context such as weather, traffic, and city updates‚Äîall in one place. No sign‚Äëins. No tracking. Fast and free for everyone.
        </p>`;
      }else if(kind==='founder'){
        title='Founder';
        html=`<p class="text-slate-700">
          <strong>Vikesh Sagar Bairam</strong> ‚Äî Founder of EagleReach. Tech Evangelist & Business Solutions Architect.
          Master‚Äôs in Information Systems & Management (University of Illinois, Springfield). Bachelor‚Äôs in Psychology and
          Bachelor‚Äôs in Computer Science. Currently at Jabil; previously at Surfaces by Pacific. Passionate about AI/ML, Generative AI,
          DevOps, and data engineering‚Äîbuilding tools that bring government closer to people.
        </p>`;
      }else if(kind==='contact'){
        title='Contact';
        html=`<div class="space-y-2 text-slate-700">
          <div>LinkedIn: <a class="text-blue-700 hover:underline" href="https://www.linkedin.com/in/vikesh-bairam-219769258/" target="_blank" rel="noopener">vikesh-bairam-219769258</a></div>
          <div>GitHub: <a class="text-blue-700 hover:underline" href="https://github.com/vikesh2608" target="_blank" rel="noopener">vikesh2608</a></div>
          <div>Email: <a class="text-blue-700 hover:underline" href="mailto:vikebairam@gmail.com">vikebairam@gmail.com</a></div>
        </div>`;
      }else if(kind==='feedback'){
        title='Feedback & Comments';
        html=`<form id="fbForm" class="space-y-4">
          <div><label class="block text-sm mb-1">Your name (optional)</label>
            <input name="name" class="w-full rounded-md border border-slate-300 px-3 py-2" placeholder="Name"/></div>
          <div><label class="block text-sm mb-1">Email (optional)</label>
            <input name="email" type="email" class="w-full rounded-md border border-slate-300 px-3 py-2" placeholder="you@example.com"/></div>
          <div>
            <label class="block text-sm mb-1">Rating</label>
            <div class="flex gap-1 text-2xl" id="stars"><button type="button">‚òÜ</button><button type="button">‚òÜ</button><button type="button">‚òÜ</button><button type="button">‚òÜ</button><button type="button">‚òÜ</button></div>
            <input type="hidden" name="rating" value="0">
          </div>
          <div>
            <label class="block text-sm mb-1">Comments</label>
            <textarea name="txt" rows="4" class="w-full rounded-md border border-slate-300 px-3 py-2" placeholder="Your thoughts‚Ä¶"></textarea>
          </div>
          <button class="btn btn-primary" type="submit">Send</button>
        </form>`;
      }
      modalHost.className='';
      modalHost.innerHTML=`
        <div class="modal-backdrop" role="dialog" aria-modal="true">
          <div class="modal-card">
            <button class="btn btn-surface absolute right-3 top-3" id="closeModal">‚úï</button>
            <h3 class="text-lg font-semibold mb-3">${title}</h3>
            ${html}
          </div>
        </div>`;
      document.getElementById('closeModal').onclick=closeModal;
      modalHost.querySelector('.modal-backdrop').addEventListener('click',(e)=>{ if(e.target.classList.contains('modal-backdrop')) closeModal(); });

      if(kind==='feedback'){
        const stars=modalHost.querySelectorAll('#stars button');
        const ratingInput=modalHost.querySelector('input[name="rating"]');
        stars.forEach((b,i)=>b.addEventListener('click',()=>{ const r=i+1; ratingInput.value=r; stars.forEach((s,j)=>s.textContent=j<r?'‚òÖ':'‚òÜ'); }));
        modalHost.querySelector('#fbForm').addEventListener('submit',e=>{
          e.preventDefault();
          const f=new FormData(e.target);
          const subject=encodeURIComponent(`EagleReach feedback ‚Äî ${f.get('rating')||0}‚òÖ`);
          const body=encodeURIComponent(`Name: ${f.get('name')||''}\nEmail: ${f.get('email')||''}\nRating: ${f.get('rating')||0} stars\n\n${f.get('txt')||''}\n`);
          location.href=`mailto:vikebairam@gmail.com?subject=${subject}&body=${body}`;
        });
      }
    }
  </script>
</body>
</html>
