<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EagleReach</title>
  <link rel="icon" href="data:," />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .hero { background: linear-gradient(90deg,#0b3d91 0%,#143b6b 50%,#202a44 100%); }
    .shadow-soft { box-shadow: 0 12px 28px rgba(2,8,20,.15), 0 6px 10px rgba(2,8,20,.08); }
    .nav-btn:hover { opacity:.9; }
    .panel { display:none; }
    .panel.open { display:block; }
    html { scroll-behavior: smooth; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <!-- Header -->
  <header class="hero text-white">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-3 sm:py-4 flex items-center justify-between gap-3">
      <div class="flex items-center gap-2 sm:gap-3">
        <div class="flex items-center gap-2 text-2xl sm:text-3xl leading-none">
          <span aria-hidden="true">ü¶Ö</span>
          <h1 class="font-semibold tracking-tight">EagleReach</h1>
          <span class="text-2xl sm:text-3xl" aria-hidden="true">üá∫üá∏</span>
        </div>
      </div>
      <nav class="flex items-center gap-3 text-[13px] sm:text-sm">
        <button id="aboutBtn" class="nav-btn opacity-90">About</button>
        <button id="founderBtn" class="nav-btn opacity-90">Founder</button>
        <button id="contactBtn" class="nav-btn opacity-90">Contact</button>
        <a href="#feedback" class="nav-btn opacity-90">Feedback</a>
      </nav>
    </div>
    <div class="max-w-6xl mx-auto px-4 sm:px-6 pb-3 sm:pb-4">
      <p class="text-[11px] sm:text-xs opacity-90">
        ‚ÄúA nation, as a society, forms a moral person, and every member of it is personally responsible for his society.‚Äù ‚Äî Thomas Jefferson
      </p>
    </div>
  </header>

  <!-- Search -->
  <section class="max-w-6xl mx-auto px-4 sm:px-6 mt-4 sm:mt-6">
    <p class="text-slate-600 text-sm sm:text-base mb-2">
      Enter your ZIP code to see representatives, voter info, weather, city updates, traffic, and elections.
    </p>
    <div class="flex flex-wrap items-center gap-2">
      <input id="zipInput" class="w-44 sm:w-56 border rounded-md px-3 py-2 text-sm sm:text-base" type="text" inputmode="numeric" maxlength="10" placeholder="ZIP (e.g., 62704)" />
      <button id="locBtn" class="px-3 py-2 rounded-md bg-slate-200 hover:bg-slate-300 text-sm sm:text-base">Use my location</button>
      <span class="opacity-60 select-none hidden sm:inline">‚Ä¢</span>
      <button id="searchBtn" class="px-3 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 text-sm sm:text-base">Search</button>
      <button id="shareBtn" class="px-3 py-2 rounded-md bg-slate-100 hover:bg-slate-200 text-sm sm:text-base">Copy Share Link</button>
      <button id="clearBtn" class="px-3 py-2 rounded-md bg-slate-100 hover:bg-slate-200 text-sm sm:text-base">Clear history</button>
    </div>
    <div id="placeLine" class="text-sm text-slate-700 mt-2"></div>
    <div id="status" class="text-xs text-slate-500 mt-1"></div>
    <div id="history" class="flex gap-2 mt-2 flex-wrap"></div>
  </section>

  <!-- Content grid -->
  <main class="max-w-6xl mx-auto px-4 sm:px-6 my-5 sm:my-6 grid md:grid-cols-3 gap-4 sm:gap-5">
    <!-- Representatives -->
    <section class="md:col-span-2 bg-white rounded-xl p-4 sm:p-5 shadow-soft">
      <div class="flex items-center justify-between gap-3">
        <h2 class="font-semibold text-lg">Elected Representatives</h2>
        <div class="flex gap-2">
          <button id="copyEmailsBtn" class="px-2 py-1 text-sm rounded-md bg-slate-100 hover:bg-slate-200">Copy Emails</button>
          <button id="genEmailBtn" class="px-2 py-1 text-sm rounded-md bg-violet-600 text-white hover:bg-violet-700">Generate Email</button>
        </div>
      </div>
      <div id="repsList" class="mt-3 space-y-3"></div>
      <p class="text-xs text-slate-500 mt-2">Sources: GovTrack (Congress), Wikidata (Mayor), FCC, Zippopotam.</p>
    </section>

    <!-- Weather -->
    <section class="bg-white rounded-xl p-4 sm:p-5 shadow-soft">
      <h2 class="font-semibold text-lg">Weather (7‚Äëday)</h2>
      <div id="wxList" class="mt-3 space-y-2 text-sm"></div>
      <p id="wxMeta" class="text-xs text-slate-500 mt-2"></p>
    </section>

    <!-- Voter info & education -->
    <section class="md:col-span-2 bg-white rounded-xl p-4 sm:p-5 shadow-soft">
      <h2 class="font-semibold text-lg">Voter Info & Education</h2>
      <div id="voterLinks" class="mt-3 grid sm:grid-cols-2 md:grid-cols-3 gap-3"></div>
    </section>

    <!-- City Updates -->
    <section class="bg-white rounded-xl p-4 sm:p-5 shadow-soft">
      <h2 class="font-semibold text-lg">City updates</h2>
      <div id="cityList" class="mt-3 space-y-2 text-sm"></div>
      <p id="cityMeta" class="text-xs text-slate-500 mt-2"></p>
    </section>

    <!-- News -->
    <section class="bg-white rounded-xl p-4 sm:p-5 shadow-soft">
      <h2 class="font-semibold text-lg">News</h2>
      <div class="mt-3 flex flex-col gap-2">
        <a id="localNews" class="px-3 py-2 rounded-md bg-blue-600 text-white text-center hover:bg-blue-700" target="_blank" rel="noopener">Open Local News</a>
        <a id="worldNews" class="px-3 py-2 rounded-md bg-slate-100 text-center hover:bg-slate-200" target="_blank" rel="noopener">World News</a>
      </div>
    </section>

    <!-- Upcoming Elections -->
    <section class="bg-white rounded-xl p-4 sm:p-5 shadow-soft">
      <h2 class="font-semibold text-lg">Upcoming Elections</h2>
      <div id="elex" class="mt-2 text-sm"></div>
    </section>

    <!-- Traffic -->
    <section class="bg-white rounded-xl p-4 sm:p-5 shadow-soft">
      <h2 class="font-semibold text-lg">Traffic</h2>
      <p class="text-sm text-slate-600 mt-2">Open live traffic for your area in Google Maps.</p>
      <a id="trafficBtn" class="mt-3 inline-block px-3 py-2 rounded-md bg-slate-100 hover:bg-slate-200" target="_blank" rel="noopener">Open Traffic Map</a>
    </section>

    <!-- Emergency -->
    <section class="bg-white rounded-xl p-4 sm:p-5 shadow-soft">
      <h2 class="font-semibold text-lg">Emergency</h2>
      <div class="mt-3 grid grid-cols-2 gap-2 text-sm">
        <a class="px-3 py-2 rounded-md bg-red-600 text-white text-center hover:bg-red-700" href="tel:911">911 ‚Äî Emergency</a>
        <a class="px-3 py-2 rounded-md bg-indigo-600 text-white text-center hover:bg-indigo-700" href="tel:988">988 ‚Äî Suicide & Crisis</a>
        <a class="px-3 py-2 rounded-md bg-emerald-600 text-white text-center hover:bg-emerald-700" href="tel:211">211 ‚Äî Community Services</a>
        <a class="px-3 py-2 rounded-md bg-sky-600 text-white text-center hover:bg-sky-700" href="tel:311">311 ‚Äî City Services</a>
        <a class="px-3 py-2 rounded-md bg-amber-600 text-white text-center hover:bg-amber-700" href="tel:811">811 ‚Äî Before You Dig</a>
        <a class="px-3 py-2 rounded-md bg-orange-600 text-white text-center hover:bg-orange-700" href="tel:18002221222">Poison Control</a>
      </div>
      <p class="text-xs text-slate-500 mt-2">Tap a number to call.</p>
    </section>

    <!-- Raise a concern -->
    <section class="md:col-span-3 bg-white rounded-xl p-4 sm:p-5 shadow-soft">
      <h2 class="font-semibold text-lg">Raise a Concern</h2>
      <p class="text-sm text-slate-600">Report city issues (311), contact your city hall, or write to your representatives.</p>
      <div class="mt-3 flex flex-wrap gap-2">
        <button class="concernBtn px-3 py-2 rounded-md bg-slate-100 hover:bg-slate-200" data-type="potholes">Potholes</button>
        <button class="concernBtn px-3 py-2 rounded-md bg-slate-100 hover:bg-slate-200" data-type="trash">Trash</button>
        <button class="concernBtn px-3 py-2 rounded-md bg-slate-100 hover:bg-slate-200" data-type="street-lights">Street lights</button>
      </div>
    </section>
  </main>

  <!-- Feedback & Comments (BOTTOM SECTION) -->
  <section id="feedback" class="max-w-6xl mx-auto px-4 sm:px-6 mb-10">
    <div class="bg-white rounded-xl p-4 sm:p-5 shadow-soft">
      <h2 class="font-semibold text-lg">Feedback & Comments</h2>
      <p class="text-sm text-slate-600 mt-1">Rate EagleReach and leave a note‚Äîyour ideas help improve this public service.</p>
      <div class="mt-3">
        <label class="text-sm text-slate-600">Rating</label>
        <div id="stars" class="mt-1 flex gap-1 text-2xl cursor-pointer select-none" aria-label="star rating">‚≠ê ‚≠ê ‚≠ê ‚≠ê ‚≠ê</div>
      </div>
      <div class="mt-3 grid sm:grid-cols-2 gap-3">
        <input id="fbName" class="border rounded-md px-3 py-2" placeholder="Your name" />
        <input id="fbEmail" class="border rounded-md px-3 py-2" placeholder="Email (optional)" />
      </div>
      <textarea id="fbMsg" class="w-full border rounded-md px-3 py-2 mt-3" rows="5" placeholder="Your feedback..."></textarea>
      <button id="fbSend" class="mt-3 px-3 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">Send</button>
      <p class="text-xs text-slate-500 mt-2">This opens your email client and sends feedback directly to the founder.</p>
    </div>
  </section>

  <!-- Footer -->
  <footer class="max-w-6xl mx-auto px-4 sm:px-6 mb-10 text-xs text-slate-500">
    ¬© 2025 EagleReach by Vikesh Sagar Bairam. All rights reserved.
  </footer>

  <!-- Slide panels (About/Founder/Contact) -->
  <div id="overlay" class="fixed inset-0 bg-black/40 hidden"></div>

  <aside id="aboutPanel" class="panel fixed right-0 top-0 h-full w-full sm:w-[560px] bg-white shadow-2xl overflow-y-auto">
    <div class="p-5 border-b flex justify-between items-center">
      <h3 class="text-lg font-semibold">About EagleReach</h3>
      <button class="closePanel px-2 py-1 rounded-md bg-slate-100">‚úï</button>
    </div>
    <div class="p-5 space-y-4 text-[15px] leading-relaxed">
      <p><strong>EagleReach</strong> is a public, open‚Äësource civic assistant for U.S. residents. One ZIP code unlocks what people need right now‚Äîyour elected representatives with official links and phone numbers, voter information and education, election dates, weather, city updates, traffic, and trustworthy resources.</p>
      <p><strong>Why this exists.</strong> Democracy works best when access is simple. EagleReach brings civic info together‚Äîcleanly, quickly, and without tracking‚Äîso kids, students, professionals, elders, and officials can act together.</p>
      <ul class="list-disc pl-5">
        <li>100% <strong>open data</strong>, no sign‚Äëin, no paywalls, no tracking.</li>
        <li><strong>Frictionless UX</strong>: one place, one search, human‚Äëreadable results.</li>
        <li><strong>Trustworthy sources</strong> (GovTrack, state election sites, Open‚ÄëMeteo, city open data).</li>
        <li><strong>Accessibility first</strong>: large touch targets, keyboard friendly, mobile‚Äëready.</li>
        <li><strong>Extensible</strong>: easy to add cities, states, and services.</li>
      </ul>
      <p><strong>Vision.</strong> To make civic participation as easy as checking the weather‚Äîso every resident can be informed, every official reachable, and every community can move forward together.</p>
    </div>
  </aside>

  <aside id="founderPanel" class="panel fixed right-0 top-0 h-full w-full sm:w-[560px] bg-white shadow-2xl overflow-y-auto">
    <div class="p-5 border-b flex justify-between items-center">
      <h3 class="text-lg font-semibold">Founder</h3>
      <button class="closePanel px-2 py-1 rounded-md bg-slate-100">‚úï</button>
    </div>
    <div class="p-5 space-y-4 text-[15px] leading-relaxed">
      <p><strong>Vikesh Sagar Bairam</strong> ‚Äî <em>Founder of EagleReach ‚Ä¢ Tech Evangelist & Business Solutions Architect ‚Ä¢ AI/ML & Data Engineer ‚Ä¢ DevOps Specialist ‚Ä¢ Generative‚ÄëAI Builder</em></p>
      <ul class="list-disc pl-5">
        <li>Master‚Äôs in Information Systems & Management (University of Illinois, Springfield)</li>
        <li>Bachelor‚Äôs in Psychology; Bachelor‚Äôs in Computer Science</li>
        <li>Currently at <strong>Jabil</strong> (previously <strong>Surfaces by Pacific</strong>)</li>
      </ul>
      <p>I build human‚Äëcentered systems that remove friction and amplify public good. EagleReach was created to make civic access fast, respectful, and beautiful‚Äîso any resident can understand what‚Äôs happening, who represents them, and how to act‚Äîwithout barriers.</p>
    </div>
  </aside>

  <aside id="contactPanel" class="panel fixed right-0 top-0 h-full w-full sm:w-[460px] bg-white shadow-2xl overflow-y-auto">
    <div class="p-5 border-b flex justify-between items-center">
      <h3 class="text-lg font-semibold">Contact</h3>
      <button class="closePanel px-2 py-1 rounded-md bg-slate-100">‚úï</button>
    </div>
    <div class="p-5 space-y-3 text-[15px]">
      <p><a class="text-blue-700 hover:underline" href="https://www.linkedin.com/in/vikesh-bairam-219769258/" target="_blank">LinkedIn</a></p>
      <p><a class="text-blue-700 hover:underline" href="https://github.com/Vikesh2608" target="_blank">GitHub</a></p>
      <p><a class="text-blue-700 hover:underline" href="mailto:vikebairam@gmail.com">vikebairam@gmail.com</a></p>
    </div>
  </aside>

  <script>
    // -------------------- Config --------------------
    const BACKEND = "https://eaglereach-1.onrender.com";

    // -------------------- Panels (Back + Esc) -------
    const overlay = document.getElementById('overlay');
    let currentPanel = null;
    function openPanel(id, hash){
      document.getElementById(id).classList.add('open');
      overlay.classList.remove('hidden');
      currentPanel = id;
      if (hash) history.pushState({panel:id}, "", hash);
    }
    function closePanels(){
      document.querySelectorAll('.panel').forEach(p=>p.classList.remove('open'));
      overlay.classList.add('hidden');
      currentPanel = null;
      // If there is a hash set for a panel, go back to root hash without creating a new history entry
      if (location.hash === '#about' || location.hash === '#founder' || location.hash === '#contact') {
        history.pushState({}, "", location.pathname + location.search);
      }
    }
    overlay.addEventListener('click', closePanels);
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closePanels(); });
    window.addEventListener('popstate', ()=>{ closePanels(); });

    document.getElementById('aboutBtn').onclick   = ()=>openPanel('aboutPanel',   '#about');
    document.getElementById('founderBtn').onclick = ()=>openPanel('founderPanel', '#founder');
    document.getElementById('contactBtn').onclick = ()=>openPanel('contactPanel', '#contact');
    document.querySelectorAll('.closePanel').forEach(b=>b.addEventListener('click', closePanels));

    // -------------------- Helpers -------------------
    const $ = sel => document.querySelector(sel);
    const repsList = $('#repsList');
    const wxList = $('#wxList');
    const wxMeta = $('#wxMeta');
    const voterLinks = $('#voterLinks');
    const cityList = $('#cityList');
    const cityMeta = $('#cityMeta');
    const elexDiv = $('#elex');
    const statusDiv = $('#status');
    const historyDiv = $('#history');
    const localNews = $('#localNews');
    const worldNews = $('#worldNews');
    const trafficBtn = $('#trafficBtn');
    const placeLine = $('#placeLine');

    function telLink(p){ return p ? `tel:${p.replace(/[^0-9]/g,'')}` : '#'; }
    function setStatus(txt){ statusDiv.textContent = txt || ''; }
    function setPlaceLine(city, state, zip){
      const bits = [];
      if (city) bits.push(city);
      if (state) bits.push(state);
      if (zip) bits.push(zip);
      placeLine.textContent = bits.length ? bits.join(" ‚Ä¢ ") : "";
    }

    function pushHistory(zip){
      if(!zip) return;
      const key = 'er_hist';
      const arr = JSON.parse(localStorage.getItem(key) || '[]');
      const now = Date.now();
      const out = [[zip, now], ...arr.filter(x=>x[0]!==zip)].slice(0,5);
      localStorage.setItem(key, JSON.stringify(out));
      renderHistory();
    }

    function renderHistory(){
      const key = 'er_hist';
      const arr = JSON.parse(localStorage.getItem(key) || '[]');
      historyDiv.innerHTML = '';
      arr.forEach(([z])=>{
        const b = document.createElement('button');
        b.className = "px-2 py-1 rounded-md bg-slate-100 hover:bg-slate-200 text-xs";
        b.textContent = z;
        b.onclick = ()=>{ $('#zipInput').value = z; run(); };
        historyDiv.appendChild(b);
      });
    }
    document.getElementById('clearBtn').onclick = ()=>{ localStorage.removeItem('er_hist'); renderHistory(); };

    document.getElementById('shareBtn').onclick = async ()=>{
      const zip = $('#zipInput').value.trim();
      const url = zip ? `${location.origin}${location.pathname}?zip=${encodeURIComponent(zip)}#home` : location.href;
      await navigator.clipboard.writeText(url);
      setStatus('Share link copied.');
      setTimeout(()=>setStatus(''),1500);
    };

    // -------------------- Reverse Geocode (Nominatim) ----------
    async function reverseZip(lat, lon){
      const u = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`;
      const r = await fetch(u, { headers: { "Accept":"application/json" }});
      const j = await r.json();
      const zip = j?.address?.postcode || null;
      const city = j?.address?.city || j?.address?.town || j?.address?.village || j?.address?.hamlet || "";
      const state = j?.address?.state || "";
      return { zip, city, state };
    }

    async function geolocate(){
      return new Promise((resolve,reject)=>{
        if(!navigator.geolocation) return reject(new Error('No geolocation'));
        navigator.geolocation.getCurrentPosition(resolve, reject, {enableHighAccuracy:true, timeout:15000});
      });
    }

    // Use my location: detect ‚Üí show (ZIP + city/state) ‚Üí auto-run
    document.getElementById('locBtn').onclick = async ()=>{
      try{
        setStatus('Locating‚Ä¶');
        const pos = await geolocate();
        const {latitude, longitude} = pos.coords;
        const info = await reverseZip(latitude, longitude);
        if(info.zip){
          $('#zipInput').value = info.zip;
          setPlaceLine(info.city, info.state, info.zip);
          setStatus(`Detected ${info.city ? info.city + ", " : ""}${info.state ? info.state + " " : ""}${info.zip}`);
          await run(); // auto-load
        }else{
          setStatus('Location found. Please enter ZIP manually.');
        }
      }catch(e){
        setStatus('Unable to get location. Enter ZIP manually.');
      }
    };

    // When user blurs zip input, fetch city/state quickly
    $('#zipInput').addEventListener('change', async ()=>{
      const z = $('#zipInput').value.trim();
      if(/^\d{5}(-\d{4})?$/.test(z)){
        try{
          const j = await (await fetch(`${BACKEND}/zipinfo?zip=${z}`)).json();
          setPlaceLine(j.place_name, j.state_abbr, z);
        }catch{}
      }
    });

    document.getElementById('searchBtn').onclick = ()=>run();
    window.addEventListener('DOMContentLoaded', async ()=>{
      const u = new URL(location.href);
      const z = u.searchParams.get('zip');
      if(z){ $('#zipInput').value = z; try{
        const j = await (await fetch(`${BACKEND}/zipinfo?zip=${z}`)).json();
        setPlaceLine(j.place_name, j.state_abbr, z);
      }catch{}; run(); }
      renderHistory();
      // Handle opening panels via hash deep-link
      if (location.hash === '#about') openPanel('aboutPanel');
      if (location.hash === '#founder') openPanel('founderPanel');
      if (location.hash === '#contact') openPanel('contactPanel');
    });

    // -------------------- Main run -------------------
    async function run(){
      const zip = $('#zipInput').value.trim();
      if(!/^\d{5}(-\d{4})?$/.test(zip)){ setStatus('Please enter a valid 5‚Äëdigit US ZIP.'); return; }
      setStatus('Loading‚Ä¶');
      pushHistory(zip);

      // Representatives
      try{
        const j = await (await fetch(`${BACKEND}/officials?zip=${zip}`)).json();
        setPlaceLine(j.place, j.state?.abbr, zip); // ensure city/state visible after load
        repsList.innerHTML = '';
        (j.officials || []).forEach(o=>{
          const div = document.createElement('div');
          div.className = "rounded-lg border p-3";
          const phone = (o.phones && o.phones[0]) || '';
          const phoneHtml = phone ? `<a class="text-blue-700 hover:underline" href="${telLink(phone)}">${phone}</a>` : `<span class="text-slate-400">n/a</span>`;
          const url = (o.urls && o.urls[0]) || '';
          div.innerHTML = `
            <div class="font-medium">${o.name} ‚Äî <span class="text-slate-600">${o.office}</span></div>
            <div class="flex items-center gap-2 text-sm mt-1">
              ${url ? `<a class="text-blue-700 hover:underline" href="${url}" target="_blank" rel="noopener">website</a>` : ''}
              <span>‚Ä¢</span>
              ${phoneHtml}
            </div>`;
          repsList.appendChild(div);
        });
        document.getElementById('copyEmailsBtn').onclick = ()=>{
          const emails = []; // rarely available in open data
          navigator.clipboard.writeText(emails.join(", "));
          setStatus('Emails copied (if available).'); setTimeout(()=>setStatus(''),1200);
        };
        document.getElementById('genEmailBtn').onclick = ()=>{
          const subj = encodeURIComponent("Constituent inquiry from " + zip);
          const body = encodeURIComponent("Dear Representative,\n\nI am a resident of ZIP " + zip + ". I would like to share a concern‚Ä¶\n\nThank you,\n");
          location.href = `mailto:?subject=${subj}&body=${body}`;
        };
      }catch(e){ repsList.innerHTML = `<p class="text-sm text-red-600">Could not load representatives.</p>`; }

      // Weather
      try{
        const j = await (await fetch(`${BACKEND}/weather?zip=${zip}`)).json();
        wxList.innerHTML = '';
        (j.days || []).forEach(d=>{
          const el = document.createElement('div');
          el.className = "flex items-center justify-between border rounded-md px-3 py-2";
          el.innerHTML = `<div class="text-sm">${d.date}</div>
                          <div class="text-lg">${d.icon || '‚õÖ'}</div>
                          <div class="text-sm text-slate-600">${d.label || ''}</div>
                          <div class="text-sm">${Math.round(d.tmax_c)}¬∞ / ${Math.round(d.tmin_c)}¬∞C</div>
                          <div class="text-sm">${d.precip_pct ?? 0}%</div>`;
          wxList.appendChild(el);
        });
        wxMeta.textContent = `Updated ${j.updated_at} ‚Äî Source: ${j.source}`;
      }catch(e){ wxList.innerHTML = `<p class="text-sm text-red-600">Could not load weather.</p>`; }

      // Voter links
      try{
        const j = await (await fetch(`${BACKEND}/voter?zip=${zip}`)).json();
        voterLinks.innerHTML = `
          <a class="px-3 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 text-center" target="_blank" rel="noopener" href="${j.register_url}">Register to Vote</a>
          <a class="px-3 py-2 rounded-md bg-slate-100 hover:bg-slate-200 text-center" target="_blank" rel="noopener" href="${j.polling_url}">Find Election Office</a>
          <a class="px-3 py-2 rounded-md bg-slate-100 hover:bg-slate-200 text-center" target="_blank" rel="noopener" href="${j.howto_url}">How to Vote</a>
        `;
      }catch(e){ voterLinks.innerHTML = `<p class="text-sm text-red-600">Could not load voter info.</p>`; }

      // City updates
      try{
        const j = await (await fetch(`${BACKEND}/city/updates?zip=${zip}&limit=8`)).json();
        cityList.innerHTML = '';
        if((j.items || []).length === 0){
          cityList.innerHTML = `<p class="text-sm text-slate-600">No city update feed is available for this ZIP yet.</p>`;
        }else{
          (j.items || []).forEach(it=>{
            const el = document.createElement('div');
            el.className = "border rounded-md px-3 py-2";
            el.innerHTML = `<div class="text-sm font-medium">${it.type || 'Issue'}</div>
                            <div class="text-xs text-slate-600">${it.detail || ''}</div>
                            <div class="text-xs text-slate-500">${it.address || ''}</div>`;
            cityList.appendChild(el);
          });
        }
        cityMeta.textContent = j.source ? `Source: ${j.source}` : '';
      }catch(e){ cityList.innerHTML = `<p class="text-sm text-red-600">Could not load city updates.</p>`; }

      // Elections
      try{
        const j = await (await fetch(`${BACKEND}/elections?zip=${zip}`)).json();
        elexDiv.innerHTML = `<div class="text-sm">Next Federal: <strong>${j.next_federal}</strong></div>
                             <div class="text-xs text-slate-600 mt-1">${j.notes}</div>`;
      }catch(e){ elexDiv.innerHTML = `<p class="text-sm text-red-600">Could not load elections.</p>`; }

      // News links
      try{
        const j = await (await fetch(`${BACKEND}/news?zip=${zip}`)).json();
        localNews.href = j.local_url; worldNews.href = j.world_url;
      }catch(e){
        // If backend fails, hide links
        localNews.remove(); worldNews.remove();
      }

      // Traffic
      trafficBtn.href = `https://www.google.com/maps/@?api=1&map_action=map&layer=traffic&query=${encodeURIComponent(zip)}`;

      setStatus(`Showing results for ${zip}`);
    }

    // -------------------- Concern templates ---------
    document.querySelectorAll('.concernBtn').forEach(b=>{
      b.addEventListener('click', ()=>{
        const zip = $('#zipInput').value.trim();
        const type = b.dataset.type;
        const subj = `City concern: ${type} (ZIP ${zip})`;
        const body = `Hello,\n\nI‚Äôd like to report a ${type} issue in ZIP ${zip}.\n\nLocation/notes:\n\nThank you.`;
        location.href = `mailto:?subject=${encodeURIComponent(subj)}&body=${encodeURIComponent(body)}`;
      });
    });

    // -------------------- Feedback mailto (bottom) --
    (()=>{
      const starEl = $('#stars'); let rating = 5;
      Array.from(starEl.childNodes).forEach((node, i)=>{
        if(node.nodeType === 3) return;
        node.addEventListener('click', ()=>{ rating = i+1; starEl.dataset.v = rating; });
      });
      $('#fbSend').onclick = ()=>{
        const name = $('#fbName').value.trim();
        const email = $('#fbEmail').value.trim();
        const msg = $('#fbMsg').value.trim();
        const subject = `EagleReach Feedback ${'‚òÖ'.repeat(starEl.dataset.v || rating)}`;
        const body = `Name: ${name}\nEmail: ${email}\nRating: ${starEl.dataset.v || rating}/5\n\n${msg}`;
        location.href = `mailto:vikebairam@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
      };
    })();
  </script>
</body>
</html>
