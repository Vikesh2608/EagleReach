<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EagleReach</title>
  <script>
    const BACKEND_BASE = "https://<your-backend>.onrender.com"; // replace with your Render backend URL
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script defer src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 dark:bg-slate-900 text-slate-900 dark:text-slate-100">
  <!-- HEADER -->
  <header class="bg-blue-900 text-white py-4 shadow flex justify-between items-center px-4">
    <div class="flex items-center gap-2">
      <img src="https://upload.wikimedia.org/wikipedia/commons/a/a4/Flag_of_the_United_States.svg" alt="USA Flag" class="h-6">
      <h1 class="text-lg font-bold">EagleReach</h1>
    </div>
    <blockquote class="italic text-sm hidden md:block">
      â€œA nation, as a society, forms a moral person, and every member of it is personally responsible for his society.â€ â€” Thomas Jefferson
    </blockquote>
    <nav class="flex gap-2">
      <button id="aboutBtn" class="bg-blue-700 px-3 py-1 rounded">About</button>
      <button id="founderBtn" class="bg-blue-700 px-3 py-1 rounded">Founder</button>
      <button id="contactBtn" class="bg-blue-700 px-3 py-1 rounded">Contact</button>
      <button id="feedbackBtn" class="bg-blue-700 px-3 py-1 rounded">Feedback</button>
    </nav>
  </header>

  <!-- MAIN -->
  <main class="max-w-5xl mx-auto p-4 space-y-4">
    <!-- Search bar -->
    <div class="flex flex-col md:flex-row gap-2">
      <input id="zipInput" type="text" placeholder="Enter ZIP code" class="border rounded px-3 py-2 flex-1"/>
      <button id="locBtn" class="bg-green-600 text-white px-3 py-2 rounded">ğŸ“ Use My Location</button>
      <span class="self-center">â€¢</span>
      <button id="searchBtn" class="bg-blue-600 text-white px-3 py-2 rounded">Search</button>
      <button id="copyBtn" class="bg-gray-600 text-white px-3 py-2 rounded">Copy Link</button>
      <button id="clearBtn" class="bg-red-600 text-white px-3 py-2 rounded">Clear History</button>
    </div>
    <div id="placeLine" class="text-sm italic"></div>
    <div id="status" class="text-sm text-slate-500"></div>

    <!-- History -->
    <div id="history" class="flex flex-wrap gap-2 mt-2"></div>

    <!-- Officials -->
    <section class="p-4 bg-white dark:bg-slate-800 rounded shadow">
      <h2 class="text-lg font-bold mb-2">Elected Representatives</h2>
      <ul id="repsList" class="space-y-2"></ul>
    </section>

    <!-- Voter Info -->
    <section class="p-4 bg-white dark:bg-slate-800 rounded shadow">
      <h2 class="text-lg font-bold mb-2">Voter Info & Education</h2>
      <div id="voterLinks" class="flex flex-col gap-2"></div>
    </section>

    <!-- Weather -->
    <section class="p-4 bg-white dark:bg-slate-800 rounded shadow">
      <h2 class="text-lg font-bold mb-2">7-Day Weather</h2>
      <div id="wxList" class="grid grid-cols-2 md:grid-cols-4 gap-2"></div>
      <div id="wxMeta" class="text-xs text-slate-500 mt-1"></div>
    </section>

    <!-- City Updates -->
    <section class="p-4 bg-white dark:bg-slate-800 rounded shadow">
      <h2 class="text-lg font-bold mb-2">City Updates</h2>
      <ul id="cityList" class="space-y-1"></ul>
      <div id="cityMeta" class="text-xs text-slate-500 mt-1"></div>
    </section>

    <!-- Elections -->
    <section class="p-4 bg-white dark:bg-slate-800 rounded shadow">
      <h2 class="text-lg font-bold mb-2">Upcoming Elections</h2>
      <div id="elexDiv" class="text-sm"></div>
    </section>

    <!-- News -->
    <section class="p-4 bg-white dark:bg-slate-800 rounded shadow">
      <h2 class="text-lg font-bold mb-2">News</h2>
      <div class="flex gap-2">
        <a id="localNews" class="bg-blue-600 px-3 py-1 rounded text-white" target="_blank">Local News</a>
        <a id="worldNews" class="bg-blue-600 px-3 py-1 rounded text-white" target="_blank">World News</a>
      </div>
    </section>

    <!-- Raise a concern -->
    <section class="p-4 bg-white dark:bg-slate-800 rounded shadow">
      <h2 class="text-lg font-bold mb-2">Raise a Concern</h2>
      <div class="flex flex-wrap gap-2">
        <a class="bg-red-600 text-white px-3 py-1 rounded" href="mailto:mayor@example.com?subject=Pothole Report&body=Dear Mayor, Iâ€™d like to report a pothole in my area.">Pothole</a>
        <a class="bg-red-600 text-white px-3 py-1 rounded" href="mailto:mayor@example.com?subject=Trash Issue&body=Dear Mayor, Trash pickup is delayed in my area.">Trash</a>
        <a class="bg-red-600 text-white px-3 py-1 rounded" href="mailto:mayor@example.com?subject=Street Lights Out&body=Dear Mayor, Several street lights are not functioning.">Street Lights</a>
      </div>
    </section>

    <!-- Emergency Contacts -->
    <section class="p-4 bg-white dark:bg-slate-800 rounded shadow">
      <h2 class="text-lg font-bold mb-2">Emergency Contacts</h2>
      <ul class="space-y-1 text-blue-600 underline">
        <li><a href="tel:911">ğŸš¨ Police/Fire/Medical â€“ 911</a></li>
        <li><a href="tel:988">ğŸ§  Suicide & Crisis Lifeline â€“ 988</a></li>
        <li><a href="tel:18002224357">ğŸ’Š Poison Control â€“ 1-800-222-1222</a></li>
        <li><a href="tel:18666463579">ğŸ¥ Disaster Distress Helpline â€“ 1-866-488-7379</a></li>
      </ul>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="text-center text-xs text-slate-500 p-3">Â© 2025 EagleReach</footer>

  <!-- DIALOGS -->
  <dialog id="aboutDlg" class="p-4 rounded">
    <h3 class="text-lg font-bold mb-2">About EagleReach</h3>
    <p>EagleReach is an open-source civic assistant â€¦ (expand with your mission here).</p>
    <button onclick="this.closest('dialog').close()" class="bg-blue-600 text-white px-3 py-1 rounded mt-3">Close</button>
  </dialog>
  <dialog id="founderDlg" class="p-4 rounded">
    <h3 class="text-lg font-bold mb-2">Founder</h3>
    <p>Vikesh Sagar Bairam â€” Founder of EagleReach, AI/ML & Data Engineer, DevOps Specialist, Generative AI Builder, Tech Evangelist, Business Solutions Architect.</p>
    <button onclick="this.closest('dialog').close()" class="bg-blue-600 text-white px-3 py-1 rounded mt-3">Close</button>
  </dialog>
  <dialog id="contactDlg" class="p-4 rounded">
    <h3 class="text-lg font-bold mb-2">Contact</h3>
    <ul>
      <li><a href="https://www.linkedin.com/in/vikesh-bairam-219769258/" target="_blank">LinkedIn</a></li>
      <li><a href="https://github.com/Vikesh2608" target="_blank">GitHub</a></li>
      <li><a href="mailto:vikebairam@gmail.com">Email</a></li>
    </ul>
    <button onclick="this.closest('dialog').close()" class="bg-blue-600 text-white px-3 py-1 rounded mt-3">Close</button>
  </dialog>
  <dialog id="feedbackDlg" class="p-4 rounded">
    <h3 class="text-lg font-bold mb-2">Feedback</h3>
    <form>
      <label>Name <input class="border rounded w-full px-2 py-1"/></label>
      <label>Email <input class="border rounded w-full px-2 py-1"/></label>
      <label>Comments <textarea class="border rounded w-full px-2 py-1"></textarea></label>
      <button class="bg-blue-600 text-white px-3 py-1 rounded mt-3">Send</button>
    </form>
    <button onclick="this.closest('dialog').close()" class="bg-gray-600 text-white px-3 py-1 rounded mt-3">Close</button>
  </dialog>

  <!-- SCRIPT -->
  <script>
    const $ = (id) => document.getElementById(id);
    const repsList = $("repsList"), wxList=$("wxList"), wxMeta=$("wxMeta"),
          voterLinks=$("voterLinks"), cityList=$("cityList"), cityMeta=$("cityMeta"),
          elexDiv=$("elexDiv");

    function setStatus(msg){ $("status").textContent = msg; }
    function setPlaceLine(city, st, zip){ $("placeLine").textContent = zip? `${city} â€¢ ${st} â€¢ ${zip}`: ""; }

    async function fetchJSON(url){ const r=await fetch(url); if(!r.ok) throw new Error(r.status); return r.json(); }

    async function run(zip){
      try{
        setStatus("Loadingâ€¦");
        // officials
        const o=await fetchJSON(`${BACKEND_BASE}/officials?zip=${zip}`);
        setPlaceLine(o.place,o.state.abbr,zip);
        repsList.innerHTML="";
        o.officials.forEach(it=>{
          const li=document.createElement("li");
          const phone=it.phones[0]?`<a href="tel:${it.phones[0]}" class="underline">${it.phones[0]}</a>`:"";
          li.innerHTML=`<div><b>${it.name}</b> â€” ${it.office} (${it.party||""})</div>
                        <div>${phone}</div>
                        <div><a href="${it.urls[0]}" target="_blank" class="text-blue-600 underline">Website</a></div>`;
          repsList.appendChild(li);
        });

        // voter
        const v=await fetchJSON(`${BACKEND_BASE}/voter?zip=${zip}`);
        voterLinks.innerHTML=`<a href="${v.register_url}" target="_blank" class="bg-blue-600 text-white px-3 py-1 rounded">Register to Vote</a>
          <a href="${v.howto_url}" target="_blank" class="bg-blue-600 text-white px-3 py-1 rounded">How to Vote</a>
          <a href="${v.polling_url}" target="_blank" class="bg-blue-600 text-white px-3 py-1 rounded">Find Election Office</a>`;

        // weather
        const w=await fetchJSON(`${BACKEND_BASE}/weather?zip=${zip}`);
        wxList.innerHTML="";
        w.days.forEach(d=>{
          const card=document.createElement("div");
          card.className="border rounded p-2 text-center";
          card.innerHTML=`<div>${d.icon} ${d.label}</div><div>${d.date}</div>
                          <div>${d.tmin_c}Â°â€“${d.tmax_c}Â°C</div><div>ğŸ’§${d.precip_pct}%</div>`;
          wxList.appendChild(card);
        });
        wxMeta.textContent=`Updated ${w.updated_at}`;

        // city updates
        const cu=await fetchJSON(`${BACKEND_BASE}/city/updates?zip=${zip}`);
        cityList.innerHTML=""; cu.items.forEach(it=>{
          const li=document.createElement("li");
          li.textContent=`${it.type}: ${it.detail||""} (${it.status||""})`;
          cityList.appendChild(li);
        });
        cityMeta.textContent= cu.source? cu.source:"";

        // elections
        const el=await fetchJSON(`${BACKEND_BASE}/elections?zip=${zip}`);
        elexDiv.textContent=`Next Federal Election: ${el.next_federal}`;

        // news
        const n=await fetchJSON(`${BACKEND_BASE}/news?zip=${zip}`);
        $("localNews").href=n.local_url; $("worldNews").href=n.world_url;

        saveHistory(zip);
        setStatus("");
      }catch(e){ setStatus("Error "+e); }
    }

    // History
    function renderHistory(){
      const hist=JSON.parse(localStorage.getItem("er_hist")||"[]");
      const h=$("history"); h.innerHTML="";
      hist.forEach(z=>{
        const b=document.createElement("button");
        b.className="px-2 py-1 bg-gray-200 rounded"; b.textContent=z;
        b.onclick=()=>{ $("zipInput").value=z; run(z); };
        h.appendChild(b);
      });
    }
    function saveHistory(zip){
      let hist=JSON.parse(localStorage.getItem("er_hist")||"[]");
      hist=[zip,...hist.filter(x=>x!==zip)].slice(0,5);
      localStorage.setItem("er_hist",JSON.stringify(hist));
      renderHistory();
    }

    // Clear History FIX
    $("clearBtn").onclick=()=>{
      localStorage.removeItem("er_hist"); renderHistory();
      $("zipInput").value=""; setPlaceLine("","",""); setStatus("History cleared.");
      repsList.innerHTML=""; wxList.innerHTML=""; wxMeta.textContent="";
      voterLinks.innerHTML=""; cityList.innerHTML=""; cityMeta.textContent=""; elexDiv.innerHTML="";
    };

    $("searchBtn").onclick=()=>{ const z=$("zipInput").value.trim(); if(z) run(z); };
    $("copyBtn").onclick=()=>{ navigator.clipboard.writeText(location.href.split("?")[0]+"?zip="+$("zipInput").value); setStatus("Link copied!"); };
    $("locBtn").onclick=()=>{
      if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(async pos=>{
          const {latitude,longitude}=pos.coords;
          const r=await fetchJSON(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=en`);
          if(r.postcode){ $("zipInput").value=r.postcode; run(r.postcode); }
        },()=>setStatus("Location blocked"));
      }
    };

    // Dialogs
    $("aboutBtn").onclick=()=>$("aboutDlg").showModal();
    $("founderBtn").onclick=()=>$("founderDlg").showModal();
    $("contactBtn").onclick=()=>$("contactDlg").showModal();
    $("feedbackBtn").onclick=()=>$("feedbackDlg").showModal();

    renderHistory();
  </script>
</body>
</html>
