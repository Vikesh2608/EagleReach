<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EagleReach</title>
  <style>
    :root{
      --bg:#f6f9ff;--card:#ffffff;--ink:#0b2347;--muted:#6b7a90;--brand:#2251ff;--ring:#dfe8ff;--ok:#1f9d59;--err:#c62828;
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--ink)}
    a{color:var(--brand);text-decoration:none}
    .nav{position:sticky;top:0;background:#0f3b86;color:#fff;padding:.6rem 1rem;z-index:10;box-shadow:0 2px 8px rgba(0,0,0,.08)}
    .nav .brand{display:flex;gap:.5rem;align-items:center;font-weight:700}
    .wrap{max-width:1060px;margin:1rem auto;padding:0 1rem}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--ring);border-radius:var(--radius);box-shadow:0 2px 10px rgba(16,24,40,.04)}
    .card h3{margin:0;padding:14px 16px;border-bottom:1px solid var(--ring);font-size:1rem}
    .card .body{padding:14px 16px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    input[type="text"]{flex:1;min-width:220px;padding:.7rem .8rem;border:1px solid var(--ring);border-radius:10px;font-size:1rem}
    button{border:0;background:var(--brand);color:#fff;padding:.7rem .95rem;border-radius:10px;font-weight:600;cursor:pointer}
    button.secondary{background:#eef3ff;color:#1b3aa6}
    .pill{display:inline-block;padding:.25rem .55rem;border:1px solid var(--ring);border-radius:999px;font-size:.82rem;color:var(--muted);background:#fbfcff}
    .list{display:flex;flex-direction:column;gap:10px}
    .official{display:flex;gap:12px;align-items:center;border:1px solid var(--ring);border-radius:12px;padding:10px}
    .official img{width:44px;height:44px;border-radius:50%;object-fit:cover;border:1px solid var(--ring)}
    .official .meta{min-width:0}
    .official .meta .name{font-weight:700}
    .official .meta .sub{color:var(--muted);font-size:.9rem}
    .empty{color:var(--muted);font-style:italic}
    .alert{padding:.7rem .9rem;border-radius:10px}
    .alert.ok{background:#eaf7ef;color:#0a5f35;border:1px solid #ccebd9}
    .alert.err{background:#fdebea;color:#7a1818;border:1px solid #f6c7c5}
    footer{color:var(--muted);font-size:.9rem;padding:26px 0;text-align:center}
  </style>
</head>
<body>
  <div class="nav">
    <div class="wrap">
      <div class="brand">ðŸ‡ºðŸ‡¸ EagleReach</div>
    </div>
  </div>

  <div class="wrap">
    <!-- Search -->
    <div class="card" id="searchCard">
      <h3>Enter ZIP</h3>
      <div class="body">
        <div class="row">
          <input id="zipInput" type="text" inputmode="numeric" maxlength="5" placeholder="e.g., 45220" />
          <button id="btnSearch">Search</button>
          <button id="btnLocate" class="secondary">Use my location</button>
        </div>
        <div style="margin-top:10px" id="locLine" class="pill" hidden></div>
        <div id="statusBox" style="margin-top:10px"></div>
      </div>
    </div>

    <div class="grid" style="margin-top:12px">
      <!-- Officials -->
      <div class="card">
        <h3>Elected Representatives</h3>
        <div class="body">
          <div class="list" id="senList">
            <div class="pill">Senators</div>
            <div id="senators"></div>
          </div>
          <div class="list" style="margin-top:12px">
            <div class="pill">House Representative</div>
            <div id="house"></div>
          </div>
          <div class="list" style="margin-top:12px">
            <div class="pill">Mayor</div>
            <div id="mayor"></div>
          </div>
          <p style="margin-top:12px;color:var(--muted);font-size:.9rem">
            Sources: Zippopotam (ZIP), WhoIsMyRepresentative (district), GovTrack (websites & photos), Wikidata (mayor).
          </p>
        </div>
      </div>

      <!-- Civic resources -->
      <div class="card">
        <h3>Voter Info & Education</h3>
        <div class="body">
          <div class="list">
            <a class="official" href="https://www.usa.gov/how-to-vote" target="_blank" rel="noopener">
              <div class="meta">
                <div class="name">How to vote (USA.gov)</div>
                <div class="sub">Registration, deadlines, ID rules</div>
              </div>
            </a>
            <a class="official" href="https://www.vote.gov/" target="_blank" rel="noopener">
              <div class="meta">
                <div class="name">Register to vote</div>
                <div class="sub">Official state portals</div>
              </div>
            </a>
            <a class="official" href="https://www.usa.gov/election-office" target="_blank" rel="noopener">
              <div class="meta">
                <div class="name">Find your Election Office</div>
                <div class="sub">Local contact details</div>
              </div>
            </a>
          </div>
        </div>
      </div>
    </div>

    <footer>Â© 2025 EagleReach â€” Civic info, fast & free â€” built for everyone in the United States.</footer>
  </div>

  <script>
    // ----------------------------
    // Backend base
    // ----------------------------
    const API_BASE = (window.location.hostname.includes('github.io'))
      ? 'https://YOUR-BACKEND-DOMAIN'   // <â€” REPLACE with your FastAPI deploy URL
      : 'http://localhost:8000';

    // ----------------------------
    // Helpers
    // ----------------------------
    function $(id){ return document.getElementById(id); }
    function htmlEscape(s){ return s?.toString().replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])) || ''; }
    function clear(el){ el.innerHTML=''; }
    function itemHTML(p){
      const photo = p.photo ? `<img src="${htmlEscape(p.photo)}" alt="">` : `<img src="https://via.placeholder.com/44" alt="">`;
      const role = [p.role, p.party, p.state && `(${p.state}${p.district?'-'+p.district:''})`].filter(Boolean).join(' Â· ');
      const website = p.website ? `<a href="${htmlEscape(p.website)}" target="_blank" rel="noopener">Official website</a>` : '';
      const phone = p.phone ? `<span> | ${htmlEscape(p.phone)}</span>` : '';
      return `
        <div class="official">
          ${photo}
          <div class="meta">
            <div class="name">${htmlEscape(p.name || 'Unknown')}</div>
            <div class="sub">${htmlEscape(role)}</div>
            <div class="sub">${website}${phone}</div>
          </div>
        </div>`;
    }

    function mayorHTML(m){
      if(!m) return `<div class="empty">No mayor info available for this city right now.</div>`;
      const website = m.website ? `<a href="${htmlEscape(m.website)}" target="_blank" rel="noopener">Official website</a>` : '';
      return `
        <div class="official">
          <img src="https://via.placeholder.com/44" alt="">
          <div class="meta">
            <div class="name">${htmlEscape(m.name)}</div>
            <div class="sub">Mayor</div>
            <div class="sub">${website}</div>
          </div>
        </div>`;
    }

    // ----------------------------
    // API
    // ----------------------------
    async function loadOfficials(zip) {
      const r = await fetch(`${API_BASE}/officials?zip=${encodeURIComponent(zip)}`);
      if (!r.ok) throw new Error(`Officials lookup failed (${r.status})`);
      return r.json();
    }

    // ----------------------------
    // UI wiring
    // ----------------------------
    async function doSearch(zip) {
      const statusBox = $('statusBox');
      const senatorsEl = $('senators');
      const houseEl = $('house');
      const mayorEl = $('mayor');
      const locLine = $('locLine');

      clear(senatorsEl); clear(houseEl); clear(mayorEl);
      statusBox.innerHTML = `<div class="alert ok">Looking up officials for ZIP ${htmlEscape(zip)}â€¦</div>`;

      try{
        const data = await loadOfficials(zip);
        const loc = data.location;
        locLine.hidden = false;
        locLine.textContent = `${loc.zip} â€” ${loc.city}, ${loc.state_full}`;

        // senators
        if (data.officials.senators?.length){
          senatorsEl.innerHTML = data.officials.senators.map(itemHTML).join('');
        } else {
          senatorsEl.innerHTML = `<div class="empty">No senators returned.</div>`;
        }

        // house
        if (data.officials.representatives?.length){
          houseEl.innerHTML = data.officials.representatives.map(itemHTML).join('');
        } else {
          houseEl.innerHTML = `<div class="empty">District not available right now. Try again later.</div>`;
        }

        // mayor
        mayorEl.innerHTML = mayorHTML(data.officials.mayor);

        statusBox.innerHTML = `<div class="alert ok">Done.</div>`;
      }catch(err){
        console.error(err);
        statusBox.innerHTML = `<div class="alert err">Couldnâ€™t load officials. Check your backend URL or try again.</div>`;
      }
    }

    $('btnSearch').addEventListener('click', () => {
      const z = $('zipInput').value.trim();
      if(!/^\d{5}$/.test(z)){
        $('statusBox').innerHTML = `<div class="alert err">Please enter a valid 5-digit ZIP.</div>`;
        return;
      }
      doSearch(z);
    });

    $('zipInput').addEventListener('keydown', e => {
      if(e.key === 'Enter') $('btnSearch').click();
    });

    $('btnLocate').addEventListener('click', async () => {
      $('statusBox').innerHTML = `<div class="alert ok">Getting your ZIP from locationâ€¦</div>`;
      try{
        // Simple ZIP from lat/lon using geocode.maps.co (free/no key) via reverse geocode
        // If you don't want an extra call, you can remove this feature.
        navigator.geolocation.getCurrentPosition(async pos => {
          const {latitude, longitude} = pos.coords;
          // Use a lightweight reverse-geo service
          const r = await fetch(`https://geocode.maps.co/reverse?lat=${latitude}&lon=${longitude}`);
          const j = await r.json();
          const zip = j?.address?.postcode?.match(/\d{5}/)?.[0];
          if(zip){ $('zipInput').value = zip; doSearch(zip); }
          else $('statusBox').innerHTML = `<div class="alert err">Couldnâ€™t determine a ZIP at your location.</div>`;
        }, () => {
          $('statusBox').innerHTML = `<div class="alert err">Location permission denied.</div>`;
        }, {timeout:8000});
      }catch{
        $('statusBox').innerHTML = `<div class="alert err">Location lookup failed.</div>`;
      }
    });

    // Optional: prefill a demo ZIP
    document.addEventListener('DOMContentLoaded', () => {
      const demo = '45220';
      $('zipInput').value = demo;
    });
  </script>
</body>
</html>
