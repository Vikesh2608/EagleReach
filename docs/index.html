<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EagleReach</title>
  <link rel="icon" href="data:,">
  <style>
    :root{
      --bg:#0f2744;
      --bg-2:#0f2744;
      --card:#ffffff;
      --muted:#6b7280;
      --ring:#d1d5db;
      --bdr:#e5e7eb;
      --text:#0f172a;
      --accent:#2563eb;
    }
    html,body{margin:0;padding:0;background:#f7fafc;color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif}
    .container{max-width:1100px;margin:0 auto;padding:0 16px}
    .topbar{background:var(--bg);color:#fff;position:sticky;top:0;z-index:50;box-shadow:0 2px 8px rgba(0,0,0,.12)}
    .brand{display:flex;align-items:center;gap:.6rem;font-weight:700;font-size:20px}
    .brand .eagle{font-size:20px}
    .quote{font-size:12px;opacity:.8;margin-left:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .nav{display:flex;gap:20px;align-items:center}
    .nav a{color:#cfe1ff;text-decoration:none}
    .nav a:hover{text-decoration:underline}
    .row{display:flex;justify-content:space-between;gap:20px;align-items:center;padding:12px 0}
    .mobile-menu-btn{display:none;border:1px solid rgba(255,255,255,.25);background:transparent;color:#fff;border-radius:8px;padding:6px 10px}
    .mobile-sheet{display:none}

    .controls{margin:18px 0;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .input{border:1px solid var(--ring);border-radius:8px;padding:10px 12px;min-width:260px;background:#fff}
    .btn{border:1px solid var(--ring);background:#fff;border-radius:8px;padding:10px 12px;cursor:pointer}
    .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
    .pill{display:inline-block;margin-top:6px;color:var(--muted);font-size:13px}

    .grid{display:grid;gap:18px;grid-template-columns:1fr 1fr}
    .card{background:var(--card);border:1px solid var(--bdr);border-radius:14px;box-shadow:0 6px 24px rgba(15,23,42,.06);padding:16px}
    .card h3{margin:0 0 8px 0;font-size:16px}
    .row-items{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .badge{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--bdr);background:#f8fafc}
    .list{list-style:none;margin:8px 0 0 0;padding:0}
    .list li{padding:10px 0;border-bottom:1px solid var(--bdr);display:flex;justify-content:space-between;align-items:center;gap:12px}
    .list li:last-child{border-bottom:none}
    .muted{color:var(--muted)}
    .link{color:#1d4ed8;text-decoration:none}
    .link:hover{text-decoration:underline}
    .btn-chip{border:1px solid var(--bdr);padding:6px 10px;border-radius:10px;background:#fff;cursor:pointer}

    /* dialogs */
    dialog{border:none;border-radius:16px;max-width:780px;width:92vw;box-shadow:0 20px 60px rgba(0,0,0,.35)}
    dialog::backdrop{background:rgba(0,10,20,.55)}
    .dialog-head{display:flex;justify-content:space-between;align-items:center;padding:8px 0 12px 0;border-bottom:1px solid var(--bdr)}
    .close-x{border:1px solid var(--bdr);border-radius:8px;background:#fff;padding:6px 10px;cursor:pointer}

    /* responsive */
    @media (max-width:1020px){
      .grid{grid-template-columns:1fr}
      .quote{display:none}
    }
    @media (max-width:760px){
      .nav{display:none}
      .mobile-menu-btn{display:inline-flex}
      .mobile-sheet{display:none;background:var(--bg-2);padding:8px 0}
      .mobile-sheet a{display:block;padding:10px 16px;color:#cfe1ff;text-decoration:none}
      .mobile-sheet a:hover{background:rgba(255,255,255,.05)}
    }
  </style>
</head>
<body>

  <!-- Top bar -->
  <header class="topbar">
    <div class="container">
      <div class="row">
        <div class="brand">
          <span class="eagle">ü¶Ö</span>
          <span>EagleReach</span>
          <span class="quote">‚ÄúA nation, as a society, forms a moral person‚Ä¶‚Äù ‚Äî Thomas Jefferson</span>
        </div>
        <nav class="nav" id="desktopNav">
          <a href="#" data-open="aboutDlg">About</a>
          <a href="#" data-open="founderDlg">Founder</a>
          <a href="#" data-open="contactDlg">Contact</a>
          <a href="#" data-open="feedbackDlg">Feedback</a>
        </nav>
        <button class="mobile-menu-btn" id="menuBtn" aria-label="Open menu">‚ò∞ Menu</button>
      </div>
      <div class="mobile-sheet" id="mobileSheet">
        <div class="container" style="padding:0 16px">
          <a href="#" data-open="aboutDlg">About</a>
          <a href="#" data-open="founderDlg">Founder</a>
          <a href="#" data-open="contactDlg">Contact</a>
          <a href="#" data-open="feedbackDlg">Feedback</a>
        </div>
      </div>
    </div>
  </header>

  <!-- Search controls -->
  <main class="container">
    <section class="controls">
      <input id="zipInput" class="input" inputmode="numeric" maxlength="10" placeholder="ZIP (e.g., 62704)" />
      <button id="locateBtn" class="btn">Locating‚Ä¶</button>
      <button id="searchBtn" class="btn primary">Search</button>
      <button id="shareBtn" class="btn">Copy Share Link</button>
      <button id="clearBtn" class="btn">Clear history</button>
      <span id="placeLabel" class="pill"></span>
    </section>

    <!-- Cards grid -->
    <section class="grid">
      <article class="card">
        <h3>Elected Representatives</h3>
        <div class="row-items" style="margin-bottom:8px">
          <button id="copyEmailsBtn" class="btn-chip">Copy Emails</button>
          <button id="genEmailBtn" class="btn-chip">Generate Email</button>
        </div>
        <small class="muted">Sources: GovTrack (Congress), Wikidata (Mayor), FCC, Zippopotam.</small>
        <ul id="officialsList" class="list" style="margin-top:10px"></ul>
      </article>

      <article class="card">
        <h3>Weather (7‚Äëday)</h3>
        <ul id="weatherList" class="list"></ul>
      </article>

      <article class="card">
        <h3>Voter Info & Education</h3>
        <ul class="list">
          <li><a class="link" target="_blank" href="https://www.usa.gov/how-to-vote">How to vote (USA.gov)</a><span>‚Üí</span></li>
          <li><a class="link" target="_blank" href="https://www.usa.gov/register-to-vote">Register to vote</a><span>‚Üí</span></li>
          <li><a class="link" target="_blank" href="https://www.eac.gov/voters/register-and-vote-in-your-state">Find your Election Office</a><span>‚Üí</span></li>
        </ul>
      </article>

      <article class="card">
        <h3>City updates</h3>
        <div id="cityUpdates" class="muted">Enter a ZIP to load updates‚Ä¶</div>
      </article>

      <article class="card">
        <h3>News</h3>
        <div class="row-items">
          <a id="openLocalNews" class="btn-chip" target="_blank" href="#">Open Local News</a>
          <a id="openWorldNews" class="btn-chip" target="_blank" href="https://news.google.com/home">World News</a>
        </div>
        <div class="muted" style="margin-top:6px">Opens news in a new tab.</div>
      </article>

      <article class="card">
        <h3>Upcoming Elections</h3>
        <div id="elections" class="muted">Next Federal: November 3, 2025<br/><small>State/Local specific dates coming from open data.</small></div>
      </article>

      <article class="card">
        <h3>Traffic</h3>
        <div class="muted">Open live traffic for your area in Google Maps.</div>
        <div style="margin-top:8px">
          <a id="trafficBtn" class="btn" target="_blank" href="https://www.google.com/maps/@?api=1&map_action=map&basemap=traffic">Open Traffic Map</a>
        </div>
      </article>

      <article class="card">
        <h3>Emergency</h3>
        <div class="row-items" style="gap:10px;flex-wrap:wrap">
          <a class="btn-chip" href="tel:911" style="background:#fee2e2;border-color:#fecaca">911 ‚Äî Emergency</a>
          <a class="btn-chip" href="tel:988" style="background:#ede9fe;border-color:#ddd6fe">988 ‚Äî Suicide &amp; Crisis</a>
          <a class="btn-chip" href="tel:211" style="background:#dcfce7;border-color:#bbf7d0">211 ‚Äî Community Services</a>
          <a class="btn-chip" href="tel:311" style="background:#dbeafe;border-color:#bfdbfe">311 ‚Äî City Services</a>
          <a class="btn-chip" href="tel:811" style="background:#ffedd5;border-color:#fed7aa">811 ‚Äî Before You Dig</a>
          <a class="btn-chip" href="tel:18002221222" style="background:#fde68a;border-color:#fcd34d">Poison Control</a>
        </div>
        <div class="muted" style="margin-top:6px">Tap a number to call.</div>
      </article>

      <article class="card" style="grid-column:1/-1">
        <h3>Raise a Concern</h3>
        <div class="muted">Report city issues (311), contact your city hall, or write to your representatives.</div>
        <div class="row-items" style="margin-top:8px">
          <a class="link" id="concernPotholes" href="#">Potholes</a>
          <a class="link" id="concernTrash" href="#">Trash</a>
          <a class="link" id="concernLights" href="#">Street lights</a>
        </div>
      </article>
    </section>
  </main>

  <!-- ABOUT / FOUNDER / CONTACT / FEEDBACK dialogs -->
  <dialog id="aboutDlg">
    <div class="container" style="padding:16px">
      <div class="dialog-head">
        <h3 style="margin:0">About EagleReach</h3>
        <button class="close-x" data-close="aboutDlg">Close ‚úï</button>
      </div>
      <div style="padding:12px 0 2px 0;">
        <p><strong>EagleReach</strong> is a public, open‚Äësource civic assistant that connects residents to their elected officials, voter information, weather & traffic, and local context ‚Äî all with a ZIP code. It‚Äôs built to be fast, trustworthy, and easy for everyone.</p>
        <p>Data sources include GovTrack (Congress), Wikidata (Mayor), FCC, Zippopotam, Open‚ÄëMeteo, and open municipal feeds where available.</p>
      </div>
    </div>
  </dialog>

  <dialog id="founderDlg">
    <div class="container" style="padding:16px">
      <div class="dialog-head">
        <h3 style="margin:0">Founder</h3>
        <button class="close-x" data-close="founderDlg">Close ‚úï</button>
      </div>
      <div style="padding:12px 0 2px 0;">
        <p><strong>Vikesh Sagar Bairam</strong> ‚Äî Founder of EagleReach. Tech evangelist and Business Solutions Architect; AI/ML & Data Engineer; DevOps Specialist; Research Professional. M.S. in Information Systems &amp; Management (University of Illinois Springfield). B.S. in Psychology &amp; B.S. in Computer Science. Currently at Jabil; previously at Surfaces by Pacific.</p>
        <p>Vision: a simple, patriotic, and practical way for every resident to reach their government ‚Äî quickly and respectfully.</p>
      </div>
    </div>
  </dialog>

  <dialog id="contactDlg">
    <div class="container" style="padding:16px">
      <div class="dialog-head">
        <h3 style="margin:0">Contact</h3>
        <button class="close-x" data-close="contactDlg">Close ‚úï</button>
      </div>
      <div style="padding:12px 0 2px 0;">
        <p>LinkedIn: <a class="link" target="_blank" href="https://www.linkedin.com/in/vikeshbairam">Vikesh Bairam</a><br/>
        GitHub: <a class="link" target="_blank" href="https://github.com/vikesh2608">vikesh2608</a><br/>
        Email: <a class="link" href="mailto:vikebairam@gmail.com">vikebairam@gmail.com</a></p>
      </div>
    </div>
  </dialog>

  <dialog id="feedbackDlg">
    <div class="container" style="padding:16px">
      <div class="dialog-head">
        <h3 style="margin:0">Feedback</h3>
        <button class="close-x" data-close="feedbackDlg">Close ‚úï</button>
      </div>
      <div style="padding:12px 0 2px 0;">
        <p style="margin-top:0">Tell us what you think (5‚Äëstar quick rating + optional note):</p>
        <div id="stars" style="font-size:26px;cursor:pointer;user-select:none">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</div>
        <textarea id="fbNote" rows="4" style="width:100%;margin-top:10px;border:1px solid var(--bdr);border-radius:10px;padding:10px" placeholder="Your comments‚Ä¶"></textarea>
        <div style="margin-top:10px">
          <button id="sendFb" class="btn primary">Send feedback</button>
        </div>
        <small class="muted">No account needed ‚Äî this opens your email client with a pre‚Äëfilled message to the project inbox.</small>
      </div>
    </div>
  </dialog>

<script>
/* --------------------------- CONFIG ---------------------------------- */
const API_BASE = "https://eaglereach-1.onrender.com";
/* --------------------------------------------------------------------- */

const $ = sel => document.querySelector(sel);
const byId = id => document.getElementById(id);

/* ====== UI wires ====== */
const zipInput = byId('zipInput');
const locateBtn = byId('locateBtn');
const searchBtn = byId('searchBtn');
const shareBtn  = byId('shareBtn');
const clearBtn  = byId('clearBtn');
const placeLabel= byId('placeLabel');
const officialsList = byId('officialsList');
const weatherList = byId('weatherList');
const cityUpdates = byId('cityUpdates');

const navOpeners = document.querySelectorAll('[data-open]');
const menuBtn = byId('menuBtn');
const mobileSheet = byId('mobileSheet');

/* ====== helpers ====== */
function toast(msg){ alert(msg); }
function setPlaceLabel(txt){ placeLabel.textContent = txt || ""; }
function zipClean(z){ return (z||"").trim().match(/^\d{5}(-\d{4})?$/) ? z.trim().slice(0,5) : ""; }

function setBusy(on){
  const t = on?"Locating‚Ä¶":"Use my location";
  locateBtn.textContent = t;
  locateBtn.disabled = on;
}

/* ====== reverse geocode (lat/lon -> ZIP) ====== */
async function zipFromLatLon(lat, lon){
  // 1) BigDataCloud (no key)
  try{
    const u = `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`;
    const r = await fetch(u,{headers:{"Accept":"application/json"}});
    if(r.ok){
      const j = await r.json();
      const z = (j.postcode||"").trim();
      if(/\d{5}/.test(z)) return z.match(/\d{5}/)[0];
    }
  }catch{}
  // 2) Nominatim fallback
  try{
    const u = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}&zoom=18&addressdetails=1`;
    const r = await fetch(u,{headers:{"Accept":"application/json","User-Agent":"EagleReach/1.0 (public project)"}});
    if(r.ok){
      const j = await r.json();
      const z = (j.address&&j.address.postcode)||"";
      if(/\d{5}/.test(z)) return z.match(/\d{5}/)[0];
    }
  }catch{}
  return "";
}

/* ====== main load ====== */
async function run(){
  const zip = zipClean(zipInput.value);
  if(!zip){ toast("Please enter a valid 5‚Äëdigit ZIP."); return; }

  history.replaceState(null,"",`?zip=${zip}`);

  // Officials
  officialsList.innerHTML = '<li class="muted">Loading officials‚Ä¶</li>';
  try{
    const r = await fetch(`${API_BASE}/officials?zip=${zip}`);
    const j = await r.json();
    setPlaceLabel(`${zip} ‚Äî ${j.place||""}, ${j.state?.abbr||j.state||""}`.replace(/,\s*$/,""));
    // list
    const rows = (j.officials||[]).map(o=>{
      const tel = (o.phones&&o.phones[0])||"";
      const url = (o.urls&&o.urls[0])||"";
      return `
        <li>
          <div>
            <div><strong>${o.name||"‚Äî"}</strong> ‚Äî ${o.office||""}</div>
            <div class="muted" style="font-size:13px">${o.party?o.party+" ¬∑ ":""}${url?`<a class="link" href="${url}" target="_blank">${new URL(url).hostname}</a>`:""}</div>
          </div>
          <div style="white-space:nowrap">
            ${tel?`<a class="btn-chip" href="tel:${tel.replace(/[^+\d]/g,"")}">${tel}</a>`:""}
          </div>
        </li>`;
    }).join("");
    officialsList.innerHTML = rows || '<li class="muted">No officials found.</li>';
  }catch(e){
    officialsList.innerHTML = '<li class="muted">Failed to load officials.</li>';
  }

  // Weather
  weatherList.innerHTML = '<li class="muted">Loading weather‚Ä¶</li>';
  try{
    const r = await fetch(`${API_BASE}/weather?zip=${zip}`);
    const j = await r.json();
    const rows = (j.days||[]).map(d=>{
      const emoji = (()=>{
        const t = (d.desc||"").toLowerCase();
        if(t.includes("rain")) return "üåßÔ∏è";
        if(t.includes("snow")) return "‚ùÑÔ∏è";
        if(t.includes("cloud")) return "‚òÅÔ∏è";
        if(t.includes("drizzle")) return "üå¶Ô∏è";
        if(t.includes("storm")||t.includes("thunder")) return "‚õàÔ∏è";
        return "‚òÄÔ∏è";
      })();
      const hi = (d.tmax_c!=null)?Math.round((d.tmax_c*9/5)+32):"";
      const lo = (d.tmin_c!=null)?Math.round((d.tmin_c*9/5)+32):"";
      return `<li><span>${d.date}</span><span class="muted">${d.desc||""} ${emoji}</span><span>${lo}¬∞ / ${hi}¬∞F</span></li>`;
    }).join("");
    weatherList.innerHTML = rows || '<li class="muted">No forecast.</li>';
  }catch(e){
    weatherList.innerHTML = '<li class="muted">Failed to load weather.</li>';
  }

  // City updates placeholder (kept simple)
  cityUpdates.textContent = "City updates: enter a supported ZIP (NYC/Chicago currently). More coming.";
}

/* ====== events ====== */
searchBtn.addEventListener('click', run);
zipInput.addEventListener('keydown',e=>{ if(e.key==='Enter') run(); });

shareBtn.addEventListener('click', ()=>{
  const zip = zipClean(zipInput.value);
  const url = zip? `${location.origin}${location.pathname}?zip=${zip}` : location.href;
  navigator.clipboard.writeText(url).then(()=>toast("Share link copied."));
});

clearBtn.addEventListener('click', ()=>{
  localStorage.removeItem('zipHistory');
  zipInput.value = "";
  setPlaceLabel("");
  officialsList.innerHTML = "";
  weatherList.innerHTML = "";
  cityUpdates.textContent = "Enter a ZIP to load updates‚Ä¶";
});

/* Nav open/close */
navOpeners.forEach(a=>{
  a.addEventListener('click', (e)=>{
    e.preventDefault();
    const id = a.getAttribute('data-open');
    const dlg = byId(id);
    if(dlg && !dlg.open) dlg.showModal();
  });
});
document.querySelectorAll('[data-close]').forEach(btn=>{
  btn.addEventListener('click', (e)=>{
    const id = btn.getAttribute('data-close');
    const dlg = byId(id);
    if(dlg && dlg.open) dlg.close();
  });
});
menuBtn.addEventListener('click', ()=>{
  mobileSheet.style.display = (mobileSheet.style.display==='block'?'none':'block');
});

/* Feedback stars -> mailto */
(function(){
  const starsEl = byId('stars');
  if(!starsEl) return;
  let rating = 0;
  const draw = n => { starsEl.textContent = "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ".slice(0,n) + "‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ".slice(n); };
  starsEl.addEventListener('mousemove',e=>{
    const r = Math.min(5, Math.max(1, Math.ceil((e.offsetX/starsEl.clientWidth)*5)));
    draw(r);
  });
  starsEl.addEventListener('mouseleave',()=>draw(rating||0));
  starsEl.addEventListener('click',e=>{
    rating = Math.min(5, Math.max(1, Math.ceil((e.offsetX/starsEl.clientWidth)*5)));
    draw(rating);
  });
  byId('sendFb').addEventListener('click', ()=>{
    const note = encodeURIComponent(byId('fbNote').value||"");
    const subject = encodeURIComponent(`EagleReach feedback ‚Äî ${rating}/5`);
    const body = encodeURIComponent(`Rating: ${rating}/5\n\n${byId('fbNote').value||""}`);
    location.href = `mailto:vikebairam@gmail.com?subject=${subject}&body=${body}`;
  });
})();

/* ‚ÄúUse my location‚Äù: robust ZIP resolver */
async function handleLocate(){
  setBusy(true);
  try{
    const pos = await new Promise((res,rej)=>{
      navigator.geolocation.getCurrentPosition(res, rej, {enableHighAccuracy:true, timeout:12000, maximumAge:0});
    });
    const {latitude:lat, longitude:lon} = pos.coords;
    const z = await zipFromLatLon(lat, lon);
    if(!z) throw new Error("no-zip");
    zipInput.value = z;
    await run();
  }catch(err){
    toast("Could not resolve ZIP from your location.");
  }finally{
    setBusy(false);
  }
}
locateBtn.addEventListener('click', handleLocate);

/* Concern quick links -> prefilled email */
function openConcern(kind){
  const zip = zipClean(zipInput.value)||"(ZIP?)";
  const subject = encodeURIComponent(`[${zip}] ${kind} issue`);
  const body = encodeURIComponent(`Hello,\n\nI'd like to report a ${kind.toLowerCase()} issue in ZIP ${zip}.\n\nLocation / details:\n\nThank you.`)
  location.href = `mailto:vikebairam@gmail.com?subject=${subject}&body=${body}`; // you can swap to local 311 email if available
}
byId('concernPotholes').onclick = ()=>openConcern('Potholes');
byId('concernTrash').onclick    = ()=>openConcern('Trash');
byId('concernLights').onclick   = ()=>openConcern('Street lights');

/* Local/World news links set after search */
function setNewsLinks(zip, city, st){
  const q = encodeURIComponent(`${zip} ${city||""} ${st||""}`.trim());
  byId('openLocalNews').href = `https://news.google.com/search?q=${q}`;
}
(function initFromQuery(){
  const zp = new URL(location.href).searchParams.get('zip');
  if(zp){ zipInput.value = zp; run(); }
  setBusy(false); // default label
})();
</script>
</body>
</html>
