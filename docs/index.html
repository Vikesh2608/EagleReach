<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EagleReach</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900 min-h-screen">

  <!-- Top Nav -->
  <nav class="w-full py-4 bg-white/80 backdrop-blur border-b">
    <div class="max-w-5xl mx-auto flex items-center justify-between px-4">
      <a href="#home" class="font-semibold text-lg hover:opacity-90 flex items-center gap-2">
        <span class="text-2xl">üá∫üá∏</span>
        <span>EagleReach</span>
      </a>
      <div class="flex items-center gap-6">
        <a href="#home" class="text-sm text-gray-700 hover:text-blue-700">Home</a>
        <button id="aboutBtn"   class="text-sm text-gray-700 hover:text-blue-700">About</button>
        <button id="contactBtn" class="text-sm text-gray-700 hover:text-blue-700">Contact</button>
      </div>
    </div>
  </nav>

  <!-- Header -->
  <header id="home" class="max-w-5xl mx-auto text-center px-4">
    <h1 class="text-4xl font-bold flex items-center justify-center gap-3 mt-6">
      <span class="text-3xl">üá∫üá∏</span> <span>EagleReach</span>
    </h1>
    <p class="text-gray-600 mt-2">
      Enter your ZIP code to see upcoming elections and your elected representatives.
    </p>
  </header>

  <!-- Search Bar -->
  <section class="max-w-3xl mx-auto mt-6 px-4">
    <div class="flex items-center gap-3">
      <input id="zipInput" maxlength="5" inputmode="numeric"
             placeholder="62704"
             class="border rounded-lg px-4 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500" />
      <button id="searchBtn" onclick="run()"
              class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-5 py-2 rounded-lg">
        Search
      </button>
    </div>
    <div id="msg" class="mt-2 text-sm text-gray-600"></div>
  </section>

  <!-- Results Grid -->
  <main class="max-w-5xl mx-auto mt-8 px-4 grid md:grid-cols-2 gap-6">

    <!-- Upcoming Election -->
    <section class="bg-white rounded-2xl shadow p-5">
      <h2 class="text-xl font-semibold mb-3">Upcoming Election</h2>
      <div class="text-gray-800">
        <p><span class="font-semibold">Type:</span> General Election</p>
        <p><span class="font-semibold">Date:</span> <span id="electionDate">‚Äî</span></p>
      </div>
    </section>

    <!-- Representatives -->
    <section class="bg-white rounded-2xl shadow p-5">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold">Elected Representatives</h2>
        <button id="emailBtn"
                class="bg-purple-600 hover:bg-purple-700 text-white text-sm px-3 py-2 rounded-md">
          Generate Email
        </button>
      </div>
      <ul id="officialsList" class="mt-4 space-y-3"></ul>
    </section>

    <!-- Local Updates -->
    <section class="bg-white rounded-2xl shadow p-5 md:col-span-1">
      <h3 class="font-semibold mb-2">Local Updates</h3>
      <p class="text-gray-600 text-sm">
        Latest news and updates for your area.
      </p>
      <div class="mt-3 flex gap-3">
        <a id="newsBtn" target="_blank" rel="noopener"
           class="inline-block bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg"
           href="https://news.google.com/">Open Local News</a>
        <a id="govPortalBtn" target="_blank" rel="noopener"
           class="inline-block border px-4 py-2 rounded-lg hover:bg-gray-50"
           href="https://www.usa.gov/">USA.gov</a>
      </div>
    </section>

    <!-- Raise a Concern -->
    <section class="bg-white rounded-2xl shadow p-5 md:col-span-1">
      <h3 class="font-semibold mb-2">Raise a Concern</h3>
      <p class="text-gray-600 text-sm">
        Report city issues (311), contact your city hall, or write to your representatives.
      </p>
      <div class="mt-3 flex gap-3 flex-wrap">
        <a id="city311Btn" target="_blank" rel="noopener"
           class="inline-block border px-4 py-2 rounded-lg hover:bg-gray-50"
           href="https://www.google.com/search?q=311+city+services">Find 311 Services</a>
        <a id="cityHallBtn" target="_blank" rel="noopener"
           class="inline-block border px-4 py-2 rounded-lg hover:bg-gray-50"
           href="https://www.google.com/search?q=city+hall+contact">City Hall Contact</a>
        <a id="writeRepBtn" target="_blank" rel="noopener"
           class="inline-block border px-4 py-2 rounded-lg hover:bg-gray-50"
           href="#home">Write Your Reps</a>
      </div>
    </section>

  </main>

  <!-- Footer -->
  <footer class="max-w-5xl mx-auto px-4 py-10 text-center text-sm text-gray-500">
    ¬© 2025 EagleReach by Vikesh Sagar Bairam. All rights reserved.
  </footer>

  <!-- About Modal -->
  <div id="aboutModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-white max-w-2xl w-[92%] md:w-[700px] rounded-2xl shadow-xl p-6 relative">
      <button data-close="about" class="absolute right-3 top-3 text-gray-500 hover:text-gray-800">‚úï</button>
      <h2 class="text-2xl font-bold mb-2">About EagleReach</h2>
      <p class="text-gray-700 mb-3">
        <strong>EagleReach</strong> is an AI‚Äëpowered civic engagement assistant for the United States.
        It helps residents quickly find and contact their local, state, and federal representatives,
        see upcoming elections, and access official resources‚Äîfast.
      </p>
      <h3 class="text-lg font-semibold mt-4 mb-1">Vision</h3>
      <blockquote class="italic text-gray-700 border-l-4 border-blue-500 pl-3">
        ‚ÄúA stronger nation is one where every resident can reach their government in seconds.‚Äù
      </blockquote>
      <h3 class="text-lg font-semibold mt-4 mb-1">Created by</h3>
      <p class="text-gray-700">
        <strong>Vikesh Sagar Bairam</strong> ‚Äî Generative AI, Cloud & Data Engineering, DevOps.
        MS in Information Systems & Management (University of Illinois Springfield).
        Built to empower everyone‚Äîfrom students to seniors, from community leaders to CEOs‚Äîto connect and be heard.
      </p>
      <p class="text-xs text-gray-500 mt-4">¬© 2025 EagleReach by Vikesh Sagar Bairam.</p>
    </div>
  </div>

  <!-- Contact Modal -->
  <div id="contactModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-white max-w-md w-[92%] rounded-2xl shadow-xl p-6 relative">
      <button data-close="contact" class="absolute right-3 top-3 text-gray-500 hover:text-gray-800">‚úï</button>
      <h2 class="text-2xl font-bold mb-3">Contact</h2>
      <div class="space-y-3">
        <a class="block border rounded-lg p-3 hover:bg-gray-50"
           href="mailto:vikebairam@gmail.com?subject=EagleReach%20Inquiry">
          ‚úâÔ∏è Email ‚Äî vikebairam@gmail.com
        </a>
        <a class="block border rounded-lg p-3 hover:bg-gray-50"
           href="https://www.linkedin.com/in/vikesh-bairam-219769258/" target="_blank" rel="noopener">
          üîó LinkedIn ‚Äî vikesh-bairam-219769258
        </a>
        <a class="block border rounded-lg p-3 hover:bg-gray-50"
           href="https://github.com/Vikesh2608" target="_blank" rel="noopener">
          üíª GitHub ‚Äî @Vikesh2608
        </a>
      </div>
    </div>
  </div>

  <!-- Script -->
  <script>
    // ---------- CONFIG ----------
    const BACKEND_BASE = "https://eaglereach-1.onrender.com";

    // ---------- ELEMENTS ----------
    const zipInput   = document.getElementById("zipInput");
    const searchBtn  = document.getElementById("searchBtn");
    const listEl     = document.getElementById("officialsList");
    const msgEl      = document.getElementById("msg");
    const electionDateEl = document.getElementById("electionDate");

    const aboutBtn = document.getElementById("aboutBtn");
    const contactBtn = document.getElementById("contactBtn");
    const aboutModal = document.getElementById("aboutModal");
    const contactModal = document.getElementById("contactModal");

    const newsBtn = document.getElementById("newsBtn");
    const govPortalBtn = document.getElementById("govPortalBtn");
    const city311Btn = document.getElementById("city311Btn");
    const cityHallBtn = document.getElementById("cityHallBtn");
    const writeRepBtn = document.getElementById("writeRepBtn");
    const emailBtn = document.getElementById("emailBtn");

    // ---------- HELPERS ----------
    function setMsg(t, cls="text-gray-600"){ msgEl.className="mt-2 text-sm "+cls; msgEl.textContent=t; }
    function escapeHtml(s=""){ return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"); }
    function asLink(url){ if(!url) return ""; const d=url.replace(/^https?:\/\//i,"");
      return `<a class="text-blue-600 hover:underline break-all" href="${escapeHtml(url)}" target="_blank" rel="noopener">${escapeHtml(d)}</a>`; }

    function officialRow(o={}){
      const name=o.name||"N/A", office=o.office||"Official", party=o.party?` ‚Äî ${o.party}`:"";
      const phone=(o.phones&&o.phones[0])||"", email=(o.emails&&o.emails[0])||"", url=(o.urls&&o.urls[0])||"";
      let h=`
        <li class="border rounded-xl p-4 bg-white">
          <p class="font-semibold">${escapeHtml(name)} ‚Äî <span class="text-gray-600">${escapeHtml(office)}</span>${escapeHtml(party)}</p>
          ${url? `<p class="mt-1">${asLink(url)}</p>`:""}
          ${phone? `<p class="text-gray-700 mt-1">üìû ${escapeHtml(phone)}</p>`:""}
          ${email? `<p class="text-gray-700 mt-1">‚úâÔ∏è ${escapeHtml(email)}</p>`:""}
        </li>`;
      return h;
    }

    function renderOfficials(data){
      const officials = Array.isArray(data?.officials)?data.officials:[];
      listEl.innerHTML = officials.length ? officials.map(officialRow).join("")
        : `<li class="text-gray-600">No officials found for this ZIP.</li>`;
    }

    function nextGeneralElectionDate(){
      const now = new Date();
      for (let y = now.getFullYear(); y <= now.getFullYear()+1; y++){
        const nov1 = new Date(y, 10, 1);
        const dow = nov1.getDay();
        const firstMon = new Date(y,10, (dow===1?1: ((8 - dow) % 7)));
        const firstTueAfterMon = new Date(firstMon); firstTueAfterMon.setDate(firstMon.getDate()+1);
        if (firstTueAfterMon > now) return firstTueAfterMon;
      }
      return null;
    }
    function formatDate(d){ return d ? d.toLocaleDateString(undefined,{year:"numeric",month:"long",day:"numeric"}) : "‚Äî"; }

    function setZipDependentLinks(zip){
      if(!zip) return;
      newsBtn.href = `https://news.google.com/search?q=${encodeURIComponent(zip)}&hl=en-US&gl=US&ceid=US:en`;
      govPortalBtn.href = `https://www.usa.gov/`;
      city311Btn.href = `https://www.google.com/search?q=${encodeURIComponent(zip)}+311+city+services`;
      cityHallBtn.href = `https://www.google.com/search?q=${encodeURIComponent(zip)}+city+hall+contact`;
      writeRepBtn.href = "#home";
    }

    async function run(){
      const zip=(zipInput.value||"").trim();
      if(!/^\d{5}$/.test(zip)){ setMsg("Please enter a valid 5‚Äëdigit US ZIP.","text-red-600"); return; }
      searchBtn.disabled=true; setMsg("Loading‚Ä¶","text-gray-500"); listEl.innerHTML="";
      try{
        const res=await fetch(`${BACKEND_BASE}/officials?zip=${encodeURIComponent(zip)}`,{headers:{Accept:"application/json"}});
        const txt=await res.text();
        if(!res.ok) throw new Error(`API ${res.status}: ${txt}`);
        const data = JSON.parse(txt);
        renderOfficials(data);
        setMsg(`Showing results for ${zip}`);
        setZipDependentLinks(zip);
      }catch(e){
        console.error(e);
        setMsg((e?.message||"Fetch failed")+" (see DevTools ‚Üí Network)","text-red-600");
      }finally{ searchBtn.disabled=false; }
    }
    window.run = run;
    zipInput.addEventListener("keydown", e => { if(e.key==="Enter") run(); });

    // About / Contact modals
    const openModal  = (el)=>{ el.classList.remove("hidden"); el.classList.add("flex"); };
    const closeModal = (el)=>{ el.classList.add("hidden"); el.classList.remove("flex"); };
    aboutBtn.addEventListener("click",   ()=>openModal(aboutModal));
    contactBtn.addEventListener("click", ()=>openModal(contactModal));
    [aboutModal, contactModal].forEach(m=>{
      m.addEventListener("click",(e)=>{ if(e.target===m) closeModal(m); });
    });
    document.querySelectorAll('[data-close="about"]').forEach(b=>b.addEventListener("click",()=>closeModal(aboutModal)));
    document.querySelectorAll('[data-close="contact"]').forEach(b=>b.addEventListener("click",()=>closeModal(contactModal)));

    // Generate Email
    emailBtn.addEventListener("click", () => {
      const cards = listEl.querySelectorAll("li");
      const emails = [];
      cards.forEach(li=>{
        const t = li.textContent;
        const match = t.match(/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/ig);
        if(match) emails.push(...match);
      });
      if(!emails.length){ alert("No public emails available for these officials."); return; }
      const unique = [...new Set(emails)].slice(0,10);
      const zip = (zipInput.value||"").trim();
      const subject = encodeURIComponent(`Constituent inquiry from ZIP ${zip}`);
      const body = encodeURIComponent(`Dear Representative,\n\nI am a constituent from ZIP ${zip}. [Write your message here]\n\nThank you,\n[Your Name]`);
      window.location.href = `mailto:${unique.join(",")}?subject=${subject}&body=${body}`;
    });

    // Warmup backend & set election date
    fetch(`${BACKEND_BASE}/health`).catch(()=>{});
    electionDateEl.textContent = formatDate(nextGeneralElectionDate());
  </script>
</body>
</html>
