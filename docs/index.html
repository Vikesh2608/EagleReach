<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EagleReach</title>

  <style>
    :root{
      --bg:#ffffff;
      --card:#ffffff;
      --ink:#0e1628;
      --muted:#6b7280;
      --blue:#1b5fd1;
      --blue-600:#174fb0;
      --ghost:#e8eefb;
      --border:#e5e7eb;
      --shadow:0 6px 18px rgba(16,24,40,.06);
      --danger:#be123c;
      --ok:#0f8a3b;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);
      font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";}
    .topbar{position:sticky;top:0;z-index:20;display:flex;align-items:center;justify-content:space-between;padding:12px 18px;background:#0f3f8c;color:#fff;box-shadow:var(--shadow)}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .flag{font-size:20px}
    .name{font-size:18px}
    .nav a{color:#fff;text-decoration:none;margin-left:18px;opacity:.95}
    .nav a:hover{opacity:1;text-decoration:underline}
    .subhead{text-align:center;font-size:12px;color:#d7e3ff;background:#0f3f8c;padding-bottom:10px}
    .container{max-width:1080px;margin:22px auto;padding:0 12px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:var(--shadow)}
    .card h3{margin:0 0 12px 0}
    .zip-row{display:flex;gap:10px;flex-wrap:wrap}
    #zipInput{flex:1 1 320px;min-width:320px;padding:11px 12px;border:1px solid var(--border);border-radius:10px;font-size:16px}
    .btn{border:none;border-radius:10px;padding:10px 14px;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;justify-content:center;font-weight:600;color:#fff;transition:all .1s ease}
    .btn.primary{background:var(--blue)} .btn.primary:hover{background:var(--blue-600)}
    .btn.ghost{background:var(--ghost);color:#0f2b64}
    .btn.dark{background:#18233b}
    .btn.block{width:100%}
    .row{display:flex;align-items:center}.wrap{flex-wrap:wrap}.gap{gap:10px}.stack{display:flex;flex-direction:column;gap:10px}
    .muted{color:var(--muted);margin-top:8px}
    .zip-actions{margin-top:8px;display:flex;gap:10px;flex-wrap:wrap}
    .chip{background:#eef2f7;border-radius:999px;padding:8px 14px;color:#1d2a45;text-decoration:none}
    .pill{color:#fff;text-decoration:none;border-radius:999px;padding:8px 14px}
    .red{background:#d9373f}.purple{background:#7526d9}.green{background:#0f8a3b}.blue{background:#1c4fd7}.orange{background:#d47500}.amber{background:#d18f00}
    #officials .official{border:1px solid var(--border);border-radius:12px;padding:12px;margin-bottom:10px}
    .official .title{font-size:12px;color:var(--muted);margin-bottom:4px}
    .official .name{font-weight:700;margin-bottom:8px}
    .official .row{gap:8px}
    .weather-item{border:1px solid var(--border);border-radius:10px;padding:10px;margin-bottom:8px;background:#fff}
    .note{margin-top:10px;font-size:13px;color:var(--muted)}
    .alert{margin-top:10px;border-left:4px solid var(--danger);background:#fff1f2;color:#7f1d1d;padding:10px;border-radius:8px}
    .ok{border-left:4px solid var(--ok);background:#ecfdf5;color:#064e3b}
    .footer{color:#8a93a7;text-align:center;padding:28px 8px}
    dialog.modal{border:none;border-radius:16px;padding:0;width:min(760px,92%)} dialog::backdrop{background:rgba(0,0,0,.45)}
    .modal-body{padding:20px;position:relative}.close{position:absolute;right:12px;top:10px;background:#f2f4f8;border:none;border-radius:8px;padding:6px 10px;cursor:pointer}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand"><span class="flag">üá∫üá∏</span><span class="name">EagleReach</span></div>
    <nav class="nav">
      <a href="#" data-open="about">About</a>
      <a href="#" data-open="founder">Founder</a>
      <a href="#" data-open="contact">Contact</a>
      <a href="#" data-open="feedback">Feedback</a>
    </nav>
  </header>
  <div class="subhead">Civic info, fast &amp; free ‚Äî built for everyone.</div>

  <main class="container">
    <section class="card">
      <h3>Enter ZIP</h3>
      <div class="zip-row">
        <input id="zipInput" inputmode="numeric" pattern="[0-9]*" maxlength="5" placeholder="ZIP (e.g., 45220)" />
        <button id="btnLocate" class="btn ghost">üìç Use my location</button>
        <button id="btnSearch" class="btn primary">üîé Search</button>
      </div>
      <div class="zip-actions">
        <button id="btnCopy" class="btn ghost">üîó Copy Share Link</button>
        <button id="btnClear" class="btn ghost">üßπ Clear history</button>
      </div>
      <div id="placeLabel" class="muted"></div>
      <div id="zipAlert"></div>
    </section>

    <div class="grid">
      <section class="card">
        <h3>Elected Representatives</h3>
        <div id="officials"></div>
        <div id="officialsAlert"></div>
        <div class="note">Sources: Zippopotam (ZIP), WhoIsMyRepresentative (House), GovTrack (Senate fallback), Open-Meteo (weather).</div>
      </section>

      <aside class="card">
        <h3>Voter Info &amp; Education</h3>
        <div class="stack">
          <a class="btn primary block" target="_blank" href="https://www.usa.gov/how-to-vote">How to vote (USA.gov)</a>
          <a class="btn primary block" target="_blank" href="https://vote.gov/">Register to vote</a>
          <a class="btn primary block" target="_blank" href="https://www.usa.gov/election-office">Find your Election Office</a>
        </div>
      </aside>
    </div>

    <div class="grid">
      <section class="card">
        <h3>News</h3>
        <p class="muted">Opens news in a new tab.</p>
        <div class="row gap">
          <a id="openLocalNews" class="btn dark" target="_blank" rel="noopener">Open Local News</a>
          <a id="openWorldNews" class="btn dark" target="_blank" rel="noopener">World News</a>
        </div>
      </section>

      <aside class="card">
        <h3>Upcoming Elections</h3>
        <div id="elections"></div>
      </aside>
    </div>

    <div class="grid">
      <section class="card">
        <h3>Traffic</h3>
        <p class="muted">Open live traffic for your area in Google Maps.</p>
        <a id="openTraffic" class="btn primary" target="_blank" rel="noopener">Open Traffic Map</a>
      </section>

      <aside class="card">
        <h3>Local Weather (7-day)</h3>
        <div id="weather"></div>
      </aside>
    </div>

    <section class="card">
      <h3>Raise a Concern</h3>
      <p class="muted">Report city issues (311), contact your city hall, or write to your representatives.</p>
      <div class="row wrap gap">
        <a class="chip" id="concernPotholes" target="_blank">Potholes</a>
        <a class="chip" id="concernTrash" target="_blank">Trash</a>
        <a class="chip" id="concernLights" target="_blank">Street lights</a>
      </div>
    </section>

    <section class="card">
      <h3>Emergency</h3>
      <div class="row wrap gap">
        <a class="pill red" href="tel:911">911 ‚Äî Emergency</a>
        <a class="pill purple" href="tel:988">988 ‚Äî Suicide &amp; Crisis</a>
        <a class="pill green" href="tel:211">211 ‚Äî Community Services</a>
        <a class="pill blue" href="tel:311">311 ‚Äî City Services</a>
        <a class="pill orange" href="tel:811">811 ‚Äî Before You Dig</a>
        <a class="pill amber" href="tel:18002221222">Poison Control</a>
      </div>
    </section>

    <footer class="footer">¬© 2025 EagleReach</footer>
  </main>

  <!-- Modals -->
  <dialog id="aboutModal" class="modal">
    <div class="modal-body">
      <button class="close" data-close>√ó</button>
      <h2>About EagleReach</h2>
      <p>
        EagleReach is a civic information platform designed to make government data accessible,
        transparent, and useful for everyone. The platform provides U.S. residents with quick access
        to their elected representatives, voter resources, local weather updates, election information,
        and civic services ‚Äî all without requiring a login.
      </p>
      <p>
        Built with a passion for technology and community service, EagleReach empowers individuals
        to engage more directly with their democracy, fostering awareness and participation in everyday civic life.
      </p>
    </div>
  </dialog>

  <dialog id="founderModal" class="modal">
    <div class="modal-body">
      <button class="close" data-close>√ó</button>
      <h2>Founder ‚Äî Vikesh Sagar Bairam</h2>
      <p>
        Vikesh Sagar Bairam is a technology professional with expertise in <strong>Data Engineering,
        Cloud Platforms, DevOps, and AI/ML solutions</strong>. He holds a <strong>Master‚Äôs in Information Systems &amp; Management</strong>
        from the <strong>University of Illinois, Springfield</strong>, along with Bachelor‚Äôs degrees in <strong>Psychology &amp; Arts</strong>
        (Osmania University) and <strong>Computer Science</strong>.
      </p>
      <p>
        His career spans multiple industries, having served as a <strong>Data Specialist/Analyst</strong> at <strong>Jabil</strong>,
        <strong> Data Analyst</strong> at <strong>S&amp;P Global (IHS Markit)</strong>, <strong>DevOps Engineer</strong> at <strong>Techtate Systems</strong>,
        <strong> DevOps Intern</strong> at <strong>Surfaces by Pacific</strong>, and <strong>Supply Chain Specialist</strong> at <strong>Auscomp Computers</strong>.
        He is a <strong>Google Cloud Certified Professional Data Engineer</strong> with experience across AWS and GCP.
      </p>
      <p>
        Passionate about community service and civic technology, Vikesh created EagleReach to make civic information
        easier to access ‚Äî building tools that optimize processes, delight end-users, and deliver meaningful impact.
      </p>
    </div>
  </dialog>

  <dialog id="contactModal" class="modal">
    <div class="modal-body">
      <button class="close" data-close>√ó</button>
      <h2>Contact</h2>
      <p><a class="btn dark block" target="_blank" href="https://www.linkedin.com/in/vikesh-bairam-219769258/">LinkedIn</a></p>
      <p><a class="btn dark block" target="_blank" href="https://github.com/vikesh2608">GitHub</a></p>
      <p><a class="btn primary block" href="mailto:vikebairam@gmail.com?subject=EagleReach%20Feedback&body=Hi%20Vikesh,%0D%0A%0D%0A">Email: vikebairam@gmail.com</a></p>
    </div>
  </dialog>

  <dialog id="feedbackModal" class="modal">
    <div class="modal-body">
      <button class="close" data-close>√ó</button>
      <h2>Feedback</h2>
      <p>We‚Äôd love your thoughts, ideas, and bug reports.</p>
      <a class="btn primary block" href="mailto:vikebairam@gmail.com?subject=EagleReach%20Feedback&body=Hi%20Vikesh,%0D%0A%0D%0A">Email feedback</a>
    </div>
  </dialog>

  <script>
    // -------- CONFIG --------
    const API_BASE = "https://eaglereach.fly.dev"; // used first; UI falls back automatically if unavailable

    // Elements
    const zipInput = document.getElementById("zipInput");
    const btnSearch = document.getElementById("btnSearch");
    const btnLocate = document.getElementById("btnLocate");
    const btnCopy = document.getElementById("btnCopy");
    const btnClear = document.getElementById("btnClear");
    const placeLabel = document.getElementById("placeLabel");
    const zipAlert = document.getElementById("zipAlert");
    const officialsEl = document.getElementById("officials");
    const officialsAlert = document.getElementById("officialsAlert");
    const weatherEl = document.getElementById("weather");
    const electionsEl = document.getElementById("elections");
    const openLocalNews = document.getElementById("openLocalNews");
    const openWorldNews = document.getElementById("openWorldNews");
    const openTraffic = document.getElementById("openTraffic");
    const concernPotholes = document.getElementById("concernPotholes");
    const concernTrash = document.getElementById("concernTrash");
    const concernLights = document.getElementById("concernLights");

    // Modals
    const modals = {
      about: document.getElementById("aboutModal"),
      founder: document.getElementById("founderModal"),
      contact: document.getElementById("contactModal"),
      feedback: document.getElementById("feedbackModal"),
    };
    document.querySelectorAll('[data-open]').forEach(a=>{
      a.addEventListener('click', e=>{ e.preventDefault(); modals[a.dataset.open]?.showModal(); });
    });
    document.querySelectorAll('[data-close]').forEach(btn=>{
      btn.addEventListener('click', ()=> btn.closest('dialog').close());
    });

    // Helpers
    const ok = r => { if(!r.ok) throw new Error(`HTTP ${r.status}`); return r; };
    const j  = r => r.json();
    const sleep = (ms)=> new Promise(res=>setTimeout(res, ms));

    function setAlert(node, type, msg){
      node.innerHTML = msg ? `<div class="alert ${type==='ok'?'ok':''}">${msg}</div>` : "";
    }
    function setPlaceLabel(obj){
      const { zip, place, state } = obj || {};
      placeLabel.textContent = zip ? `${zip} ‚Äî ${place||""}${place?", ":""}${state||""}` : "";
    }

    // Fallbackable fetchers
    async function fetchZipinfo(zip){
      // Try backend
      try { return await fetch(`${API_BASE}/zipinfo?zip=${zip}`).then(ok).then(j); }
      catch(_) {}
      // Fallback: Zippopotam (CORS OK)
      const z = await fetch(`https://api.zippopotam.us/us/${zip}`).then(ok).then(j);
      const p = z.places && z.places[0] || {};
      return {
        zip: z["post code"] || zip,
        place: p["place name"],
        state: p["state"],
        state_abbr: p["state abbreviation"],
        lat: p["latitude"] ? parseFloat(p["latitude"]) : null,
        lon: p["longitude"] ? parseFloat(p["longitude"]) : null,
      };
    }

    async function fetchReverseZip(lat, lon){
      try { return await fetch(`${API_BASE}/reverse-zip?lat=${lat}&lon=${lon}`).then(ok).then(j); }
      catch(_) {}
      const data = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`).then(ok).then(j);
      return {
        zip: data.postcode,
        place: data.city || data.locality || data.principalSubdivision,
        state: data.principalSubdivision,
        lat, lon
      };
    }

    async function fetchWeather(zipinfo){
      const {lat, lon} = zipinfo || {};
      if (lat==null || lon==null) return {days:[]};
      try { return await fetch(`${API_BASE}/weather?zip=${zipinfo.zip}`).then(ok).then(j); }
      catch(_) {}
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=auto`;
      const wx = await fetch(url).then(ok).then(j);
      const map = {
        0:"Clear",1:"Mainly clear",2:"Partly cloudy",3:"Cloudy",45:"Fog",48:"Rime fog",51:"Light drizzle",53:"Moderate drizzle",55:"Dense drizzle",
        56:"Freezing drizzle",57:"Freezing drizzle",61:"Light rain",63:"Moderate rain",65:"Heavy rain",66:"Freezing rain",67:"Freezing rain",
        71:"Light snow",73:"Moderate snow",75:"Heavy snow",77:"Snow grains",80:"Rain showers",81:"Rain showers",82:"Violent showers",
        85:"Snow showers",86:"Snow showers",95:"Thunderstorm",96:"Thunderstorm (hail)",99:"Thunderstorm (hail)"
      };
      const days = (wx.daily.time||[]).map((d,i)=>({
        date: d,
        summary: map[(wx.daily.weathercode||[])[i]] || "Weather",
        max: (wx.daily.temperature_2m_max||[])[i],
        min: (wx.daily.temperature_2m_min||[])[i],
      }));
      return {days};
    }

    async function fetchOfficials(zip, state_abbr){
      // Try backend (includes House via WIMR)
      try { return await fetch(`${API_BASE}/officials?zip=${zip}`).then(ok).then(j); }
      catch(_) {}
      // Fallback: Senators from GovTrack; Mayor link helper
      const res = {officials:[]};
      if (state_abbr){
        try{
          const gt = await fetch(`https://www.govtrack.us/api/v2/role?current=true&role_type=senator&state=${state_abbr}`).then(ok).then(j);
          for(const role of (gt.objects||[])){
            const person = role.person||{};
            res.officials.push({
              name:`${person.firstname||""} ${person.lastname||""}`.trim(),
              office:"United States Senator",
              party:role.party,
              phones: role.phone ? [role.phone] : [],
              urls: person.link ? [person.link] : []
            });
          }
        }catch(_){}
      }
      // Add mayor helper link; actual mayor API usually needs backend due to CORS
      res.officials.push({
        name:`${state_abbr||""} City Mayor`,
        office:"Mayor",
        party:"",
        phones:[],
        urls:[`https://www.google.com/search?q=${encodeURIComponent((placeLabel.textContent||"").split("‚Äî")[1]||"city")+" mayor official site"}`]
      });
      return res;
    }

    function renderOfficials(payload){
      officialsEl.innerHTML = "";
      setAlert(officialsAlert, "", "");
      const list = (payload && payload.officials) || [];
      if (!list.length){
        setAlert(officialsAlert,"", "No officials found for this ZIP right now.");
        return;
      }
      list.forEach(o=>{
        const card = document.createElement("div");
        card.className="official";
        const title = document.createElement("div"); title.className="title"; title.textContent=o.office||"Official";
        const name  = document.createElement("div"); name.className="name"; name.textContent=`${o.name||"Unknown"}${o.party?` ‚Äî ${o.party}`:""}`;
        const row   = document.createElement("div"); row.className="row"; row.style.gap="8px";
        if (o.urls && o.urls[0]){ const a=document.createElement("a"); a.className="btn ghost"; a.href=o.urls[0]; a.target="_blank"; a.textContent="Website"; row.appendChild(a); }
        if (o.phones && o.phones[0]){ const a=document.createElement("a"); a.className="btn ghost"; a.href=`tel:${o.phones[0].replace(/[^0-9+]/g,"")}`; a.textContent="Call"; row.appendChild(a); }
        card.append(title,name,row); officialsEl.appendChild(card);
      });
    }

    function renderWeather(payload){
      weatherEl.innerHTML="";
      const days=(payload&&payload.days)||[];
      if (!days.length){ weatherEl.innerHTML=`<div class="muted">Weather unavailable for this ZIP right now.</div>`; return; }
      days.forEach(d=>{
        const div=document.createElement("div"); div.className="weather-item";
        div.textContent=`${d.date}: ${d.summary} (High ${d.max}¬∞ / Low ${d.min}¬∞)`; weatherEl.appendChild(div);
      });
    }

    function renderElections(){
      electionsEl.innerHTML="";
      const div=document.createElement("div"); div.className="chip";
      div.textContent="Next Federal: November 3, 2025"; electionsEl.appendChild(div);
    }

    function wireContextLinks(z){
      const loc = z.place || z.zip || "";
      openLocalNews.href = `https://news.google.com/search?q=${encodeURIComponent(loc)}&hl=en-US&gl=US&ceid=US:en`;
      openWorldNews.href = `https://news.google.com/topstories?hl=en-US&gl=US&ceid=US:en`;
      openTraffic.href    = `https://www.google.com/maps/@?api=1&map_action=map&layer=traff&query=${encodeURIComponent(loc)}`;
      const cityState = `${z.place||""} ${z.state||""}`.trim();
      concernPotholes.href = `https://www.google.com/search?q=${encodeURIComponent(cityState+" pothole report")}`;
      concernTrash.href    = `https://www.google.com/search?q=${encodeURIComponent(cityState+" bulk trash pickup")}`;
      concernLights.href   = `https://www.google.com/search?q=${encodeURIComponent(cityState+" street light report")}`;
    }

    async function loadForZip(zip){
      if (!/^\d{5}$/.test(zip)){ setAlert(zipAlert,"", "Please enter a valid 5-digit ZIP."); return; }
      setAlert(zipAlert,"ok","Loading‚Ä¶"); await sleep(50);

      let z;
      try{ z = await fetchZipinfo(zip); }
      catch(e){ setAlert(zipAlert,"", "Could not resolve city/state for this ZIP."); return; }

      setPlaceLabel({zip:z.zip, place:z.place, state:z.state});
      wireContextLinks(z);

      // Officials
      try{
        const o = await fetchOfficials(z.zip, (z.state_abbr||"").toUpperCase());
        renderOfficials(o);
      }catch(e){
        renderOfficials(null);
        setAlert(officialsAlert,"", "Officials could not be loaded right now.");
      }

      // Weather
      try{ const w = await fetchWeather(z); renderWeather(w); } catch(_){ renderWeather(null); }

      // Elections (static helper)
      renderElections();

      // Update URL
      const url=new URL(location.href); url.searchParams.set("zip",z.zip); history.replaceState({}, "", url);
      setAlert(zipAlert,"ok","Ready");
      setTimeout(()=>setAlert(zipAlert,"",""), 1000);
    }

    async function useMyLocation(){
      if (!("geolocation" in navigator)){ setAlert(zipAlert,"", "Location not supported on this device."); return; }
      setAlert(zipAlert,"ok","Resolving your location‚Ä¶");
      navigator.geolocation.getCurrentPosition(async pos=>{
        try{
          const {latitude, longitude}=pos.coords;
          const rev=await fetchReverseZip(latitude, longitude);
          if (!rev.zip) throw new Error("No ZIP for location");
          zipInput.value = String(rev.zip).slice(0,5);
          await loadForZip(zipInput.value);
        }catch(e){
          setAlert(zipAlert,"", "Could not resolve ZIP from your location. You can type a ZIP manually.");
        }
      }, _=> setAlert(zipAlert,"", "Permission denied or location unavailable."), {enableHighAccuracy:true, timeout:12000, maximumAge:0});
    }

    // Events
    btnSearch.addEventListener("click", ()=> loadForZip(zipInput.value.trim()));
    btnLocate.addEventListener("click", useMyLocation);
    btnCopy.addEventListener("click", ()=>{
      const url = new URL(location.href);
      const zip = zipInput.value.trim();
      if (/^\d{5}$/.test(zip)) url.searchParams.set("zip", zip);
      navigator.clipboard.writeText(url.toString()).then(()=> setAlert(zipAlert,"ok","Share link copied!"));
      setTimeout(()=>setAlert(zipAlert,"",""), 1000);
    });
    btnClear.addEventListener("click", ()=>{
      zipInput.value=""; placeLabel.textContent=""; history.replaceState({}, "", location.pathname);
      officialsEl.innerHTML=""; weatherEl.innerHTML=""; electionsEl.innerHTML=""; setAlert(zipAlert,"","")
    });
    zipInput.addEventListener("input", ()=>{
      const v = zipInput.value.replace(/\D/g,"").slice(0,5);
      if (zipInput.value!==v) zipInput.value=v;
      if (v.length===5) loadForZip(v);
    });

    (function init(){
      const url=new URL(location.href); const z=(url.searchParams.get("zip")||"").trim();
      if (/^\d{5}$/.test(z)){ zipInput.value=z; loadForZip(z); }
    })();
  </script>
</body>
</html>
