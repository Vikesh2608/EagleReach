<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>EagleReach â€” Civic Assistant</title>
  <meta name="description" content="EagleReach: a free, openâ€‘source civic assistant for U.S. residents."/>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Ctext y='52' x='6' font-size='56'%3EğŸ¦…%3C/text%3E%3C/svg%3E"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .hero { background: linear-gradient(120deg,#0a2540 0%,#123a60 60%,#192e4d 100%); position:relative; color:#fff; }
    .hero::after{ content:""; position:absolute; inset:0;
      background: radial-gradient(1200px 500px at 80% -50%, rgba(255,255,255,.10), transparent 60%),
                  radial-gradient(800px 400px at 10% -30%, rgba(255,255,255,.08), transparent 60%); pointer-events:none; }
    .card { @apply bg-white/90 backdrop-blur shadow rounded-2xl border border-slate-200; }
    .card h3{ @apply text-lg font-semibold text-slate-800; }
    .muted{ @apply text-slate-500; }
    .btn{ @apply inline-flex items-center justify-center gap-2 rounded-xl px-3 py-2 text-sm font-medium border border-slate-300 bg-white hover:bg-slate-50; }
    .btn-primary{ @apply bg-blue-600 text-white border-blue-600 hover:bg-blue-700; }
    .pill{ @apply inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-medium border border-slate-300 bg-white; }
    .link{ @apply text-blue-700 hover:underline; }
    .kpi{ @apply text-sm text-slate-600; }
    .divider{ width:1px; background-color:rgba(100,116,139,.35); }
    @media (prefers-color-scheme: dark){
      body{ background:#0b1220; color:#e5e7eb; }
      .card{ @apply bg-slate-900/60 text-slate-100 border-slate-700; }
      .card h3{ @apply text-slate-100; }
      .muted{ @apply text-slate-400; }
      .btn{ @apply bg-slate-800 border-slate-700 text-slate-100 hover:bg-slate-700; }
      .btn-primary{ @apply bg-blue-600 border-blue-600 hover:bg-blue-700 text-white; }
      .link{ @apply text-blue-400; }
      .divider{ background-color:rgba(100,116,139,.5); }
    }
  </style>
</head>
<body class="min-h-screen">
  <!-- Header -->
  <header class="hero">
    <div class="max-w-6xl mx-auto px-4 py-6 relative">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <span class="text-3xl">ğŸ¦…</span><span class="text-2xl">ğŸ‡ºğŸ‡¸</span>
          <div>
            <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">EagleReach</h1>
            <p class="text-sm text-slate-200">Openâ€‘source civic assistant for U.S. residents</p>
          </div>
        </div>
        <nav class="flex items-center gap-2">
          <button id="aboutBtn" class="btn">About</button>
          <a href="#contact" class="btn">Contact</a>
        </nav>
      </div>
      <div class="mt-6">
        <blockquote class="text-slate-200 italic max-w-3xl">
          â€œGovernment of the people, by the people, for the people, shall not perish from the Earth.â€
          <span class="not-italic">â€” Abraham Lincoln</span>
        </blockquote>
      </div>
    </div>
  </header>

  <!-- Controls -->
  <section class="max-w-6xl mx-auto px-4 py-5">
    <div class="card p-4">
      <div class="flex flex-col lg:flex-row items-stretch gap-3">
        <input id="zipInput" type="text" inputmode="numeric" maxlength="10" placeholder="Enter ZIP (e.g., 62704)"
               class="w-full lg:w-72 rounded-xl border border-slate-300 px-4 py-2"/>
        <div class="flex items-center gap-3 flex-wrap">
          <button id="locBtn" class="btn" title="Use my location">ğŸ“ Use my location</button>
          <span class="pill">OR</span>
          <div class="divider h-6 hidden lg:block"></div>
          <button id="goBtn" class="btn-primary">Search</button>
          <button id="shareBtn" class="btn">ğŸ”— Copy share link</button>
          <button id="clearBtn" class="btn">ğŸ§¹ Clear history</button>
        </div>
      </div>
      <div id="history" class="mt-3 text-sm muted"></div>
      <div id="status" class="mt-2 text-sm"></div>
    </div>
  </section>

  <!-- Grid: Left col is main flow; Right col has smaller cards -->
  <main class="max-w-6xl mx-auto px-4 pb-12 grid grid-cols-1 lg:grid-cols-3 gap-5">
    <!-- LEFT COLUMN -->
    <div class="lg:col-span-2 space-y-5">
      <!-- Officials -->
      <section class="card p-4">
        <div class="flex items-center justify-between">
          <h3>Elected Representatives</h3>
          <div class="flex gap-2">
            <button id="copyOfficialsBtn" class="pill">Copy Officials</button>
            <button id="genEmailBtn" class="pill">Generate Email</button>
          </div>
        </div>
        <div id="officialsMeta" class="kpi mt-1"></div>
        <div id="officialsList" class="mt-3 space-y-3"></div>
      </section>

      <!-- Voter Info (moved directly under reps) -->
      <section class="card p-4">
        <h3 class="mb-2">Voter Info &amp; Education</h3>
        <div id="voterBlock" class="space-y-2 text-sm"></div>
      </section>

      <!-- Upcoming Elections -->
      <section class="card p-4">
        <h3 class="mb-2">Upcoming Elections</h3>
        <div class="text-sm" id="elexBlock">
          <ul class="list-disc pl-5 space-y-1">
            <li><strong>Federal general elections:</strong> Tuesday, November in even-numbered years.</li>
            <li><strong>Primaries & local elections:</strong> Dates vary by state/county â€” see links in â€œVoter Infoâ€.</li>
          </ul>
          <p class="muted mt-2">Use the official links above for stateâ€‘specific calendars, polling info, and ID rules.</p>
        </div>
      </section>

      <!-- City Updates -->
      <section class="card p-4">
        <h3 class="">City Updates</h3>
        <div id="cityList" class="mt-2 space-y-2 text-sm"></div>
      </section>

      <!-- News (under City Updates) -->
      <section class="card p-4">
        <div class="flex items-center justify-between">
          <h3>News</h3>
          <span class="muted text-xs">Links open Google News</span>
        </div>
        <div id="newsButtons" class="mt-2 flex flex-wrap gap-2"></div>
        <div id="newsList" class="mt-3 space-y-1 text-sm"></div>
      </section>

      <!-- Feedback / Comments -->
      <section class="card p-4">
        <div class="flex items-center justify-between">
          <h3>Feedback &amp; Comments</h3>
          <span class="muted text-xs">Share your thoughts</span>
        </div>
        <form id="fbForm" class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-3">
          <input required id="fbName" class="rounded-xl border border-slate-300 px-3 py-2" placeholder="Your name"/>
          <input required id="fbEmail" type="email" class="rounded-xl border border-slate-300 px-3 py-2" placeholder="Email"/>
          <div class="md:col-span-3 flex gap-2">
            <textarea required id="fbMsg" class="flex-1 rounded-xl border border-slate-300 px-3 py-2" rows="3" placeholder="Write your feedback..."></textarea>
            <button class="btn-primary shrink-0">Send</button>
          </div>
        </form>
        <div id="fbStatus" class="mt-2 text-sm"></div>
        <div id="fbList" class="mt-4 space-y-2"></div>
      </section>
    </div>

    <!-- RIGHT COLUMN -->
    <div class="space-y-5">
      <!-- Weather -->
      <section class="card p-4">
        <h3 class="mb-2">Weather (7â€‘day)</h3>
        <div id="weatherList" class="space-y-2 text-sm"></div>
        <div id="weatherMeta" class="kpi mt-2"></div>
      </section>

      <!-- Roadworks -->
      <section class="card p-4">
        <h3 class="mb-2">Roadworks near you</h3>
        <div id="roadList" class="space-y-2 text-sm"></div>
        <div id="roadMeta" class="kpi mt-2"></div>
      </section>

      <!-- Emergency & Help -->
      <section class="card p-4">
        <h3 class="mb-2">Emergency &amp; Help</h3>
        <ul class="text-sm space-y-1">
          <li>ğŸš¨ <a class="link" href="tel:911">Call 911</a></li>
          <li>ğŸ§  <a class="link" href="tel:988">988 Suicide &amp; Crisis Lifeline</a></li>
          <li>â˜£ï¸ <a class="link" href="tel:18002221222">Poison Control (1â€‘800â€‘222â€‘1222)</a></li>
          <li>ğŸ¤ <a class="link" href="tel:211">211 Community Services</a></li>
          <li>ğŸ‘® Nonâ€‘emergency police (search): <span id="nonEmergencyLink"></span></li>
          <li>ğŸ› ï¸ City 311 online (search): <span id="sr311Link"></span></li>
        </ul>
      </section>
    </div>
  </main>

  <!-- About Modal -->
  <dialog id="aboutDlg" class="rounded-2xl p-0 w-[min(800px,92vw)]">
    <div class="p-5 card !bg-white dark:!bg-slate-900">
      <div class="flex items-start justify-between">
        <h3 class="text-xl font-bold">About</h3>
        <button id="aboutClose" class="btn">Close</button>
      </div>
      <div class="mt-4 grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div>
          <h4 class="font-semibold">About EagleReach</h4>
          <p class="mt-2 text-sm">
            EagleReach is a public, openâ€‘source civic assistant that connects U.S. residents with
            elected officials, <strong>voter information</strong>, city service updates (where available),
            weather forecasts, and roadwork/traffic context â€” all by ZIP code. The mission is to make
            civic access fast, trustworthy, and free for everyone.
          </p>
          <blockquote class="mt-3 text-sm italic">
            â€œGovernment of the people, by the people, for the people, shall not perish from the Earth.â€
            <span class="not-italic">â€” Abraham Lincoln</span>
          </blockquote>
          <p class="mt-2 text-sm">
            Benefits: oneâ€‘stop access to your representatives; authoritative voter links; quick actions to raise
            local concerns; and a privacyâ€‘respecting, adâ€‘free experience built entirely on open data.
          </p>
        </div>
        <div>
          <h4 class="font-semibold">About the Founder</h4>
          <p class="mt-2 text-sm">
            <strong>Vikesh Sagar Bairam â€” Founder of EagleReach Â· AI/ML &amp; Generative AI Engineer Â· Data Engineer Â· DevOps Specialist Â· Research Professional</strong>
          </p>
          <p class="text-sm mt-2">
            <strong>Education:</strong> Masterâ€™s in Information Systems &amp; Management (University of Illinois, Springfield);
            Bachelorâ€™s in Psychology; Bachelorâ€™s in Computer Science.
          </p>
          <p class="text-sm mt-1">
            <strong>Experience:</strong> Currently at Jabil; previously at Surfaces by Pacific.
          </p>
          <p class="text-sm mt-2">
            <strong>Contact:</strong>
            <a class="link" href="mailto:vikebairam@gmail.com">vikebairam@gmail.com</a> Â·
            <a class="link" href="https://www.linkedin.com/in/vikesh-bairam-219769258/" target="_blank">LinkedIn</a> Â·
            <a class="link" href="https://github.com/Vikesh2608" target="_blank">GitHub</a>
          </p>
        </div>
      </div>
    </div>
  </dialog>

  <!-- Contact -->
  <footer id="contact" class="border-t border-slate-200 dark:border-slate-800">
    <div class="max-w-6xl mx-auto px-4 py-8 text-sm">
      <div>
        <strong>Contact:</strong>
        <a class="link" href="mailto:vikebairam@gmail.com">vikebairam@gmail.com</a> Â·
        <a class="link" href="https://www.linkedin.com/in/vikesh-bairam-219769258/" target="_blank">LinkedIn</a> Â·
        <a class="link" href="https://github.com/Vikesh2608" target="_blank">GitHub</a>
      </div>
      <div class="mt-2 muted">Â© <span id="year"></span> EagleReach. Built openâ€‘source.</div>
    </div>
  </footer>

  <!-- App Script -->
  <script>
    const BACKEND_BASE = "https://eaglereach-1.onrender.com"; // <- your Render base

    // Utilities
    const $ = s => document.querySelector(s);
    function telHref(raw){ return `tel:${(raw||'').replace(/[^\d+]/g,'')}`; }
    function prettyPhone(raw){ if(!raw) return ""; const d=raw.replace(/[^\d]/g,''); return d.length===10?`(${d.slice(0,3)}) ${d.slice(3,6)}-${d.slice(6)}`:raw; }
    async function fetchJSON(u){ const r=await fetch(u,{headers:{"Accept":"application/json"}}); if(!r.ok) throw new Error(`${r.status} ${r.statusText}`); return r.json(); }
    function setStatus(msg, kind="info"){ const el=$("#status"); el.textContent=msg||""; el.className="mt-2 text-sm "+(kind==="error"?"text-red-600":"muted"); }
    function qsParam(name,value){ const url=new URL(location.href); url.searchParams.set(name,value); history.replaceState({}, "", url.toString()); }

    // History
    const HISTORY_KEY="eaglereach_zip_history";
    function loadHistory(){ try{ return JSON.parse(localStorage.getItem(HISTORY_KEY)||"[]"); }catch{ return []; } }
    function saveHistory(z){ if(!z)return; const arr=loadHistory().filter(x=>x!==z); arr.unshift(z); localStorage.setItem(HISTORY_KEY, JSON.stringify(arr.slice(0,5))); renderHistory(); }
    function renderHistory(){ const arr=loadHistory(); $("#history").innerHTML = arr.length?("Recent ZIPs: "+arr.map(z=>`<button class="pill mr-1 my-1" onclick="useZip('${z}')">${z}</button>`).join(" ")):""; }
    window.useZip = z => { $("#zipInput").value=z; run(); };

    // Geolocation â†’ ZIP
    async function locateMe(){
      try{
        setStatus("Locatingâ€¦");
        const pos=await new Promise((res,rej)=>navigator.geolocation.getCurrentPosition(res,rej,{enableHighAccuracy:true,timeout:12000}));
        const {latitude:lat,longitude:lon}=pos.coords;
        const rg=await fetchJSON(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`);
        const zip=rg.postcode || rg.localityInfo?.administrative?.find(x=>/postcode/i.test(x.description))?.name;
        if(!zip) throw new Error("ZIP not found for your location");
        $("#zipInput").value=zip; setStatus(`Using detected ZIP ${zip}`); run();
      }catch(e){ console.error(e); setStatus(`Could not get your location: ${e.message}`,"error"); }
    }

    // Renderers
    function renderOfficials(data){
      $("#officialsMeta").textContent = data.place ? `${data.place}, ${data.state?.abbr||""} â€¢ CD: ${data.district||"N/A"} â€¢ Updated ${new Date(data.generated_at).toLocaleString()}`:"";
      const list=$("#officialsList"); list.innerHTML="";
      (data.officials||[]).forEach(o=>{
        const phones=(o.phones||[]).map(p=>`<a class="link" href="${telHref(p)}">${prettyPhone(p)}</a>`).join(" Â· ");
        const urls=(o.urls||[]).slice(0,1).map(u=>`<a class="link" href="${u}" target="_blank">Official Site</a>`).join("");
        const party=o.party?` Â· ${o.party}`:"";
        const div=document.createElement("div");
        div.className="p-3 rounded-xl border border-slate-200 dark:border-slate-700";
        div.innerHTML=`<div class="font-semibold">${o.name}</div>
                       <div class="text-sm muted">${o.office}${party}</div>
                       <div class="text-sm mt-1">${phones||""}${urls?" Â· "+urls:""}</div>`;
        list.appendChild(div);
      });
      // Emergency links depend on city/state
      updateEmergencyLinks(data.place, data.state?.abbr);
    }

    function renderWeather(data){
      const wrap=$("#weatherList"), meta=$("#weatherMeta"); wrap.innerHTML="";
      (data.days||[]).forEach(d=>{
        const el=document.createElement("div");
        el.className="flex items-center justify-between border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2";
        el.innerHTML=`<div class="text-sm">${d.date}</div>
                      <div class="text-sm">${d.icon||""} ${d.condition||""}</div>
                      <div class="text-sm">${Math.round(d.tmin_c)}Â° / ${Math.round(d.tmax_c)}Â°C</div>
                      <div class="text-xs muted">Precip: ${d.precip_pct ?? "â€”"}%</div>`;
        wrap.appendChild(el);
      });
      meta.textContent = data.updated_at ? `Updated ${new Date(data.updated_at).toLocaleString()} â€¢ Source: ${data.source}` : "";
    }

    function renderRoadworks(data){
      const wrap=$("#roadList"), meta=$("#roadMeta"); wrap.innerHTML="";
      (data.items||[]).slice(0,8).forEach(it=>{
        const map= (it.lat&&it.lon)?` Â· <a class="link" href="https://maps.google.com/?q=${it.lat},${it.lon}" target="_blank">Map</a>`:"";
        const el=document.createElement("div");
        el.className="border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2";
        el.innerHTML=`<div class="text-sm"><strong>${it.name}</strong> ${it.kind?`Â· ${it.kind}`:""} ${it.distance_km!=null?`Â· ${it.distance_km} km`:""} ${map}</div>`;
        wrap.appendChild(el);
      });
      meta.textContent = data.source || "";
    }

    function renderCityUpdates(data){
      const list=$("#cityList"); list.innerHTML="";
      if((data.items||[]).length===0){
        // Helpful, not â€œcoming soonâ€
        const city = encodeURIComponent(current.place||"");
        const st = encodeURIComponent(current.state||"");
        list.innerHTML = `<div class="muted">No city feed here yet. Try official notices:
          <a class="link" target="_blank" href="https://www.google.com/search?q=site:.gov+${city}+${st}+roadwork+OR+notices+OR+construction">Search</a>.
        </div>`;
        return;
      }
      (data.items||[]).slice(0,8).forEach(i=>{
        const el=document.createElement("div");
        el.className="border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2";
        el.innerHTML=`<div><strong>${i.type||"Update"}</strong> â€” ${i.detail||i.status||""}</div>
                      <div class="text-xs muted">${i.address||""} ${i.created?"Â· "+new Date(i.created).toLocaleString():""}</div>`;
        list.appendChild(el);
      });
    }

    function renderVoter(data){
      const b=$("#voterBlock"); const st=data.state?.name||""; const links=data.links||{};
      b.innerHTML = `
        <div>State: <strong>${st}</strong></div>
        <div class="flex flex-col gap-2 mt-2">
          <a class="btn" target="_blank" href="${links.register}">ğŸ“ Register to Vote (Vote.gov)</a>
          <a class="btn" target="_blank" href="${links.state_office}">ğŸ›ï¸ Your State Election Office</a>
          <a class="btn" target="_blank" href="${links.how_to_vote}">ğŸ“˜ How to Vote / Rules</a>
          <a class="btn" target="_blank" href="${links.county_directory}">ğŸ“‡ County Election Contacts</a>
        </div>`;
    }

    function renderNewsButtons(city, st){
      const cityQ = encodeURIComponent(`${city} ${st}`);
      const localGov = `https://news.google.com/search?q=${encodeURIComponent(city + " " + st + " site:.gov OR site:.us")}`;
      const national = "https://news.google.com/topstories?hl=en-US&gl=US&ceid=US:en";
      const world = "https://news.google.com/topics/CAAqJggKIiBDQkFTRWdvSUwyMHZNRGx1YlY4U0FtVnVLQUFQAQ?hl=en-US&gl=US&ceid=US:en";
      $("#newsButtons").innerHTML = `
        <a class="btn" target="_blank" href="${localGov}">ğŸ›ï¸ Local (official)</a>
        <a class="btn" target="_blank" href="${national}">ğŸ‡ºğŸ‡¸ National</a>
        <a class="btn" target="_blank" href="${world}">ğŸŒ International</a>`;
      // Simple list of suggested queries (no scraping)
      $("#newsList").innerHTML = `
        <div>Try these queries:</div>
        <ul class="list-disc pl-5">
          <li><a class="link" target="_blank" href="https://news.google.com/search?q=${cityQ}+infrastructure">${city} ${st} infrastructure</a></li>
          <li><a class="link" target="_blank" href="https://news.google.com/search?q=${cityQ}+education">${city} ${st} education</a></li>
          <li><a class="link" target="_blank" href="https://news.google.com/search?q=${cityQ}+public+safety">${city} ${st} public safety</a></li>
        </ul>`;
    }

    function updateEmergencyLinks(place, state){
      const city = encodeURIComponent(place || "");
      const st = encodeURIComponent(state || "");
      $("#nonEmergencyLink").innerHTML = `<a class="link" target="_blank" href="https://www.google.com/search?q=non+emergency+police+${city}+${st}+phone">Find number</a>`;
      $("#sr311Link").innerHTML = `<a class="link" target="_blank" href="https://www.google.com/search?q=report+311+issue+${city}+${st}">Open 311</a>`;
      renderNewsButtons(place||"", state||"");
    }

    // Feedback
    async function loadFeedback(){
      try{
        const j = await fetchJSON(`${BACKEND_BASE}/feedback?limit=50`);
        const list=$("#fbList"); list.innerHTML="";
        (j.items||[]).forEach(it=>{
          const el=document.createElement("div");
          el.className="border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2";
          el.innerHTML=`<div class="text-sm"><strong>${it.name}</strong> <span class="muted">&lt;${it.email}&gt;</span></div>
                        <div class="text-sm mt-1">${it.message.replace(/[<>&]/g,s=>({"<":"&lt;",">":"&gt;","&":"&amp;"}[s]))}</div>
                        <div class="text-xs muted mt-1">${new Date(it.created_at).toLocaleString()}</div>`;
          list.appendChild(el);
        });
      }catch(e){ console.warn("feedback load", e); }
    }

    async function submitFeedback(e){
      e.preventDefault();
      const name=$("#fbName").value.trim();
      const email=$("#fbEmail").value.trim();
      const message=$("#fbMsg").value.trim();
      $("#fbStatus").textContent="Sendingâ€¦";
      try{
        const r = await fetch(`${BACKEND_BASE}/feedback`, {
          method:"POST", headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ name, email, message })
        });
        if(!r.ok) throw new Error(`${r.status}`);
        $("#fbName").value=""; $("#fbEmail").value=""; $("#fbMsg").value="";
        $("#fbStatus").textContent="Thanks for your feedback!";
        loadFeedback();
      }catch(e){ $("#fbStatus").textContent="Failed to send feedback."; }
    }

    // Main search flow
    let current = { zip:"", place:"", state:"" };
    async function run(){
      const zip=($("#zipInput").value||"").trim(); if(!zip){ setStatus("Enter a ZIP to search."); return; }
      setStatus("Loadingâ€¦"); qsParam("zip", zip); saveHistory(zip);
      try{
        const officials = await fetchJSON(`${BACKEND_BASE}/officials?zip=${encodeURIComponent(zip)}`);
        current = { zip, place: officials.place, state: officials.state?.abbr };
        renderOfficials(officials);
        setStatus(`Loaded for ${officials.place}, ${officials.state?.abbr||""}`);

        // Weather
        try{ renderWeather(await fetchJSON(`${BACKEND_BASE}/weather?zip=${zip}`)); }catch(e){ console.warn(e); }

        // Roadworks
        try{ renderRoadworks(await fetchJSON(`${BACKEND_BASE}/roadworks?zip=${zip}`)); }catch(e){ console.warn(e); }

        // City Updates
        try{ renderCityUpdates(await fetchJSON(`${BACKEND_BASE}/city/updates?zip=${zip}`)); }catch(e){ console.warn(e); }

        // Voter info
        try{ renderVoter(await fetchJSON(`${BACKEND_BASE}/voter?zip=${zip}`)); }catch(e){ console.warn(e); }

      }catch(e){ console.error(e); setStatus(`Fetch error: ${e.message}`, "error"); }
    }

    // Buttons and init
    $("#goBtn").addEventListener("click", run);
    $("#zipInput").addEventListener("keydown", e=>{ if(e.key==="Enter") run(); });
    $("#locBtn").addEventListener("click", locateMe);
    $("#shareBtn").addEventListener("click", async ()=>{ try{ await navigator.clipboard.writeText(location.href); setStatus("Share link copied."); }catch{ setStatus("Copy failed â€” copy URL manually.","error"); } });
    $("#clearBtn").addEventListener("click", ()=>{ localStorage.removeItem(HISTORY_KEY); renderHistory(); setStatus("History cleared."); });
    $("#aboutBtn").addEventListener("click", ()=>$("#aboutDlg").showModal());
    $("#aboutClose").addEventListener("click", ()=>$("#aboutDlg").close());
    $("#fbForm").addEventListener("submit", submitFeedback);

    $("#year").textContent=new Date().getFullYear();
    renderHistory();
    loadFeedback();

    const urlZip=new URL(location.href).searchParams.get("zip"); if(urlZip){ $("#zipInput").value=urlZip; run(); }
  </script>
</body>
</html>
