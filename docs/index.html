<!-- ZIP input and search button -->
<div class="flex gap-2 mt-4">
  <input id="zipInput" type="text" inputmode="numeric" maxlength="5"
         placeholder="ZIP code (e.g., 62704)" class="border p-2 rounded w-full" />

  <button id="searchBtn" type="button"
          class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
    Search
  </button>
</div>

<!-- Where officials will be listed -->
<ul id="officialsList" class="mt-4 space-y-2"></ul>

<script>
  const BACKEND_BASE = "https://eaglereach-1.onrender.com";

  const zipInput  = document.getElementById('zipInput');
  const searchBtn = document.getElementById('searchBtn');
  const listEl    = document.getElementById('officialsList');

  // Escape HTML helper
  function escapeHtml(s) {
    return String(s || "").replace(/&/g, "&amp;")
                          .replace(/</g, "&lt;")
                          .replace(/>/g, "&gt;");
  }

  // Render one official row
  function officialRow(o) {
    const name   = o?.name   || "N/A";
    const office = o?.office || "Official";
    const url    = o?.urls?.[0] || "";
    const phone  = o?.phones?.[0] || "";

    let html = `<li class="border border-gray-200 rounded-lg p-4 bg-white">
      <p class="font-semibold">${escapeHtml(name)} 
      <span class="text-gray-600">(${escapeHtml(office)})</span></p>`;

    if (url) {
      html += `<a class="text-blue-600 hover:underline break-all block mt-1" 
                 target="_blank" rel="noopener" 
                 href="${url}">
                 ${escapeHtml(url.replace(/^https?:\/\/(www\.)?/, ""))}
               </a>`;
    }

    if (phone) {
      html += `<div class="text-gray-700 mt-1">ðŸ“ž ${escapeHtml(phone)}</div>`;
    }

    html += `</li>`;
    return html;
  }

  // Fetch and render officials
  async function run() {
    const zip = (zipInput.value || "").trim();
    if (!/^\d{5}$/.test(zip)) {
      alert("Enter a 5-digit ZIP");
      return;
    }

    listEl.innerHTML = `<li class="text-gray-500">Loading...</li>`;

    try {
      const r = await fetch(`${BACKEND_BASE}/ask`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ address: zip })
      });

      const data = await r.json();
      if (!r.ok) throw new Error(data.detail || "Lookup failed");

      listEl.innerHTML = (data.officials || [])
        .map(officialRow)
        .join("") || `<li class="text-gray-500">No officials found.</li>`;
    } catch (e) {
      console.error("API error:", e);
      listEl.innerHTML = `<li class="text-red-500">Error: ${e.message}</li>`;
    }
  }

  // Wire up events
  if (searchBtn) searchBtn.addEventListener("click", run);
  if (zipInput) {
    zipInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") run();
    });
  }

  // Optional: auto-run if prefilled
  if (zipInput && /^\d{5}$/.test(zipInput.value)) {
    run();
  }
</script>
