<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>US EagleReach</title>
  <link rel="icon" href="data:,">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .hero { background: linear-gradient(90deg, #0b3b82 0%, #133b6b 55%, #0f2447 100%); }
    .muted { color: rgb(100,116,139); }
    .btn { border:1px solid rgb(226,232,240); padding:.45rem .8rem; border-radius:.75rem; }
    .btn:hover { background: rgba(0,0,0,.03); }
    .btn-primary { background:#2563eb; color:#fff; padding:.55rem .9rem; border-radius:.75rem; }
    .btn-primary:hover { filter:brightness(.95); }
    .card { background:#fff; border:1px solid rgb(226,232,240); border-radius:1rem; box-shadow:0 3px 8px rgba(0,0,0,.05); }
    .chip { background:rgb(241,245,249); color:rgb(51,65,85); font-size:.75rem; padding:.2rem .5rem; border-radius:.5rem; }
    dialog::backdrop { background: rgba(0,0,0,.45); }
    .link { color:#2563eb; }
    .link:hover { text-decoration: underline; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">

  <!-- Top Bar -->
  <header class="hero text-white">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="text-2xl">üá∫üá∏</div>
        <div>
          <div class="text-2xl font-semibold tracking-tight">US EagleReach</div>
          <div class="text-xs opacity-80">‚ÄúGovernment of the people, by the people, for the people, shall not perish from the earth.‚Äù ‚Äî Abraham Lincoln</div>
        </div>
      </div>
      <nav class="flex items-center gap-2">
        <button id="aboutBtn" class="btn">About</button>
        <button id="fbOpenBtn" class="btn">Feedback</button>
        <a href="#contact" class="btn">Contact</a>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 pt-6 pb-16">
    <!-- Search / controls -->
    <section class="card p-4 mb-4">
      <p class="muted mb-2">Enter your ZIP code to see representatives, weather & traffic, and upcoming elections.</p>
      <div class="flex flex-col md:flex-row items-stretch md:items-center gap-2">
        <input id="zipInput" class="rounded-xl border border-slate-300 px-3 py-2 w-full md:w-72" inputmode="numeric" maxlength="10" placeholder="ZIP code (e.g., 62704)"/>
        <div class="flex items-center gap-2">
          <button id="useLocBtn" class="btn" title="Use my location">Use my location</button>
          <span title="divider" aria-hidden="true">¬∑</span>
          <button id="searchBtn" class="btn-primary">Search</button>
          <button id="copyLinkBtn" class="btn">Copy Share Link</button>
          <button id="clearBtn" class="btn">Clear history</button>
        </div>
      </div>
      <div id="status" class="text-sm mt-2 muted"></div>
      <div id="history" class="mt-2 flex flex-wrap gap-2"></div>
    </section>

    <!-- Grid -->
    <section class="grid grid-cols-1 lg:grid-cols-3 gap-4">
      <!-- Officials -->
      <div class="card p-4 lg:col-span-2">
        <div class="flex items-center justify-between mb-2">
          <h2 class="font-semibold">Elected Representatives</h2>
          <div class="flex items-center gap-2">
            <button id="copyEmailsBtn" class="btn text-sm">Copy Emails</button>
            <button id="copyOfficialsBtn" class="btn text-sm">Copy Officials</button>
          </div>
        </div>
        <div id="officialsList" class="space-y-3"></div>
        <div class="mt-2 flex flex-wrap gap-2">
          <span class="chip">GovTrack (Congress)</span>
          <span class="chip">FCC</span>
          <span class="chip">Wikidata (Mayor)</span>
          <span class="chip">Zippopotam (ZIP)</span>
        </div>
      </div>

      <!-- Weather -->
      <div class="card p-4">
        <h2 class="font-semibold mb-2">Weather (7‚Äëday)</h2>
        <div id="weatherList" class="space-y-2 text-sm"></div>
        <div class="mt-2"><span class="chip">Open‚ÄëMeteo</span></div>
      </div>

      <!-- Voter Info & Education -->
      <div class="card p-4 lg:col-span-2">
        <h2 class="font-semibold mb-2">Voter Info &amp; Education</h2>
        <div class="grid sm:grid-cols-2 md:grid-cols-3 gap-2">
          <a id="voteGov" target="_blank" class="btn text-center">Register to Vote (vote.gov)</a>
          <a id="eacDir" target="_blank" class="btn text-center">Find Election Office (EAC)</a>
          <a id="absentee" target="_blank" class="btn text-center">Absentee / Mail Voting</a>
        </div>
        <p class="muted text-sm mt-2">Know the rules, deadlines, and your election officials before every election.</p>
      </div>

      <!-- News -->
      <div class="card p-4">
        <h2 class="font-semibold mb-2">News</h2>
        <div class="grid grid-cols-1 gap-2">
          <a id="newsLocal" target="_blank" class="btn text-left">Local News</a>
          <a id="newsUS" target="_blank" class="btn text-left">National (US) News</a>
          <a id="newsWorld" target="_blank" class="btn text-left">International News</a>
        </div>
      </div>

      <!-- Upcoming Elections -->
      <div class="card p-4">
        <h2 class="font-semibold mb-1">Upcoming Elections</h2>
        <div class="text-sm"><span class="muted">Next Federal:</span> November 3, 2025</div>
        <p class="muted text-sm mt-2">State primary dates coming soon (open data, state SoS sources).</p>
      </div>

      <!-- Traffic -->
      <div class="card p-4">
        <h2 class="font-semibold mb-2">Traffic</h2>
        <p class="muted text-sm">Open live traffic for your area in Google Maps.</p>
        <a id="trafficBtn" class="btn mt-2 inline-block" target="_blank">Open Traffic Map</a>
      </div>
    </section>

    <!-- About & Contact -->
    <section id="contact" class="mt-10 grid lg:grid-cols-2 gap-6">
      <div class="card p-5">
        <h3 class="text-lg font-semibold mb-2">About EagleReach</h3>
        <p class="text-sm">
          EagleReach is a public, open‚Äësource civic assistant that connects U.S. residents with their elected officials,
          reliable voter information, local weather & traffic‚Äîfast and free. Built to make civic access clear, trustworthy,
          and easy for everyone.
        </p>
        <ul class="text-sm mt-3 list-disc ml-5">
          <li>No logins, no ads, no tracking‚Äîjust facts.</li>
          <li>Open data only (GovTrack, FCC, Wikidata, Open‚ÄëMeteo).</li>
          <li>AI‚Äëassisted design choices focused on clarity and accessibility.</li>
        </ul>

        <h4 class="font-semibold mt-5">Founder</h4>
        <p class="text-sm">
          <strong>Vikesh Sagar Bairam ‚Äî AI/ML & Data Engineer ¬∑ DevOps Specialist ¬∑ Generative AI Research Professional</strong><br/>
          Master‚Äôs in Information Systems &amp; Management (University of Illinois Springfield). Dual Bachelor‚Äôs in Psychology and Computer Science.
          Currently at Jabil; previously at Surfaces by Pacific.
        </p>
        <p class="text-sm mt-2 italic">
          I‚Äôm a solutions architect at heart‚Äîbuilding EagleReach because every resident deserves simple, trustworthy access
          to government. My goal is to turn complex public data into clear, humane tools that strengthen democracy and everyday life.
        </p>
      </div>

      <div class="card p-5">
        <h3 class="text-lg font-semibold mb-2">Contact</h3>
        <p class="text-sm">
          LinkedIn: <a class="link" href="https://www.linkedin.com/in/vikesh-bairam-219769258/" target="_blank">Vikesh Bairam</a> ¬∑
          GitHub: <a class="link" href="https://github.com/Vikesh2608" target="_blank">Vikesh2608</a> ¬∑
          Email: <a class="link" href="mailto:vikebairam@gmail.com">vikebairam@gmail.com</a>
        </p>
        <h4 class="font-semibold mt-5">Emergency & City Services</h4>
        <ul class="text-sm list-disc ml-5">
          <li>911 (life‚Äëthreatening emergencies)</li>
          <li>311 (city services & non‚Äëemergency help)</li>
          <li>Local police non‚Äëemergency: see your city website</li>
        </ul>
      </div>
    </section>

    <footer class="muted text-xs text-center mt-12">
      ¬© 2025 EagleReach by Vikesh Sagar Bairam. All rights reserved.
    </footer>
  </main>

  <!-- About dialog (small quick card) -->
  <dialog id="aboutDlg" class="rounded-2xl p-0 w-[min(800px,92vw)]">
    <div class="p-5 card !bg-white">
      <div class="flex items-start justify-between">
        <h3 class="text-xl font-bold">About EagleReach</h3>
        <button id="aboutCloseBtn" class="btn">Close</button>
      </div>
      <p class="mt-3 text-sm">
        EagleReach is a community‚Äëminded, open‚Äësource project helping residents quickly find officials, voter info,
        weather, traffic, and election dates‚Äîall from trusted, public sources.
      </p>
    </div>
  </dialog>

  <!-- Feedback dialog -->
  <dialog id="fbDlg" class="rounded-2xl p-0 w-[min(800px,92vw)]">
    <div class="p-5 card !bg-white">
      <div class="flex items-start justify-between">
        <h3 class="text-xl font-bold">Feedback &amp; Comments</h3>
        <button id="fbCloseBtn" class="btn">Close</button>
      </div>

      <form id="fbForm" class="mt-4 space-y-3">
        <div>
          <div class="text-sm mb-1">Your rating</div>
          <div class="flex gap-2 text-2xl" id="fbStars" aria-label="Rate from 1 to 5">
            <button type="button" data-v="1">‚≠ê</button>
            <button type="button" data-v="2">‚≠ê</button>
            <button type="button" data-v="3">‚≠ê</button>
            <button type="button" data-v="4">‚≠ê</button>
            <button type="button" data-v="5">‚≠ê</button>
          </div>
          <input type="hidden" id="fbRating" value="5"/>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <input required id="fbName" class="rounded-xl border border-slate-300 px-3 py-2" placeholder="Your name"/>
          <input required id="fbEmail" type="email" class="rounded-xl border border-slate-300 px-3 py-2" placeholder="Email"/>
        </div>
        <!-- Honeypot -->
        <input id="fbCompany" name="company" class="hidden" tabindex="-1" autocomplete="off"/>
        <textarea required id="fbMsg" class="w-full rounded-xl border border-slate-300 px-3 py-2" rows="4" placeholder="Write your feedback..."></textarea>
        <div class="flex items-center gap-2">
          <button class="btn-primary">Send</button>
          <div id="fbStatus" class="text-sm muted"></div>
        </div>
      </form>

      <div class="mt-6">
        <h4 class="font-semibold mb-2">Recent feedback</h4>
        <div id="fbList" class="space-y-2"></div>
      </div>
    </div>
  </dialog>

  <script>
    // ----- CONFIG -----
    const BACKEND_BASE = "https://eaglereach-1.onrender.com"; // change if your Render URL differs
    const $ = (s,el=document)=>el.querySelector(s);
    const $$ = (s,el=document)=>[...el.querySelectorAll(s)];
    const enc = encodeURIComponent;

    // ----- Helpers -----
    async function fetchJSON(u){
      const r = await fetch(u, {headers: {"Accept":"application/json"}});
      if(!r.ok) throw new Error(`HTTP ${r.status}`);
      return r.json();
    }
    function setStatus(t){ $("#status").textContent=t||""; }
    function telLink(n){
      const digits=(n||"").replace(/[^\d+]/g,"");
      return digits ? `<a class="link" href="tel:${digits}">${n}</a>` : (n||"");
    }

    // ----- History -----
    function getHistory(){
      try{ return JSON.parse(localStorage.getItem("zipHistory")||"[]"); }catch{return []}
    }
    function setHistory(arr){
      localStorage.setItem("zipHistory", JSON.stringify(arr.slice(-5)));
      renderHistory();
    }
    function addToHistory(z){
      const h=getHistory().filter(x=>x!==z); h.push(z); setHistory(h);
    }
    function renderHistory(){
      const h=getHistory(); const el=$("#history"); el.innerHTML="";
      h.slice().reverse().forEach(z=>{
        const b=document.createElement("button");
        b.className="btn text-sm"; b.textContent=z;
        b.onclick=()=>{ $("#zipInput").value=z; run(); };
        el.appendChild(b);
      });
    }

    // ----- Officials -----
    async function loadOfficials(zip){
      const data = await fetchJSON(`${BACKEND_BASE}/officials?zip=${enc(zip)}`);
      const list=$("#officialsList"); list.innerHTML="";
      (data.officials||[]).forEach(o=>{
        const phones = (o.phones||[]).map(telLink).join(", ");
        const urls=(o.urls||[]).map(u=>`<a class="link" target="_blank" href="${u}">${u.replace(/^https?:\/\//,"")}</a>`).join("<br>");
        const div=document.createElement("div");
        div.className="border border-slate-200 rounded-xl p-3";
        div.innerHTML = `
          <div class="font-medium">${o.name} ‚Äî ${o.office}${o.party?` ‚Äî <span class="muted">${o.party}</span>`:""}</div>
          <div class="text-sm mt-1">${urls||""}</div>
          ${phones?`<div class="text-sm mt-1">${phones}</div>`:""}
        `;
        list.appendChild(div);
      });
      // News + voter links
      const city=data.place, state=data.state?.abbr;
      $("#newsLocal").href = `https://news.google.com/search?q=${enc(city+", "+state)}&hl=en-US&gl=US&ceid=US:en`;
      $("#newsUS").href    = "https://news.google.com/topics/CAAqJggKIiBDQkFTRWdvSUwyMHZNRGRqYjJvU0FtVnVLQUFQAQ?hl=en-US&gl=US&ceid=US:en";
      $("#newsWorld").href = "https://news.google.com/headlines/section/topic/WORLD?hl=en-US&gl=US&ceid=US:en";
      $("#voteGov").href   = "https://www.vote.gov/";
      $("#eacDir").href    = "https://www.eac.gov/voters/election-office-contact-information";
      $("#absentee").href  = "https://www.vote.gov/absentee-voting/";
      // traffic
      $("#trafficBtn").href = `https://www.google.com/maps/@?api=1&map_action=map&center=${data.location.lat},${data.location.lon}&zoom=12&layer=traffic`;
    }

    // ----- Weather -----
    async function loadWeather(zip){
      const data = await fetchJSON(`${BACKEND_BASE}/weather?zip=${enc(zip)}`);
      const list=$("#weatherList"); list.innerHTML="";
      (data.days||[]).forEach(d=>{
        const div=document.createElement("div");
        div.className="border border-slate-200 rounded-xl px-3 py-2";
        div.innerHTML=`
          <div class="flex items-center justify-between">
            <div class="text-sm">${d.date}</div>
            <div class="text-sm">${d.icon} ${d.summary}</div>
          </div>
          <div class="text-xs muted mt-1">High ${d.tmax_c}¬∞C ¬∑ Low ${d.tmin_c}¬∞C ¬∑ Precip ${d.precip_pct}%</div>
        `;
        list.appendChild(div);
      });
    }

    // ----- Feedback -----
    async function loadFeedback(){
      try{
        const j = await fetchJSON(`${BACKEND_BASE}/feedback?limit=50`);
        const list=$("#fbList"); list.innerHTML="";
        (j.items||[]).forEach(it=>{
          const stars = "‚≠ê".repeat(Math.max(1, Math.min(5, it.rating || 0)));
          const el=document.createElement("div");
          el.className="border border-slate-200 rounded-lg px-3 py-2";
          el.innerHTML=`<div class="text-sm"><strong>${it.name}</strong> <span class="muted">&lt;${it.email}&gt;</span> ¬∑ <span>${stars}</span></div>
                        <div class="text-sm mt-1">${(it.message||"").replace(/[<>&]/g,s=>({"<":"&lt;",">":"&gt;","&":"&amp;"}[s]))}</div>
                        <div class="text-xs muted mt-1">${new Date(it.created_at).toLocaleString()}</div>`;
          list.appendChild(el);
        });
      }catch(e){}
    }
    async function submitFeedback(e){
      e.preventDefault();
      if ($("#fbCompany").value) { $("#fbStatus").textContent="Thanks!"; return; } // honeypot
      const name=$("#fbName").value.trim();
      const email=$("#fbEmail").value.trim();
      const message=$("#fbMsg").value.trim();
      const rating=parseInt($("#fbRating").value||"5",10);
      $("#fbStatus").textContent="Sending‚Ä¶";
      try{
        const r = await fetch(`${BACKEND_BASE}/feedback`, {
          method:"POST", headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ name, email, message, rating })
        });
        if(!r.ok) throw new Error(`${r.status}`);
        $("#fbName").value=""; $("#fbEmail").value=""; $("#fbMsg").value="";
        $("#fbStatus").textContent="Thanks!";
        loadFeedback();
      }catch(e){ $("#fbStatus").textContent="Failed to send feedback."; }
    }

    // star picker
    (()=>{
      const stars=$("#fbStars").querySelectorAll("button");
      function paint(n){ stars.forEach((b,i)=>{ b.textContent = i < n ? "‚≠ê" : "‚òÜ"; }); }
      stars.forEach(b=> b.addEventListener("click", ()=>{
        const v=parseInt(b.dataset.v,10); $("#fbRating").value=String(v); paint(v);
      }));
      paint(parseInt($("#fbRating").value,10)||5);
    })();

    // ----- Run search -----
    async function run(){
      const z = ($("#zipInput").value||"").trim();
      if(!/^\d{5}(-\d{4})?$/.test(z)){ setStatus("Please enter a valid 5‚Äëdigit US ZIP."); return; }
      setStatus("Loading‚Ä¶");
      try{
        await Promise.all([loadOfficials(z), loadWeather(z)]);
        setStatus(`Showing results for ${z}`);
        addToHistory(z);
      }catch(e){ setStatus("Failed to load data."); }
      const url = new URL(location.href); url.searchParams.set("zip", z); history.replaceState({}, "", url);
    }

    // ----- Use my location -----
    async function useMyLocation(){
      setStatus("Getting your location‚Ä¶");
      if(!navigator.geolocation){ setStatus("Geolocation not available."); return; }
      navigator.geolocation.getCurrentPosition(async (pos)=>{
        try{
          const {latitude, longitude}=pos.coords||{};
          const r = await fetchJSON(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=en`);
          const zip = r.postcode || r.localityInfo?.Informative?.find(x=>x.description==="Postcode")?.name;
          if(zip){
            $("#zipInput").value = zip;
            run();
          } else {
            setStatus("Could not determine ZIP from your location.");
          }
        }catch(e){ setStatus("Could not determine ZIP from your location."); }
      }, ()=>setStatus("Location permission denied."));
    }

    // ----- Events -----
    $("#searchBtn").addEventListener("click", run);
    $("#zipInput").addEventListener("keydown", (e)=>{ if(e.key==="Enter") run(); });
    $("#useLocBtn").addEventListener("click", useMyLocation);
    $("#copyLinkBtn").addEventListener("click", ()=>{
      const z = ($("#zipInput").value||"").trim();
      const u = new URL(location.href); if(z) u.searchParams.set("zip", z);
      navigator.clipboard.writeText(u.toString()); setStatus("Share link copied.");
    });
    $("#clearBtn").addEventListener("click", ()=>{ localStorage.removeItem("zipHistory"); renderHistory(); setStatus("History cleared."); });

    // About modal
    $("#aboutBtn").addEventListener("click", ()=>$("#aboutDlg").showModal());
    $("#aboutCloseBtn").addEventListener("click", ()=>$("#aboutDlg").close());

    // Feedback modal
    $("#fbOpenBtn").addEventListener("click", ()=>{ $("#fbDlg").showModal(); loadFeedback(); });
    $("#fbCloseBtn").addEventListener("click", ()=>$("#fbDlg").close());
    $("#fbForm").addEventListener("submit", submitFeedback);

    // Init from URL or history
    (function init(){
      renderHistory();
      const params = new URL(location.href).searchParams;
      const z = params.get("zip");
      if(z){ $("#zipInput").value=z; run(); }
    })();
  </script>
</body>
</html>
