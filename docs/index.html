<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>US EagleReach</title>
  <link rel="icon" href="data:," />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .hero { background: linear-gradient(90deg, #0b1b43 0%, #133b6b 50%, #a21a1a 100%); }
    .shadow-soft { box-shadow: 0 10px 20px rgba(0,0,0,.05), 0 3px 6px rgba(0,0,0,.08); }
  </style>
</head>
<body class="min-h-screen bg-gray-50 text-gray-800">
  <!-- Header -->
  <header class="hero text-white">
    <div class="max-w-6xl mx-auto px-4 py-5 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="text-2xl">ðŸ‡ºðŸ‡¸</span>
        <h1 class="text-2xl md:text-3xl font-bold tracking-tight">US EagleReach</h1>
      </div>
      <nav class="flex items-center gap-6 text-sm md:text-base">
        <!-- Home removed by design -->
        <a href="#about" class="opacity-90 hover:opacity-100">About</a>
        <a href="#contact" class="opacity-90 hover:opacity-100">Contact</a>
      </nav>
    </div>
  </header>

  <!-- Search -->
  <section class="max-w-6xl mx-auto px-4 py-6 md:py-8">
    <p class="text-gray-600">Enter your ZIP code to see representatives, weather & traffic, BMV/DMV offices, and upcoming elections.</p>

    <div class="mt-4 flex flex-wrap gap-3 items-center">
      <input id="zipInput" type="text" inputmode="numeric" maxlength="10"
             placeholder="ZIP code (e.g., 62704)"
             class="w-64 md:w-80 border rounded-md px-3 py-2" />
      <button id="locBtn" class="px-3 py-2 rounded-md bg-gray-200 hover:bg-gray-300">Use my location</button>
      <button id="searchBtn" class="px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">Search</button>

      <button id="shareBtn" class="px-3 py-2 rounded-md bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border border-indigo-200">Copy Share Link</button>
      <button id="clearBtn" class="px-3 py-2 rounded-md bg-gray-50 text-gray-700 hover:bg-gray-100 border">Clear history</button>
    </div>

    <div id="status" class="mt-2 text-sm text-gray-500"></div>
    <div id="history" class="mt-2 text-sm text-gray-500"></div>
  </section>

  <!-- Grid -->
  <main class="max-w-6xl mx-auto px-4 pb-16">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Officials -->
      <section class="lg:col-span-1 bg-white rounded-xl shadow-soft p-4">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold">Elected Representatives</h2>
          <div class="flex gap-2">
            <button id="copyEmailsBtn" class="text-sm px-3 py-1 rounded-md border hover:bg-gray-50">Copy Emails</button>
            <button id="copyOfficialsBtn" class="text-sm px-3 py-1 rounded-md border hover:bg-gray-50">Copy Officials</button>
          </div>
        </div>
        <p id="officialsTime" class="text-xs text-gray-500 mt-1"></p>
        <ul id="officialsList" class="mt-4 space-y-3"></ul>
        <p class="mt-3 text-xs text-gray-400">Sources: GovTrack (Congress), Wikidata (Mayor), FCC, Zippopotam.</p>
      </section>

      <!-- Weather & Traffic -->
      <section class="lg:col-span-1 space-y-6">
        <div class="bg-white rounded-xl shadow-soft p-4">
          <h2 class="text-lg font-semibold">Weather (7-day)</h2>
          <div id="weatherBody" class="mt-3 text-sm text-gray-700">Enter a ZIP to load weatherâ€¦</div>
        </div>

        <div class="bg-white rounded-xl shadow-soft p-4">
          <h2 class="text-lg font-semibold">Traffic</h2>
          <p class="mt-1 text-sm text-gray-600">Open live traffic for your area in Google Maps.</p>
          <div class="mt-3">
            <a id="trafficLink" target="_blank"
               class="inline-block px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none">
              Open Traffic Map
            </a>
          </div>
        </div>
      </section>

      <!-- BMV/DMV & Elections -->
      <section class="lg:col-span-1 space-y-6">
        <div class="bg-white rounded-xl shadow-soft p-4">
          <h2 class="text-lg font-semibold">BMV/DMV Near You</h2>
          <ul id="bmvBody" class="mt-3 space-y-3 text-sm"></ul>
        </div>

        <div class="bg-white rounded-xl shadow-soft p-4">
          <h2 class="text-lg font-semibold">Upcoming Elections</h2>
          <div id="elexBody" class="mt-2 text-sm text-gray-700">
            <div><span class="font-medium">Next Federal:</span> November 3, 2025</div>
            <div class="text-gray-500">State primary dates coming soon (open data, state SoS sources).</div>
          </div>
        </div>
      </section>
    </div>

    <!-- About / Contact -->
    <section id="about" class="mt-16">
      <h3 class="text-xl font-semibold">About EagleReach</h3>
      <p class="mt-2 text-gray-700 max-w-3xl">
        EagleReach is a public, openâ€‘source civic assistant that connects U.S. residents
        with their elected officials, nearby BMV/DMV offices, and local context such as weather and
        traffic. Developed by Vikesh Sagar Bairamâ€”AI/ML & Data Engineer, DevOps Specialist, Research Professionalâ€”
        to make civic access fast, trustworthy, and easy for everyone.
      </p>
    </section>

    <section id="contact" class="mt-10">
      <h3 class="text-xl font-semibold">Contact</h3>
      <p class="mt-2 text-gray-700">
        LinkedIn:
        <a class="text-blue-700 hover:underline" target="_blank" href="https://www.linkedin.com/in/vikesh-bairam-219769258/">Vikesh Bairam</a>
        â€¢ GitHub:
        <a class="text-blue-700 hover:underline" target="_blank" href="https://github.com/Vikesh2608">Vikesh2608</a>
        â€¢ Email:
        <a class="text-blue-700 hover:underline" href="mailto:vikebairam@gmail.com">vikebairam@gmail.com</a>
      </p>
    </section>
  </main>

  <footer class="border-t bg-white">
    <div class="max-w-6xl mx-auto px-4 py-6 text-xs text-gray-500">
      Â© <span id="year"></span> EagleReach by Vikesh Sagar Bairam. All rights reserved.
    </div>
  </footer>

  <script>
    const BACKEND = "https://eaglereach-1.onrender.com";

    const zipInput = document.getElementById('zipInput');
    const searchBtn = document.getElementById('searchBtn');
    const locBtn = document.getElementById('locBtn');
    const shareBtn = document.getElementById('shareBtn');
    const clearBtn = document.getElementById('clearBtn');
    const statusEl = document.getElementById('status');
    const histEl = document.getElementById('history');

    const officialsList = document.getElementById('officialsList');
    const officialsTime = document.getElementById('officialsTime');
    const copyEmailsBtn = document.getElementById('copyEmailsBtn');
    const copyOfficialsBtn = document.getElementById('copyOfficialsBtn');

    const weatherBody = document.getElementById('weatherBody');
    const trafficLink = document.getElementById('trafficLink');
    const bmvBody = document.getElementById('bmvBody');

    function setStatus(msg, ok=true) {
      statusEl.className = "mt-2 text-sm " + (ok ? "text-gray-600" : "text-red-600");
      statusEl.textContent = msg || "";
    }
    function esc(s) { return (s || "").toString(); }
    function telLink(num) {
      const n = esc(num).replace(/[^\d+]/g,'');
      return `<a class="text-blue-700 hover:underline" href="tel:${n}">${esc(num)}</a>`;
    }
    function urlLink(u, label) {
      const safe = esc(u);
      const text = esc(label || u);
      return `<a class="text-blue-700 hover:underline" target="_blank" rel="noopener" href="${safe}">${text}</a>`;
    }

    const HKEY = "er_recent_zips";
    function pushHistory(zip) {
      try {
        let z = JSON.parse(localStorage.getItem(HKEY) || "[]");
        z = [zip, ...z.filter(v => v!==zip)].slice(0,5);
        localStorage.setItem(HKEY, JSON.stringify(z));
        renderHistory();
      } catch {}
    }
    function renderHistory() {
      try {
        const z = JSON.parse(localStorage.getItem(HKEY) || "[]");
        if (!z.length) { histEl.textContent = ""; return;}
        histEl.innerHTML = "Recent: " + z.map(s=>`<button class="underline mr-2" onclick="loadZip('${s}')">${s}</button>`).join("");
      } catch { histEl.textContent=""; }
    }
    clearBtn.addEventListener('click', ()=>{ localStorage.removeItem(HKEY); renderHistory(); });

    async function fetchJSON(url) {
      const r = await fetch(url, { headers: { "Accept":"application/json" }});
      if (!r.ok) throw new Error(`${r.status} ${r.statusText}`);
      return r.json();
    }

    async function loadAll(zip) {
      if (!/^\d{5}(-\d{4})?$/.test(zip)) { setStatus("Please enter a valid 5â€‘digit US ZIP.", false); return; }
      setStatus("Loadingâ€¦", true);
      pushHistory(zip);

      try {
        const o = await fetchJSON(`${BACKEND}/officials?zip=${encodeURIComponent(zip)}`);
        renderOfficials(o);
      } catch (e) {
        officialsList.innerHTML = "";
        officialsTime.textContent = "";
        console.error(e);
      }

      try {
        const w = await fetchJSON(`${BACKEND}/weather?zip=${encodeURIComponent(zip)}`);
        renderWeather(w);
        if (w && w.lat && w.lon) {
          trafficLink.href =
            `https://www.google.com/maps/@?api=1&map_action=map&basemap=traffic&center=${w.lat},${w.lon}&zoom=12`;
          trafficLink.removeAttribute('disabled');
        } else {
          trafficLink.setAttribute('disabled','disabled');
        }
      } catch (e) {
        weatherBody.textContent = "Weather temporarily unavailable.";
        trafficLink.setAttribute('disabled','disabled');
      }

      try {
        const b = await fetchJSON(`${BACKEND}/bmv?zip=${encodeURIComponent(zip)}`);
        renderBMV(b);
      } catch (e) {
        bmvBody.innerHTML = `<li class="text-sm text-gray-500">BMV/DMV data temporarily unavailable.</li>`;
      }

      setStatus(`Showing results for ${zip}`);
    }

    let currentOfficials = [];
    function renderOfficials(data) {
      currentOfficials = data.officials || [];
      officialsTime.textContent = data.generated_at ? `Updated at ${data.generated_at}` : "";
      const rows = data.officials || [];
      officialsList.innerHTML = rows.map(row => {
        const phones = (row.phones || []).map(p=>telLink(p)).join(", ");
        const urls = (row.urls || []).map(u=>urlLink(u)).join(", ");
        return `
        <li class="rounded-md border p-3">
          <div class="font-medium">${esc(row.name)} â€” <span class="text-gray-700">${esc(row.office)}</span></div>
          <div class="mt-1 text-sm">
            ${urls ? `<div class="mt-1">${urls}</div>` : ""}
            ${phones ? `<div class="mt-1">${phones}</div>` : ""}
          </div>
        </li>`;
      }).join("") || `<li class="text-sm text-gray-500">No officials found.</li>`;

      copyEmailsBtn.onclick = () => {
        const emails = currentOfficials.flatMap(o=>o.emails||[]);
        if (!emails.length) return setStatus("No emails on file.", false);
        navigator.clipboard.writeText(emails.join(", ")).then(()=> setStatus("Emails copied.",true));
      };
      copyOfficialsBtn.onclick = () => {
        const txt = currentOfficials.map(o=>`${o.name} â€” ${o.office}`).join("\n");
        navigator.clipboard.writeText(txt).then(()=> setStatus("Officials copied.",true));
      };
    }

    function renderWeather(w) {
      if (!w || !Array.isArray(w.days) || !w.days.length) {
        weatherBody.textContent = "No forecast available.";
        return;
      }
      weatherBody.innerHTML = `
        <div class="text-sm text-gray-600 mb-2">${esc(w.place)}, ${esc(w.state)}</div>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
          ${w.days.map(d => `
            <div class="border rounded-md p-2">
              <div class="text-xs text-gray-500">${esc(d.date)}</div>
              <div class="mt-1 font-medium">${Math.round(d.tmax_c)}Â°C / ${Math.round(d.tmin_c)}Â°C</div>
              <div class="text-xs text-gray-500">Precip: ${d.precip_pct ?? 0}%</div>
            </div>
          `).join("")}
        </div>`;
    }

    function renderBMV(b) {
      const offices = b && b.offices ? b.offices : [];
      if (!offices.length) {
        bmvBody.innerHTML = `<li class="text-sm text-gray-500">No BMV/DMV offices found nearby.</li>`;
        return;
      }
      bmvBody.innerHTML = offices.slice(0,6).map(o => `
        <li class="border rounded-md p-3">
          <div class="font-medium">${esc(o.name)}</div>
          <div class="text-sm text-gray-700 mt-1">${esc(o.address || "")}${o.locality ? ", "+esc(o.locality) : ""}</div>
          <div class="mt-1 text-sm">
            ${o.phone ? telLink(o.phone) : ""}
            ${o.website ? (o.phone ? " â€¢ " : "") + urlLink(o.website, "Website") : ""}
            ${o.maps ? ( (o.phone||o.website) ? " â€¢ " : "" ) + urlLink(o.maps, "Map") : ""}
          </div>
          ${o.opening_hours ? `<div class="text-xs text-gray-500 mt-1">Hours: ${esc(o.opening_hours)}</div>` : ""}
          ${typeof o.distance_km === "number" ? `<div class="text-xs text-gray-500 mt-1">${o.distance_km} km away</div>` : ""}
        </li>
      `).join("");
    }

    shareBtn.addEventListener('click', ()=>{
      const z = zipInput.value.trim();
      if (!z) return;
      const u = new URL(location.href);
      u.searchParams.set("zip", z);
      navigator.clipboard.writeText(u.toString()).then(()=> setStatus("Share link copied.", true));
    });

    locBtn.addEventListener('click', ()=>{
      if (!navigator.geolocation) return setStatus("Geolocation not supported.", false);
      navigator.geolocation.getCurrentPosition(async pos=>{
        try {
          const { latitude: lat, longitude: lon } = pos.coords || {};
          if (lat==null || lon==null) throw 0;
          setStatus("Enter your ZIP (tip: Google Maps â†’ tap your location to see postal code).", false);
        } catch { setStatus("Unable to resolve ZIP from location.", false) }
      }, ()=> setStatus("Location permission denied.", false));
    });

    searchBtn.addEventListener('click', ()=> loadAll(zipInput.value.trim()));
    zipInput.addEventListener('keydown', (e)=>{ if (e.key==='Enter') loadAll(zipInput.value.trim()); });

    (function init(){
      document.getElementById('year').textContent = new Date().getFullYear();
      const u = new URL(location.href);
      const z = u.searchParams.get('zip') || "";
      if (z) zipInput.value = z;
      renderHistory();
      if (z) loadAll(z);
    })();
    window.loadZip = (z)=>{ zipInput.value=z; loadAll(z); };
  </script>
</body>
</html>
